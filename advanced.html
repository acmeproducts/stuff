<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Venice AI Advanced Image Generator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background-color: #f3f4f6;
      min-height: 100vh;
      margin: 0;
      padding: 1rem;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
    }

    .step-hidden {
      display: none !important;
    }
    
    .download-btn {
      position: absolute;
      bottom: 8px;
      right: 8px;
      background-color: rgba(14, 165, 233, 0.9);
      color: white;
      padding: 6px 12px;
      border-radius: 6px;
      display: flex;
      align-items: center;
      gap: 4px;
      opacity: 0;
      transition: opacity 0.2s ease;
    }

    .image-container:hover .download-btn {
      opacity: 1;
    }

    .image-container {
      position: relative;
      overflow: hidden;
      border-radius: 8px;
      background-color: #f3f4f6;
      aspect-ratio: 1;
    }

    .generated-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      border-radius: 8px;
    }

    .progress-bar {
      width: 100%;
      height: 4px;
      background-color: #e5e7eb;
      border-radius: 2px;
      overflow: hidden;
    }

    .progress-bar-fill {
      height: 100%;
      background-color: #3b82f6;
      transition: width 0.3s ease;
    }

    .log-entry {
      padding: 8px;
      margin-bottom: 4px;
      border-radius: 4px;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 4px solid #f3f4f6;
      border-top: 4px solid #3b82f6;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .loading-overlay {
      position: absolute;
      inset: 0;
      background-color: rgba(255, 255, 255, 0.9);
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      gap: 1rem;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }

    .loading-overlay.active {
      opacity: 1;
      pointer-events: auto;
    }

    .tab-active {
      border-bottom: 2px solid #3b82f6;
      color: #3b82f6;
    }

    .input-group {
      opacity: 0;
      transform: translateY(10px);
      transition: all 0.3s ease;
      display: none;
    }

    .input-group.active {
      opacity: 1;
      transform: translateY(0);
      display: block;
    }

    .canvas-container {
      position: relative;
      width: 512px;
      height: 512px;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      overflow: hidden;
    }

    #maskCanvas {
      position: absolute;
      top: 0;
      left: 0;
      pointer-events: none;
    }

    .brush-size-preview {
      width: 20px;
      height: 20px;
      border: 1px solid #000;
      border-radius: 50%;
      margin-left: 10px;
    }

    .template-card {
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
      background-color: white;
    }

    .template-card:hover {
      border-color: #3b82f6;
    }

    .back-btn {
      position: fixed;
      top: 1rem;
      left: 1rem;
      z-index: 50;
    }
  </style>
</head>
<body>
  <button id="backButton" class="back-btn bg-white px-4 py-2 rounded-lg shadow-md hover:bg-gray-50 transition-colors step-hidden">
    ‚Üê Back
  </button>

  <div class="container">
    <div id="inputMethods" class="bg-white rounded-lg shadow-lg p-8 mb-8">
      <h2 class="text-2xl font-bold mb-6">Venice AI Advanced Image Generator</h2>
      
      <div class="flex border-b mb-6 overflow-x-auto">
        <button class="px-4 py-2 tab-active whitespace-nowrap" data-tab="prompt">Text Prompt</button>
        <button class="px-4 py-2 whitespace-nowrap" data-tab="variations">Variations</button>
        <button class="px-4 py-2 whitespace-nowrap" data-tab="templates">Templates</button>
        <button class="px-4 py-2 whitespace-nowrap" data-tab="img2img">Image to Image</button>
        <button class="px-4 py-2 whitespace-nowrap" data-tab="builder">Prompt Builder</button>
        <button class="px-4 py-2 whitespace-nowrap" data-tab="negative">Negative Prompts</button>
        <button class="px-4 py-2 whitespace-nowrap" data-tab="batch">Batch Processing</button>
      </div>

      <!-- Text Prompt Tab -->
      <div id="promptInput" class="input-group active">
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2" for="apiKey">API Key</label>
            <input type="password" id="apiKey" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" value="pu-I1nOF6L90PEjiUCeCpIoraImhiyh08Jj61whQoj">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2" for="model">Model</label>
            <select id="model" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
              <option value="venice-sd35">venice-sd35</option>
              <option value="fluently-xl">fluently-xl</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2" for="prompt">Prompt</label>
            <textarea id="prompt" rows="4" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Enter your prompt here"></textarea>
          </div>
          <button id="generate" class="w-full bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600 transition-colors">Generate Image</button>
        </div>
      </div>

      <!-- Variations Tab -->
      <div id="variationsInput" class="input-group">
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2" for="variationsApiKey">API Key</label>
            <input type="password" id="variationsApiKey" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" value="pu-I1nOF6L90PEjiUCeCpIoraImhiyh08Jj61whQoj">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2" for="variationsModel">Model</label>
            <select id="variationsModel" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
              <option value="venice-sd35">venice-sd35</option>
              <option value="fluently-xl">fluently-xl</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2" for="variationsPrompt">Prompt</label>
            <textarea id="variationsPrompt" rows="4" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Enter your prompt here"></textarea>
          </div>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2" for="variationsCount">Number of Variations</label>
              <input type="number" id="variationsCount" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" value="4" min="1" max="10">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2" for="variationsSeedStart">Starting Seed</label>
              <input type="number" id="variationsSeedStart" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" value="1000">
            </div>
          </div>
          <button id="generateVariations" class="w-full bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600 transition-colors">Generate Variations</button>
        </div>
      </div>

      <!-- Templates Tab -->
      <div id="templatesInput" class="input-group">
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2" for="templatesApiKey">API Key</label>
            <input type="password" id="templatesApiKey" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" value="pu-I1nOF6L90PEjiUCeCpIoraImhiyh08Jj61whQoj">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2" for="templateSelect">Select Template</label>
            <select id="templateSelect" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
              <option value="portrait">Portrait Template</option>
              <option value="landscape">Landscape Template</option>
              <option value="product">Product Template</option>
              <option value="custom">Custom Template</option>
            </select>
          </div>
          <div id="templateVariables" class="space-y-2">
            <!-- Template variables will be dynamically added here -->
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Preview</label>
            <div id="templatePreview" class="bg-gray-50 p-4 rounded-lg text-sm font-mono whitespace-pre-wrap"></div>
          </div>
          <button id="generateTemplate" class="w-full bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600 transition-colors">Generate from Template</button>
        </div>
      </div>

      <!-- Image to Image Tab -->
      <div id="img2imgInput" class="input-group">
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2" for="img2imgApiKey">API Key</label>
            <input type="password" id="img2imgApiKey" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" value="pu-I1nOF6L90PEjiUCeCpIoraImhiyh08Jj61whQoj">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2" for="img2imgModel">Model</label>
            <select id="img2imgModel" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
              <option value="venice-sd35">venice-sd35</option>
              <option value="fluently-xl">fluently-xl</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2" for="img2imgPrompt">Prompt</label>
            <textarea id="img2imgPrompt" rows="4" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Enter your prompt here"></textarea>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Source Image</label>
            <input type="file" id="sourceImage" accept="image/*" class="w-full">
          </div>
          <div class="canvas-container mx-auto">
            <canvas id="sourceCanvas" width="512" height="512"></canvas>
            <canvas id="maskCanvas" width="512" height="512"></canvas>
          </div>
          <div class="flex items-center gap-4">
            <button id="clearMask" class="px-4 py-2 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors">Clear Mask</button>
            <div class="flex items-center">
              <label class="text-sm text-gray-700 mr-2">Brush Size:</label>
              <input type="range" id="brushSize" min="1" max="100" value="20" class="w-32">
              <div id="brushPreview" class="brush-size-preview"></div>
            </div>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2" for="img2imgStrength">Strength</label>
            <input type="range" id="img2imgStrength" class="w-full" min="0" max="100" value="75">
            <div class="flex justify-between text-sm text-gray-500">
              <span>Subtle Changes</span>
              <span>Major Changes</span>
            </div>
          </div>
          <button id="generateImg2img" class="w-full bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600 transition-colors">Generate Image</button>
        </div>
      </div>

      <!-- Prompt Builder Tab -->
      <div id="builderInput" class="input-group">
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2" for="builderApiKey">API Key</label>
            <input type="password" id="builderApiKey" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" value="pu-I1nOF6L90PEjiUCeCpIoraImhiyh08Jj61whQoj">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2" for="builderModel">Model</label>
            <select id="builderModel" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
              <option value="venice-sd35">venice-sd35</option>
              <option value="fluently-xl">fluently-xl</option>
            </select>
          </div>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2" for="builderStyle">Style</label>
              <select id="builderStyle" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                <option value="photorealistic">Photorealistic</option>
                <option value="anime">Anime</option>
                <option value="oil-painting">Oil Painting</option>
                <option value="watercolor">Watercolor</option>
                <option value="digital-art">Digital Art</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2" for="builderArtist">Artist</label>
              <select id="builderArtist" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                <option value="">None</option>
                <option value="van-gogh">Vincent van Gogh</option>
                <option value="monet">Claude Monet</option>
                <option value="picasso">Pablo Picasso</option>
                <option value="da-vinci">Leonardo da Vinci</option>
              </select>
            </div>
          </div>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2" for="builderLighting">Lighting</label>
              <select id="builderLighting" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                <option value="natural">Natural</option>
                <option value="studio">Studio</option>
                <option value="dramatic">Dramatic</option>
                <option value="soft">Soft</option>
                <option value="harsh">Harsh</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2" for="builderAngle">Camera Angle</label>
              <select id="builderAngle" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                <option value="front">Front View</option>
                <option value="side">Side View</option>
                <option value="aerial">Aerial View</option>
                <option value="low">Low Angle</option>
                <option value="high">High Angle</option>
              </select>
            </div>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2" for="builderSubject">Subject</label>
            <input type="text" id="builderSubject" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Enter the main subject">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Preview</label>
            <div id="builderPreview" class="bg-gray-50 p-4 rounded-lg text-sm font-mono whitespace-pre-wrap"></div>
          </div>
          <button id="generateBuilder" class="w-full bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600 transition-colors">Generate Image</button>
        </div>
      </div>

      <!-- Negative Prompts Tab -->
      <div id="negativeInput" class="input-group">
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2" for="negativeApiKey">API Key</label>
            <input type="password" id="negativeApiKey" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" value="pu-I1nOF6L90PEjiUCeCpIoraImhiyh08Jj61whQoj">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2" for="negativeModel">Model</label>
            <select id="negativeModel" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
              <option value="venice-sd35">venice-sd35</option>
              <option value="fluently-xl">fluently-xl</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2" for="negativePrompt">Prompt</label>
            <textarea id="negativePrompt" rows="4" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Enter your prompt here"></textarea>
          </div>
          <div class="space-y-2">
            <label class="block text-sm font-medium text-gray-700 mb-2">Negative Prompt Categories</label>
            <div class="grid grid-cols-2 gap-2">
              <label class="flex items-center space-x-2">
                <input type="checkbox" class="rounded border-gray-300" value="low quality">
                <span>Low Quality</span>
              </label>
              <label class="flex items-center space-x-2">
                <input type="checkbox" class="rounded border-gray-300" value="bad anatomy">
                <span>Bad Anatomy</span>
              </label>
              <label class="flex items-center space-x-2">
                <input type="checkbox" class="rounded border-gray-300" value="blurry">
                <span>Blurry</span>
              </label>
              <label class="flex items-center space-x-2">
                <input type="checkbox" class="rounded border-gray-300" value="watermark">
                <span>Watermark</span>
              </label>
            </div>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Custom Negative Prompts</label>
            <textarea id="customNegative" rows="4" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Enter custom negative prompts, one per line"></textarea>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Combined Negative Prompt</label>
            <div id="negativePreview" class="bg-gray-50 p-4 rounded-lg text-sm font-mono whitespace-pre-wrap"></div>
          </div>
          <button id="generateNegative" class="w-full bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600 transition-colors">Generate Image</button>
        </div>
      </div>

      <!-- Batch Processing Tab -->
      <div id="batchInput" class="input-group">
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2" for="batchApiKey">API Key</label>
            <input type="password" id="batchApiKey" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" value="pu-I1nOF6L90PEjiUCeCpIoraImhiyh08Jj61whQoj">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Upload Images</label>
            <input type="file" id="batchImages" multiple accept="image/*" class="w-full">
          </div>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2" for="batchOperation">Operation</label>
              <select id="batchOperation" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                <option value="upscale">Upscale</option>
                <option value="style">Style Transfer</option>
                <option value="face">Face Enhancement</option>
                <option value="background">Background Removal</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2" for="batchModel">Model</label>
              <select id="batchModel" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                <option value="venice-sd35">venice-sd35</option>
                <option value="fluently-xl">fluently-xl</option>
              </select>
            </div>
          </div>
          <div id="batchPreview" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
            <!-- Batch preview images will be added here -->
          </div>
          <button id="generateBatch" class="w-full bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600 transition-colors">Process Images</button>
        </div>
      </div>
    </div>

    <div id="output" class="step-hidden">
      <div class="bg-white rounded-lg shadow-lg p-8">
        <h2 class="text-2xl font-bold mb-6">Generated Images</h2>
        <div id="progressContainer" class="mb-4 hidden">
          <div class="flex justify-between text-sm text-gray-600 mb-2">
            <span>Progress</span>
            <span id="progressText">0/1</span>
          </div>
          <div class="progress-bar">
            <div id="progressBarFill" class="progress-bar-fill" style="width: 0%"></div>
          </div>
        </div>
        <div id="logContainer" class="bg-gray-50 p-4 rounded-lg space-y-2 max-h-60 overflow-y-auto"></div>
        <div id="imageContainer" class="mt-8 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
      </div>
    </div>
  </div>

  <script>
    // Template definitions
    const templates = {
      portrait: {
        template: "A {style} portrait of {subject} with {lighting} lighting, {mood} mood",
        variables: ["style", "subject", "lighting", "mood"]
      },
      landscape: {
        template: "A {time} landscape of {location} with {weather} conditions",
        variables: ["time", "location", "weather"]
      },
      product: {
        template: "{product} photographed on a {background} background with {lighting} lighting",
        variables: ["product", "background", "lighting"]
      },
      custom: {
        template: "{custom}",
        variables: ["custom"]
      }
    };

    // Negative prompt presets
    const negativePresets = {
      "low quality": "low quality, worst quality, bad quality, blurry, pixelated",
      "bad anatomy": "bad anatomy, deformed, mutated, extra limbs, missing limbs",
      "blurry": "blurry, out of focus, motion blur, camera shake",
      "watermark": "watermark, text, signature, copyright, logo"
    };

    function generateMetadata(config) {
      const apiPayload = {
        model: config.model || 'venice-sd35',
        prompt: config.prompt,
        width: config.width || 1024,
        height: config.height || 1024,
        steps: config.steps || 30,
        seed: config.seed || Math.floor(Math.random() * 999999999),
        negative_prompt: config.negative_prompt || '',
        hide_watermark: true,
        safe_mode: false,
        return_binary: true,
        cfg_scale: config.cfg_scale || 7,
        format: 'png'
      };

      if (config.image) {
        apiPayload.init_image = config.image;
        apiPayload.strength = config.strength || 0.75;
      }

      if (config.mask) {
        apiPayload.mask = config.mask;
      }

      const metadata = {
        'Project_ID:': config.projectId || 'default',
        'Prompt:': config.prompt,
        'Model:': config.model || 'venice-sd35',
        'Height:': config.height || 1024,
        'Width:': config.width || 1024,
        'Steps:': config.steps || 30,
        'Seed:': apiPayload.seed,
        'CFG_Scale:': config.cfg_scale || 7,
        'Negative_Prompt:': apiPayload.negative_prompt,
        'Global_Hash:': btoa(JSON.stringify(apiPayload)).slice(0, 32),
        'API_Call:': JSON.stringify(apiPayload, null, 2)
      };

      return { metadata, apiPayload };
    }

    async function processImage(config) {
      try {
        const { metadata, apiPayload } = generateMetadata(config);

        const response = await fetch('https://api.venice.ai/api/v1/image/generate', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${config.apiKey}`
          },
          body: JSON.stringify(apiPayload)
        });

        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        const blob = await response.blob();
        const imageUrl = URL.createObjectURL(blob);

        const imageContainer = document.createElement('div');
        imageContainer.className = 'bg-white rounded-lg shadow-lg p-4';
        
        const img = document.createElement('img');
        img.src =imageUrl;
        img.className = 'w-full h-auto rounded-lg mb-4';
        
        const metadataContainer = document.createElement('div');
        metadataContainer.className = 'text-sm space-y-1 font-mono';
        
        Object.entries(metadata).forEach(([key, value]) => {
          const row = document.createElement('div');
          row.className = 'grid grid-cols-3 gap-2';
          
          const keySpan = document.createElement('span');
          keySpan.className = 'font-medium col-span-1';
          keySpan.textContent = key;
          
          const valueSpan = document.createElement('span');
          valueSpan.className = 'col-span-2 whitespace-pre-wrap';
          valueSpan.textContent = value;
          
          row.appendChild(keySpan);
          row.appendChild(valueSpan);
          metadataContainer.appendChild(row);
        });

        const downloadBtn = document.createElement('button');
        downloadBtn.className = 'mt-4 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors w-full';
        downloadBtn.textContent = 'Download';
        downloadBtn.onclick = () => {
          const link = document.createElement('a');
          link.href = imageUrl;
          link.download = `venice-ai-${metadata['Project_ID:']}-${new Date().getTime()}.png`;
          link.click();
        };

        imageContainer.appendChild(img);
        imageContainer.appendChild(metadataContainer);
        imageContainer.appendChild(downloadBtn);
        document.getElementById('imageContainer').appendChild(imageContainer);

      } catch (error) {
        console.error('Error:', error);
        alert('Error generating image: ' + error.message);
      }
    }

    // Tab switching logic
    const tabs = document.querySelectorAll('[data-tab]');
    const inputGroups = document.querySelectorAll('.input-group');
    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        tabs.forEach(t => t.classList.remove('tab-active'));
        tab.classList.add('tab-active');
        
        inputGroups.forEach(group => group.classList.remove('active'));
        document.getElementById(`${tab.dataset.tab}Input`).classList.add('active');
      });
    });

    // Back button logic
    const backButton = document.getElementById('backButton');
    const inputMethods = document.getElementById('inputMethods');
    const output = document.getElementById('output');
    backButton.addEventListener('click', () => {
      output.classList.add('step-hidden');
      inputMethods.classList.remove('step-hidden');
      backButton.classList.add('step-hidden');
      document.getElementById('imageContainer').innerHTML = '';
    });

    // Text Prompt tab logic
    document.getElementById('generate').addEventListener('click', async () => {
      const config = {
        apiKey: document.getElementById('apiKey').value,
        model: document.getElementById('model').value,
        prompt: document.getElementById('prompt').value
      };

      inputMethods.classList.add('step-hidden');
      output.classList.remove('step-hidden');
      backButton.classList.remove('step-hidden');
      
      await processImage(config);
    });

    // Variations tab logic
    document.getElementById('generateVariations').addEventListener('click', async () => {
      const config = {
        apiKey: document.getElementById('variationsApiKey').value,
        model: document.getElementById('variationsModel').value,
        prompt: document.getElementById('variationsPrompt').value,
        seed: parseInt(document.getElementById('variationsSeedStart').value)
      };

      const count = parseInt(document.getElementById('variationsCount').value);

      inputMethods.classList.add('step-hidden');
      output.classList.remove('step-hidden');
      backButton.classList.remove('step-hidden');

      for (let i = 0; i < count; i++) {
        await processImage({
          ...config,
          seed: config.seed + i
        });
      }
    });

    // Templates tab logic
    document.getElementById('templateSelect').addEventListener('change', (e) => {
      const template = templates[e.target.value];
      const container = document.getElementById('templateVariables');
      container.innerHTML = '';
      
      template.variables.forEach(variable => {
        const div = document.createElement('div');
        div.innerHTML = `
          <label class="block text-sm font-medium text-gray-700 mb-2" for="${variable}">${variable.charAt(0).toUpperCase() + variable.slice(1)}</label>
          <input type="text" id="${variable}" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
        `;
        container.appendChild(div);
        
        div.querySelector('input').addEventListener('input', updateTemplatePreview);
      });
      
      updateTemplatePreview();
    });

    function updateTemplatePreview() {
      const templateName = document.getElementById('templateSelect').value;
      const template = templates[templateName];
      let preview = template.template;
      
      template.variables.forEach(variable => {
        const value = document.getElementById(variable)?.value || `{${variable}}`;
        preview = preview.replace(`{${variable}}`, value);
      });
      
      document.getElementById('templatePreview').textContent = preview;
    }

    document.getElementById('generateTemplate').addEventListener('click', async () => {
      const config = {
        apiKey: document.getElementById('templatesApiKey').value,
        model: document.getElementById('builderModel').value,
        prompt: document.getElementById('templatePreview').textContent
      };

      inputMethods.classList.add('step-hidden');
      output.classList.remove('step-hidden');
      backButton.classList.remove('step-hidden');

      await processImage(config);
    });

    // Image to Image tab logic
    const sourceCanvas = document.getElementById('sourceCanvas');
    const maskCanvas = document.getElementById('maskCanvas');
    const ctx = sourceCanvas.getContext('2d');
    const maskCtx = maskCanvas.getContext('2d');
    let isDrawing = false;

    document.getElementById('sourceImage').addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (e) => {
          const img = new Image();
          img.onload = () => {
            ctx.drawImage(img, 0, 0, sourceCanvas.width, sourceCanvas.height);
          };
          img.src = e.target.result;
        };
        reader.readAsDataURL(file);
      }
    });

    maskCanvas.addEventListener('mousedown', startDrawing);
    maskCanvas.addEventListener('mousemove', draw);
    maskCanvas.addEventListener('mouseup', stopDrawing);
    maskCanvas.addEventListener('mouseout', stopDrawing);

    function startDrawing(e) {
      isDrawing = true;
      draw(e);
    }

    function draw(e) {
      if (!isDrawing) return;
      
      const rect = maskCanvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      const brushSize = parseInt(document.getElementById('brushSize').value);
      
      maskCtx.beginPath();
      maskCtx.arc(x, y, brushSize / 2, 0, Math.PI * 2);
      maskCtx.fillStyle = 'white';
      maskCtx.fill();
    }

    function stopDrawing() {
      isDrawing = false;
    }

    document.getElementById('clearMask').addEventListener('click', () => {
      maskCtx.clearRect(0, 0, maskCanvas.width, maskCanvas.height);
    });

    document.getElementById('brushSize').addEventListener('input', (e) => {
      const size = e.target.value;
      document.getElementById('brushPreview').style.width = `${size}px`;
      document.getElementById('brushPreview').style.height = `${size}px`;
    });

    document.getElementById('generateImg2img').addEventListener('click', async () => {
      const sourceImageData = sourceCanvas.toDataURL('image/png');
      const maskImageData = maskCanvas.toDataURL('image/png');
      
      const config = {
        apiKey: document.getElementById('img2imgApiKey').value,
        model: document.getElementById('img2imgModel').value,
        prompt: document.getElementById('img2imgPrompt').value,
        image: sourceImageData.split(',')[1],
        mask: maskImageData.split(',')[1],
        strength: parseInt(document.getElementById('img2imgStrength').value) / 100
      };

      inputMethods.classList.add('step-hidden');
      output.classList.remove('step-hidden');
      backButton.classList.remove('step-hidden');

      await processImage(config);
    });

    // Prompt Builder tab logic
    const builderInputs = ['builderStyle', 'builderArtist', 'builderLighting', 'builderAngle', 'builderSubject'];
    builderInputs.forEach(id => {
      document.getElementById(id)?.addEventListener('input', updateBuilderPreview);
    });

    function updateBuilderPreview() {
      const style = document.getElementById('builderStyle').value;
      const artist = document.getElementById('builderArtist').value;
      const lighting = document.getElementById('builderLighting').value;
      const angle = document.getElementById('builderAngle').value;
      const subject = document.getElementById('builderSubject').value;
      
      let prompt = subject;
      if (style) prompt += `, ${style} style`;
      if (artist) prompt += `, in the style of ${artist}`;
      if (lighting) prompt += `, with ${lighting} lighting`;
      if (angle) prompt += `, from a ${angle}`;
      
      document.getElementById('builderPreview').textContent = prompt;
    }

    document.getElementById('generateBuilder').addEventListener('click', async () => {
      const config = {
        apiKey: document.getElementById('builderApiKey').value,
        model: document.getElementById('builderModel').value,
        prompt: document.getElementById('builderPreview').textContent
      };

      inputMethods.classList.add('step-hidden');
      output.classList.remove('step-hidden');
      backButton.classList.remove('step-hidden');

      await processImage(config);
    });

    // Negative Prompts tab logic
    const negativeCheckboxes = document.querySelectorAll('#negativeInput input[type="checkbox"]');
    negativeCheckboxes.forEach(checkbox => {
      checkbox.addEventListener('change', updateNegativePreview);
    });

    document.getElementById('customNegative').addEventListener('input', updateNegativePreview);

    function updateNegativePreview() {
      const selectedPresets = Array.from(negativeCheckboxes)
        .filter(cb => cb.checked)
        .map(cb => negativePresets[cb.value]);
      
      const customNegatives = document.getElementById('customNegative').value
        .split('\n')
        .filter(line => line.trim());
      
      const combined = [...selectedPresets, ...customNegatives].join(', ');
      document.getElementById('negativePreview').textContent = combined;
    }

    document.getElementById('generateNegative').addEventListener('click', async () => {
      const config = {
        apiKey: document.getElementById('negativeApiKey').value,
        model: document.getElementById('negativeModel').value,
        prompt: document.getElementById('negativePrompt').value,
        negative_prompt: document.getElementById('negativePreview').textContent
      };

      inputMethods.classList.add('step-hidden');
      output.classList.remove('step-hidden');
      backButton.classList.remove('step-hidden');

      await processImage(config);
    });

    // Batch Processing tab logic
    document.getElementById('batchImages').addEventListener('change', (e) => {
      const preview = document.getElementById('batchPreview');
      preview.innerHTML = '';
      
      Array.from(e.target.files).forEach(file => {
        const reader = new FileReader();
        reader.onload = (e) => {
          const div = document.createElement('div');
          div.className = 'aspect-square bg-gray-100 rounded-lg overflow-hidden';
          div.innerHTML = `<img src="${e.target.result}" class="w-full h-full object-cover">`;
          preview.appendChild(div);
        };
        reader.readAsDataURL(file);
      });
    });

    document.getElementById('generateBatch').addEventListener('click', async () => {
      const files = document.getElementById('batchImages').files;
      if (files.length === 0) {
        alert('Please select at least one image');
        return;
      }

      const operation = document.getElementById('batchOperation').value;
      const config = {
        apiKey: document.getElementById('batchApiKey').value,
        model: document.getElementById('batchModel').value
      };

      inputMethods.classList.add('step-hidden');
      output.classList.remove('step-hidden');
      backButton.classList.remove('step-hidden');

      for (let i = 0; i < files.length; i++) {
        const reader = new FileReader();
        reader.onload = async (e) => {
          await processImage({
            ...config,
            image: e.target.result.split(',')[1],
            prompt: `${operation} of the original image`
          });
        };
        reader.readAsDataURL(files[i]);
      }
    });

    // Initialize template variables
    document.getElementById('templateSelect').dispatchEvent(new Event('change'));
  </script>
</body>
</html>