                        break;
                    case '4':
                        appState.currentStack = 'trash';
                        updateActiveProxTab();
                        gridView.open('trash');
                        break;
                    case 'i':
                    case 'I':
                        detailsModal.show();
                        break;
                }
            });
        }
        
        async function initApp() {
            try {
                utils.init();
                
                appState.fileCache = new EnhancedFileCache();
                await appState.fileCache.init();
                
                appState.cloudStorage = new CloudStorageModule();
                appState.metadataExtractor = new ProgressiveMetadataExtractor();
                appState.userMetadataManager = new OneDriveMetadataManager(appState.cloudStorage.currentProvider);
                
                if (appState.cloudStorage.isAuthenticated()) {
                    authManager.setStatus('Already connected to OneDrive', 'success');
                    setTimeout(() => {
                        utils.showScreen('folder-screen');
                        folderManager.loadFolders();
                    }, 1000);
                } else {
                    utils.elements.refreshFolders.onclick = () => folderManager.loadFolders();
                }
                
                setupEventHandlers();
                setupGestureSystem();
                setupPinchZoom();
                modalManager.setup();
                
                updateActiveProxTab();
                
            } catch (error) {
                utils.showToast('Failed to initialize app', 'error', true);
            }
        }
        
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
