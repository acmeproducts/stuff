<!DOCTYPE html>
<html lang="en" translate="no">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google" content="notranslate">
  <meta name="googlebot" content="notranslate">
  <title>Say Planning & Wireframe</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet">
  <style>
    :root {
      color-scheme: light;
      --bg: #f8fafc;
      --surface: #ffffff;
      --border: #e2e8f0;
      --muted: #94a3b8;
      --text: #0f172a;
      --accent: #2563eb;
      --accent-soft: #dbeafe;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --shadow: 0 18px 30px rgba(15, 23, 42, 0.08);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: 'Inter', system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
    }

    .app {
      max-width: 1200px;
      margin: 32px auto;
      padding: 0 24px 48px;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
      gap: 16px;
    }

    .title {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .title h1 {
      margin: 0;
      font-size: 28px;
      font-weight: 700;
    }

    .title span {
      color: var(--muted);
      font-size: 14px;
    }

    .status-pill {
      padding: 6px 12px;
      border-radius: 999px;
      background: var(--accent-soft);
      color: var(--accent);
      font-weight: 600;
      font-size: 12px;
    }

    .tabs {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 12px;
      margin-bottom: 24px;
    }

    .tab-btn {
      padding: 12px 16px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: var(--surface);
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .tab-btn.active {
      border-color: var(--accent);
      color: var(--accent);
      background: #eff6ff;
      box-shadow: var(--shadow);
    }

    .panel {
      display: none;
    }

    .panel.active {
      display: block;
    }

    .grid {
      display: grid;
      gap: 18px;
    }

    .grid.catalog {
      grid-template-columns: 280px minmax(0, 1fr);
    }

    .grid.use {
      grid-template-columns: minmax(0, 1fr) 320px;
    }

    .grid.settings {
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    }

    .header-meta {
      display: flex;
      flex-direction: column;
      gap: 6px;
      align-items: flex-end;
      text-align: right;
      font-size: 12px;
      color: var(--muted);
    }

    .header-meta a {
      color: var(--accent);
      font-weight: 600;
      text-decoration: none;
    }

    .log-panel {
      margin-top: 6px;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px dashed var(--border);
      background: #f8fafc;
      display: none;
      font-size: 12px;
      color: var(--text);
    }

    .log-panel.active { display: block; }

    .card {
      background: var(--surface);
      border-radius: 18px;
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
      padding: 18px;
    }

    .card h2 {
      margin: 0 0 12px;
      font-size: 18px;
    }

    .section-label {
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      color: var(--muted);
      margin-bottom: 8px;
    }

    .category-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .category-item {
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px;
      background: #f8fafc;
      cursor: pointer;
      display: grid;
      gap: 6px;
    }

    .category-item.active {
      border-color: var(--accent);
      background: #eff6ff;
    }

    .category-item strong {
      font-size: 14px;
    }

    .subcategory {
      font-size: 12px;
      color: var(--muted);
    }

    .controls {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
      gap: 12px;
      flex-wrap: wrap;
    }

    .control-group {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .toggle-group {
      display: inline-flex;
      border: 1px solid var(--border);
      border-radius: 999px;
      overflow: hidden;
      background: #f8fafc;
    }

    .toggle-btn {
      border: none;
      background: transparent;
      padding: 6px 12px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      color: var(--muted);
    }

    .toggle-btn.active {
      background: #eff6ff;
      color: var(--accent);
    }

    .chip {
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #f8fafc;
      font-size: 12px;
      font-weight: 600;
    }

    .chip.active { border-color: var(--accent); color: var(--accent); }

    .card-list {
      display: grid;
      gap: 12px;
    }

    .card-item {
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 12px 14px;
      display: grid;
      gap: 10px;
      background: #ffffff;
    }

    .card-item .meta {
      font-size: 12px;
      color: var(--muted);
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .card-item textarea {
      width: 100%;
      border: 1px solid transparent;
      border-radius: 8px;
      font-size: 14px;
      padding: 6px 8px;
      resize: vertical;
      min-height: 44px;
      font-family: inherit;
      background: #f8fafc;
    }

    .language-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
    }

    .language-block {
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 10px;
      background: #f8fafc;
      display: grid;
      gap: 8px;
    }

    .language-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      color: var(--muted);
    }

    .card-actions {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
    }

    .icon-btn {
      border: 1px solid var(--border);
      background: #f8fafc;
      border-radius: 10px;
      padding: 6px 8px;
      cursor: pointer;
      font-size: 14px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .icon-btn.active { border-color: var(--accent); color: var(--accent); }

    .icon-btn.small {
      padding: 4px 6px;
      font-size: 12px;
    }

    .card-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-top: 1px solid var(--border);
      padding-top: 10px;
      margin-top: 6px;
      font-size: 12px;
      color: var(--muted);
    }

    .footer-toggle {
      border: 1px solid var(--border);
      background: #f8fafc;
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 12px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
    }

    .back-translation {
      margin-top: 8px;
      padding: 8px 10px;
      border-radius: 10px;
      background: #f1f5f9;
      font-size: 12px;
      color: #475569;
      display: none;
    }

    .mindmap {
      border: 1px dashed var(--border);
      border-radius: 16px;
      padding: 16px;
      background: #f8fafc;
      display: none;
    }

    .mindmap.active { display: block; }

    .mindmap-body {
      display: grid;
      grid-template-columns: 180px minmax(0, 1fr);
      gap: 20px;
      align-items: center;
    }

    .mindmap-hub {
      width: 140px;
      height: 140px;
      border-radius: 50%;
      background: var(--surface);
      border: 2px solid var(--accent);
      display: grid;
      place-items: center;
      font-weight: 700;
      text-align: center;
      padding: 12px;
    }

    .mindmap-spokes {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 12px;
      position: relative;
    }

    .mindmap-node {
      position: relative;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: var(--surface);
      font-size: 12px;
      cursor: pointer;
    }

    .mindmap-node::before {
      content: '';
      position: absolute;
      left: -18px;
      top: 50%;
      width: 16px;
      height: 2px;
      background: var(--border);
    }

    .mindmap-popover {
      position: absolute;
      left: 10px;
      top: calc(100% + 8px);
      width: 220px;
      padding: 10px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: var(--surface);
      box-shadow: var(--shadow);
      display: none;
      z-index: 5;
    }

    .mindmap-node:hover .mindmap-popover,
    .mindmap-node.active .mindmap-popover {
      display: block;
    }

    .mindmap-popover p {
      margin: 0 0 6px;
      font-size: 12px;
    }

    .back-translation.visible { display: block; }

    .use-list {
      display: grid;
      gap: 12px;
    }

    .use-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 10px 12px;
    }

    .use-item small { color: var(--muted); }

    .history-item {
      display: grid;
      gap: 6px;
      border: 1px dashed var(--border);
      border-radius: 12px;
      padding: 10px 12px;
    }

    .history-item a {
      color: var(--accent);
      text-decoration: none;
      font-size: 12px;
    }

    .stepper {
      display: flex;
      gap: 10px;
      margin-bottom: 16px;
    }

    .step {
      flex: 1;
      border-radius: 12px;
      padding: 10px 12px;
      border: 1px solid var(--border);
      background: #f8fafc;
      font-size: 12px;
      font-weight: 600;
      text-align: center;
    }

    .step.active {
      border-color: var(--accent);
      color: var(--accent);
      background: #eff6ff;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 12px;
    }

    label {
      font-size: 12px;
      color: var(--muted);
      display: block;
      margin-bottom: 6px;
    }

    input,
    select {
      width: 100%;
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 8px 10px;
      font-size: 14px;
      font-family: inherit;
    }

    .primary-btn {
      border: none;
      background: var(--accent);
      color: white;
      font-weight: 600;
      border-radius: 10px;
      padding: 10px 16px;
      cursor: pointer;
    }

    .secondary-btn {
      border: 1px solid var(--border);
      background: #f8fafc;
      border-radius: 10px;
      padding: 10px 14px;
      cursor: pointer;
      font-weight: 600;
    }

    .notice {
      font-size: 12px;
      color: var(--muted);
    }

    .version-list {
      display: grid;
      gap: 8px;
    }

    .version-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 8px 10px;
      font-size: 12px;
    }

    footer {
      margin-top: 24px;
      font-size: 12px;
      color: var(--muted);
    }

    .floating-gear {
      position: fixed;
      right: 24px;
      bottom: 24px;
      width: 48px;
      height: 48px;
      border-radius: 50%;
      border: 1px solid var(--border);
      background: var(--surface);
      box-shadow: var(--shadow);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 20;
    }

    .modal {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.45);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 30;
      padding: 24px;
    }

    .modal.active { display: flex; }

    .modal-card {
      width: min(960px, 100%);
      max-height: 90vh;
      overflow: auto;
      background: var(--surface);
      border-radius: 20px;
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
      padding: 20px;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .modal-header h2 {
      margin: 0;
      font-size: 20px;
    }

    @media (max-width: 900px) {
      .grid.catalog,
      .grid.use { grid-template-columns: 1fr; }
      header { flex-direction: column; align-items: flex-start; gap: 8px; }
    }

    @media (max-width: 700px) {
      .language-grid { grid-template-columns: 1fr; }
      .mindmap-body { grid-template-columns: 1fr; }
      .mindmap-node::before { display: none; }
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="title">
        <h1>Say — Planning & Wireframe</h1>
        <span>Mockup aligned to chat.html patterns: language pair, voice controls, usage logging.</span>
      </div>
      <div class="header-meta">
        <span class="status-pill">Offline prototype</span>
        <div>Last used: 2 hours ago · <a href="#" id="logToggle">View log</a></div>
        <div class="log-panel" id="logPanel">Stub: Usage log toggled. Latest action: TTS playback.</div>
      </div>
    </header>

    <nav class="tabs" aria-label="Primary">
      <button class="tab-btn active" data-tab="catalog">Catalog</button>
      <button class="tab-btn" data-tab="use">Use</button>
      <button class="tab-btn" data-tab="curation">Curation</button>
    </nav>

    <!-- Single source of truth:
      - Card is atomic; copying to other categories/subcategories is allowed.
      - One-level subcategories only.
      - Topic cards are separate type; answers are cards chosen from category library.
      - Back-translation generated on creation; chevron reveals/refreshes.
      - Usage increments on TTS playback or back-translation reveal.
      - Sorting: alpha, last used, created, updated, priority; drag-and-drop only in custom/priority.
      - Favorites are catalog-scoped; history is global with deep links.
      - Export versioning keeps latest + last 5; merge default with replace option.
    -->

    <section class="panel active" id="catalog">
      <div class="grid catalog">
        <div class="card">
          <h2>Categories</h2>
          <div class="category-list" id="categoryList"></div>
        </div>
        <div class="card">
          <div class="controls">
            <div>
              <div class="section-label">Selected</div>
              <div id="selectedCategory">Travel → Airport</div>
            </div>
            <div class="control-group">
              <div class="toggle-group" role="group" aria-label="Catalog view">
                <button class="toggle-btn active" data-view="list">Card list</button>
                <button class="toggle-btn" data-view="mindmap">Mind map</button>
              </div>
            </div>
            <div class="control-group">
              <div class="toggle-group" role="group" aria-label="Language direction">
                <button class="toggle-btn active" data-direction="source-target">English → Spanish</button>
                <button class="toggle-btn" data-direction="target-source">Spanish → English</button>
              </div>
            </div>
            <div class="control-group">
              <label for="sortSelect" class="section-label" style="margin:0;">Sort</label>
              <select id="sortSelect" aria-label="Sort cards">
                <option>Alpha</option>
                <option>Last used</option>
                <option>Created</option>
                <option>Updated</option>
                <option>Priority</option>
              </select>
            </div>
            <button class="secondary-btn" id="addCardBtn">+ New card</button>
          </div>
          <div class="mindmap" id="mindmapView"></div>
          <div class="card-list" id="cardList"></div>
        </div>
      </div>
    </section>

    <section class="panel" id="use">
      <div class="grid use">
        <div class="card">
          <h2>Quick Speak</h2>
          <div class="controls">
            <div class="control-group">
              <span class="chip active">Travel</span>
              <span class="chip">Food</span>
              <span class="chip">Care</span>
            </div>
            <button class="secondary-btn" id="playLatestBtn">▶ Play latest</button>
          </div>
          <div class="use-list" id="favoriteList"></div>
        </div>
        <div class="card">
          <h2>History (global)</h2>
          <div class="notice">Time-scoped, deep links back to catalog cards.</div>
          <div class="use-list" id="historyList"></div>
        </div>
      </div>
    </section>

    <section class="panel" id="curation">
      <div class="card">
        <h2>Card Curation Flow</h2>
        <div class="stepper" id="curationStepper">
          <div class="step active" data-step="1">1. Draft</div>
          <div class="step" data-step="2">2. Translate</div>
          <div class="step" data-step="3">3. Classify</div>
          <div class="step" data-step="4">4. Priority</div>
        </div>
        <div class="form-grid">
          <div>
            <label for="sourceText">Source phrase</label>
            <input id="sourceText" value="Where is the baggage claim?">
          </div>
          <div>
            <label for="targetText">Target translation</label>
            <input id="targetText" value="¿Dónde está la cinta de equipaje?">
          </div>
          <div>
            <label for="backTranslation">Back-translation preview</label>
            <input id="backTranslation" value="Where is the luggage belt?">
          </div>
          <div>
            <label for="topicType">Card type</label>
            <select id="topicType">
              <option>Answer card</option>
              <option>Topic card</option>
            </select>
          </div>
          <div>
            <label for="categorySelect">Category</label>
            <select id="categorySelect">
              <option>Travel</option>
              <option>Food</option>
              <option>Care</option>
            </select>
          </div>
          <div>
            <label for="subcategorySelect">Subcategory</label>
            <select id="subcategorySelect">
              <option>Airport</option>
              <option>Hotel</option>
              <option>Street</option>
            </select>
          </div>
          <div>
            <label for="priority">Priority</label>
            <select id="priority">
              <option>Standard</option>
              <option>High</option>
              <option>Custom (manual order)</option>
            </select>
          </div>
        </div>
        <div class="controls" style="margin-top:16px;">
          <button class="secondary-btn" id="prevStep">Back</button>
          <button class="secondary-btn" id="autoTranslate">Auto-translate + preview</button>
          <button class="primary-btn" id="saveCard">Save card</button>
        </div>
      </div>
    </section>

    <footer>
      Prototype only. Events log to the console to represent persistence and usage tracking.
    </footer>
  </div>

  <button class="floating-gear" id="settingsOpen" aria-label="Open settings">
    <span class="material-symbols-outlined">settings</span>
  </button>

  <div class="modal" id="settingsModal" role="dialog" aria-modal="true" aria-labelledby="settingsTitle">
    <div class="modal-card">
      <div class="modal-header">
        <h2 id="settingsTitle">Settings</h2>
        <button class="icon-btn" id="settingsClose" aria-label="Close settings">
          <span class="material-symbols-outlined">close</span>
        </button>
      </div>
      <div class="grid settings">
        <div class="card">
          <h2>Language Pair</h2>
          <div class="form-grid">
            <div>
              <label for="sourceLang">Source</label>
              <select id="sourceLang">
                <option>English</option>
                <option>French</option>
                <option>Japanese</option>
              </select>
            </div>
            <div>
              <label for="targetLang">Target</label>
              <select id="targetLang">
                <option>Spanish</option>
                <option>Italian</option>
                <option>German</option>
              </select>
            </div>
          </div>
        </div>
        <div class="card">
          <h2>Voice per language</h2>
          <div class="form-grid">
            <div>
              <label for="sourceVoice">Source voice</label>
              <select id="sourceVoice">
                <option>Female · Warm</option>
                <option>Male · Crisp</option>
              </select>
            </div>
            <div>
              <label for="targetVoice">Target voice</label>
              <select id="targetVoice">
                <option>Female · Calm</option>
                <option>Male · Bright</option>
              </select>
            </div>
          </div>
        </div>
        <div class="card">
          <h2>Export / Import</h2>
          <p class="notice">Merge default, or replace entire catalog.</p>
          <div class="controls">
            <button class="secondary-btn">Export JSON</button>
            <button class="secondary-btn">Import (merge)</button>
            <button class="secondary-btn">Import (replace)</button>
          </div>
        </div>
        <div class="card">
          <h2>Versions</h2>
          <div class="version-list" id="versionList"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const categories = [
      {
        name: 'Travel',
        subcategories: ['Airport', 'Hotel', 'Street'],
        cards: [
          {
            id: 'travel-1',
            source: 'Where is the baggage claim?',
            target: '¿Dónde está la cinta de equipaje?',
            backTranslation: 'Where is the luggage belt?',
            usage: 24,
            favorite: true,
          },
          {
            id: 'travel-2',
            source: 'I need a taxi to the hotel.',
            target: 'Necesito un taxi al hotel.',
            backTranslation: 'I need a taxi to the hotel.',
            usage: 13,
            favorite: false,
          }
        ]
      },
      {
        name: 'Food',
        subcategories: ['Restaurant', 'Market'],
        cards: [
          {
            id: 'food-1',
            source: 'Do you have vegetarian options?',
            target: '¿Tiene opciones vegetarianas?',
            backTranslation: 'Do you have vegetarian options?',
            usage: 9,
            favorite: true,
          }
        ]
      },
      {
        name: 'Care',
        subcategories: ['Pharmacy', 'Clinic'],
        cards: [
          {
            id: 'care-1',
            source: 'I need a doctor.',
            target: 'Necesito un médico.',
            backTranslation: 'I need a doctor.',
            usage: 6,
            favorite: false,
          }
        ]
      }
    ];

    const history = [
      {
        id: 'travel-1',
        source: 'Where is the baggage claim?',
        target: '¿Dónde está la cinta de equipaje?',
        time: '2 hours ago',
        link: '#catalog?card=travel-1'
      },
      {
        id: 'food-1',
        source: 'Do you have vegetarian options?',
        target: '¿Tiene opciones vegetarianas?',
        time: 'Yesterday',
        link: '#catalog?card=food-1'
      }
    ];

    const versions = [
      { label: 'Latest (auto)', date: 'Today 09:12', status: 'Active' },
      { label: 'v1.14', date: 'Yesterday', status: 'Backup' },
      { label: 'v1.13', date: '2 days ago', status: 'Backup' },
      { label: 'v1.12', date: '3 days ago', status: 'Backup' },
      { label: 'v1.11', date: '4 days ago', status: 'Backup' },
      { label: 'v1.10', date: '5 days ago', status: 'Backup' }
    ];

    let activeCategoryIndex = 0;
    let languageDirection = 'source-target';
    let catalogView = 'list';

    const categoryList = document.getElementById('categoryList');
    const cardList = document.getElementById('cardList');
    const mindmapView = document.getElementById('mindmapView');
    const selectedCategory = document.getElementById('selectedCategory');
    const favoriteList = document.getElementById('favoriteList');
    const historyList = document.getElementById('historyList');
    const versionList = document.getElementById('versionList');

    function getLanguageConfig() {
      if (languageDirection === 'target-source') {
        return {
          primaryKey: 'target',
          secondaryKey: 'source',
          primaryLabel: 'Spanish',
          secondaryLabel: 'English',
          oppositeVoice: 'source'
        };
      }
      return {
        primaryKey: 'source',
        secondaryKey: 'target',
        primaryLabel: 'English',
        secondaryLabel: 'Spanish',
        oppositeVoice: 'target'
      };
    }

    function renderCategories() {
      categoryList.innerHTML = '';
      categories.forEach((category, index) => {
        const item = document.createElement('div');
        item.className = `category-item ${index === activeCategoryIndex ? 'active' : ''}`;
        item.innerHTML = `
          <strong>${category.name}</strong>
          <div class="subcategory">${category.subcategories.join(' · ')}</div>
        `;
        item.addEventListener('click', () => {
          activeCategoryIndex = index;
          renderCategories();
          renderCards();
        });
        categoryList.appendChild(item);
      });
    }

    function renderCards() {
      const category = categories[activeCategoryIndex];
      const languageConfig = getLanguageConfig();
      selectedCategory.textContent = `${category.name} → ${category.subcategories[0]}`;
      cardList.innerHTML = '';
      category.cards.forEach(card => {
        const primaryText = languageConfig.primaryKey === 'source' ? card.source : card.target;
        const secondaryText = languageConfig.secondaryKey === 'source' ? card.source : card.target;
        const cardItem = document.createElement('div');
        cardItem.className = 'card-item';
        cardItem.innerHTML = `
          <div>
            <div class="meta">Usage ${card.usage} · Card ID ${card.id}</div>
            <div class="language-grid">
              <div class="language-block">
                <div class="language-header">
                  ${languageConfig.primaryLabel}
                  <button class="icon-btn small" data-action="speak" data-id="${card.id}" data-voice="${languageConfig.primaryKey}">
                    <span class="material-symbols-outlined">volume_up</span>
                    Speak
                  </button>
                </div>
                <textarea>${primaryText}</textarea>
              </div>
              <div class="language-block">
                <div class="language-header">
                  ${languageConfig.secondaryLabel}
                  <button class="icon-btn small" data-action="speak" data-id="${card.id}" data-voice="${languageConfig.secondaryKey}">
                    <span class="material-symbols-outlined">volume_up</span>
                    Speak
                  </button>
                </div>
                <textarea>${secondaryText}</textarea>
              </div>
            </div>
            <div class="back-translation" id="bt-${card.id}">${card.backTranslation}</div>
            <div class="card-footer">
              <span>Back-translation preview</span>
              <button class="footer-toggle" data-action="back" data-id="${card.id}">
                <span class="material-symbols-outlined">expand_more</span>
                Reveal
              </button>
            </div>
          </div>
          <div class="card-actions">
            <button class="icon-btn ${card.favorite ? 'active' : ''}" data-action="favorite" data-id="${card.id}">
              <span class="material-symbols-outlined">star</span>
              Favorite
            </button>
          </div>
        `;
        cardItem.querySelectorAll('button').forEach(btn => {
          btn.addEventListener('click', () => handleCardAction(card, btn));
        });
        cardList.appendChild(cardItem);
      });
      renderFavorites();
      renderMindmap();
    }

    function handleCardAction(card, button) {
      const action = button.dataset.action;
      if (action === 'favorite') {
        card.favorite = !card.favorite;
        button.classList.toggle('active', card.favorite);
        renderFavorites();
        console.log('Favorite toggled', card.id, card.favorite);
      }
      if (action === 'back') {
        const panel = document.getElementById(`bt-${card.id}`);
        panel.classList.toggle('visible');
        card.usage += 1;
        renderCards();
        console.log('Back-translation reveal', card.id);
      }
      if (action === 'speak') {
        card.usage += 1;
        renderCards();
        console.log('TTS playback', card.id);
      }
    }

    function renderFavorites() {
      const category = categories[activeCategoryIndex];
      const favorites = category.cards.filter(card => card.favorite);
      favoriteList.innerHTML = '';
      favorites.forEach(card => {
        const item = document.createElement('div');
        item.className = 'use-item';
        item.innerHTML = `
          <div>
            <strong>${card.source}</strong>
            <small>${card.target}</small>
          </div>
          <div class="card-actions">
            <button class="icon-btn small" data-action="speak" data-id="${card.id}" data-voice="source">
              <span class="material-symbols-outlined">volume_up</span>
              Source
            </button>
            <button class="icon-btn small" data-action="speak" data-id="${card.id}" data-voice="target">
              <span class="material-symbols-outlined">volume_up</span>
              Target
            </button>
          </div>
        `;
        item.querySelectorAll('button').forEach(button => {
          button.addEventListener('click', () => handleCardAction(card, button));
        });
        favoriteList.appendChild(item);
      });
    }

    function renderMindmap() {
      const category = categories[activeCategoryIndex];
      const languageConfig = getLanguageConfig();
      const nodes = category.cards.map(card => {
        const primaryText = languageConfig.primaryKey === 'source' ? card.source : card.target;
        const secondaryText = languageConfig.secondaryKey === 'source' ? card.source : card.target;
        return `
          <div class="mindmap-node" data-id="${card.id}">
            <strong>${primaryText}</strong>
            <div class="mindmap-popover">
              <p><strong>${languageConfig.primaryLabel}:</strong> ${primaryText}</p>
              <p><strong>${languageConfig.secondaryLabel}:</strong> ${secondaryText}</p>
              <button class="icon-btn small" data-action="speak" data-id="${card.id}" data-voice="${languageConfig.oppositeVoice}">
                <span class="material-symbols-outlined">volume_up</span>
                Speak opposite
              </button>
            </div>
          </div>
        `;
      }).join('');

      mindmapView.innerHTML = `
        <div class="section-label">Summary mind map</div>
        <div class="mindmap-body">
          <div class="mindmap-hub">${category.name}</div>
          <div class="mindmap-spokes">${nodes}</div>
        </div>
      `;

      mindmapView.querySelectorAll('.mindmap-node').forEach(node => {
        node.addEventListener('click', () => {
          node.classList.toggle('active');
        });
      });

      mindmapView.querySelectorAll('button').forEach(button => {
        const card = category.cards.find(item => item.id === button.dataset.id);
        if (card) {
          button.addEventListener('click', event => {
            event.stopPropagation();
            handleCardAction(card, button);
          });
        }
      });
    }

    function renderHistory() {
      historyList.innerHTML = '';
      history.forEach(entry => {
        const item = document.createElement('div');
        item.className = 'history-item';
        item.innerHTML = `
          <strong>${entry.source}</strong>
          <small>${entry.target}</small>
          <div>${entry.time}</div>
          <a href="${entry.link}">Open in catalog</a>
        `;
        historyList.appendChild(item);
      });
    }

    function renderVersions() {
      versionList.innerHTML = '';
      versions.forEach(version => {
        const item = document.createElement('div');
        item.className = 'version-item';
        item.innerHTML = `
          <div>
            <strong>${version.label}</strong>
            <div>${version.date}</div>
          </div>
          <span>${version.status}</span>
        `;
        versionList.appendChild(item);
      });
    }

    function setupTabs() {
      const buttons = document.querySelectorAll('.tab-btn');
      const panels = document.querySelectorAll('.panel');
      buttons.forEach(button => {
        button.addEventListener('click', () => {
          buttons.forEach(btn => btn.classList.remove('active'));
          button.classList.add('active');
          panels.forEach(panel => panel.classList.remove('active'));
          document.getElementById(button.dataset.tab).classList.add('active');
        });
      });
    }

    function setupCatalogToggles() {
      const viewButtons = document.querySelectorAll('[data-view]');
      const directionButtons = document.querySelectorAll('[data-direction]');

      viewButtons.forEach(button => {
        button.addEventListener('click', () => {
          viewButtons.forEach(btn => btn.classList.remove('active'));
          button.classList.add('active');
          catalogView = button.dataset.view;
          updateCatalogView();
        });
      });

      directionButtons.forEach(button => {
        button.addEventListener('click', () => {
          directionButtons.forEach(btn => btn.classList.remove('active'));
          button.classList.add('active');
          languageDirection = button.dataset.direction;
          renderCards();
        });
      });
    }

    function updateCatalogView() {
      const isMindmap = catalogView === 'mindmap';
      mindmapView.classList.toggle('active', isMindmap);
      cardList.style.display = isMindmap ? 'none' : 'grid';
    }

    function setupModal() {
      const modal = document.getElementById('settingsModal');
      const openBtn = document.getElementById('settingsOpen');
      const closeBtn = document.getElementById('settingsClose');

      function openModal() {
        modal.classList.add('active');
      }

      function closeModal() {
        modal.classList.remove('active');
      }

      openBtn.addEventListener('click', openModal);
      closeBtn.addEventListener('click', closeModal);
      modal.addEventListener('click', event => {
        if (event.target === modal) {
          closeModal();
        }
      });
    }

    function setupCurationFlow() {
      const steps = Array.from(document.querySelectorAll('.step'));
      let currentStep = 1;

      function updateSteps() {
        steps.forEach(step => step.classList.toggle('active', Number(step.dataset.step) === currentStep));
      }

      document.getElementById('prevStep').addEventListener('click', () => {
        currentStep = Math.max(1, currentStep - 1);
        updateSteps();
      });

      document.getElementById('autoTranslate').addEventListener('click', () => {
        currentStep = Math.min(4, currentStep + 1);
        document.getElementById('targetText').value = '¿Dónde está el reclamo de equipaje?';
        document.getElementById('backTranslation').value = 'Where is the baggage claim?';
        updateSteps();
        console.log('Auto-translate step');
      });

      document.getElementById('saveCard').addEventListener('click', () => {
        currentStep = 1;
        updateSteps();
        console.log('Card saved');
      });

      updateSteps();
    }

    document.getElementById('addCardBtn').addEventListener('click', () => {
      alert('Stub: open card creation flow.');
    });

    document.getElementById('playLatestBtn').addEventListener('click', () => {
      const category = categories[activeCategoryIndex];
      if (category.cards.length) {
        category.cards[0].usage += 1;
        renderCards();
        console.log('Play latest', category.cards[0].id);
      }
    });

    document.getElementById('logToggle').addEventListener('click', event => {
      event.preventDefault();
      document.getElementById('logPanel').classList.toggle('active');
      console.log('Usage log toggled');
    });

    setupTabs();
    setupCatalogToggles();
    updateCatalogView();
    setupModal();
    setupCurationFlow();
    renderCategories();
    renderCards();
    renderHistory();
    renderVersions();
  </script>
</body>
</html>
