<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Venice AI Image Generator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background-color: #f3f4f6;
      min-height: 100vh;
      margin: 0;
      padding: 1rem;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
    }

    .step-hidden {
      display: none !important;
    }
    
    .download-btn {
      position: absolute;
      bottom: 8px;
      right: 8px;
      background-color: rgba(14, 165, 233, 0.9);
      color: white;
      padding: 6px 12px;
      border-radius: 6px;
      display: flex;
      align-items: center;
      gap: 4px;
      opacity: 0;
      transition: opacity 0.2s ease;
    }

    .image-container:hover .download-btn {
      opacity: 1;
    }

    .image-container {
      position: relative;
      overflow: hidden;
      border-radius: 8px;
      background-color: #f3f4f6;
      aspect-ratio: 1;
    }

    .generated-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      border-radius: 8px;
    }

    .progress-bar {
      width: 100%;
      height: 4px;
      background-color: #e5e7eb;
      border-radius: 2px;
      overflow: hidden;
    }

    .progress-bar-fill {
      height: 100%;
      background-color: #3b82f6;
      transition: width 0.3s ease;
    }

    .log-entry {
      padding: 8px;
      margin-bottom: 4px;
      border-radius: 4px;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 4px solid #f3f4f6;
      border-top: 4px solid #3b82f6;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .loading-overlay {
      position: absolute;
      inset: 0;
      background-color: rgba(255, 255, 255, 0.9);
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      gap: 1rem;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }

    .loading-overlay.active {
      opacity: 1;
      pointer-events: auto;
    }

    .tab-active {
      border-bottom: 2px solid #3b82f6;
      color: #3b82f6;
    }

    .input-group {
      opacity: 0;
      transform: translateY(10px);
      transition: all 0.3s ease;
      display: none;
    }

    .input-group.active {
      opacity: 1;
      transform: translateY(0);
      display: block;
    }

    .drag-drop-zone {
      border: 2px dashed #e5e7eb;
      transition: all 0.3s ease;
    }

    .drag-drop-zone.drag-over {
      border-color: #3b82f6;
      background-color: #eff6ff;
    }

    .csv-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }

    .csv-table th,
    .csv-table td {
      border: 1px solid #e5e7eb;
      padding: 8px;
      text-align: left;
    }

    .csv-table th {
      background-color: #f8fafc;
    }

    .csv-table td input {
      width: 100%;
      padding: 4px;
      border: 1px solid transparent;
      border-radius: 4px;
      transition: all 0.2s ease;
    }

    .csv-table td input:focus {
      border-color: #3b82f6;
      outline: none;
      box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
    }

    .back-btn {
      position: fixed;
      top: 1rem;
      left: 1rem;
      z-index: 50;
    }

    .template-item {
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
      transition: all 0.2s ease;
    }

    .template-item:hover {
      border-color: #3b82f6;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .negative-prompt-item {
      background-color: #f3f4f6;
      border-radius: 4px;
      padding: 0.5rem;
      margin: 0.25rem;
      display: inline-block;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .negative-prompt-item:hover {
      background-color: #e5e7eb;
    }

    .negative-prompt-item.selected {
      background-color: #3b82f6;
      color: white;
    }
  </style>
</head>
<body>
  <button id="backButton" class="back-btn bg-white px-4 py-2 rounded-lg shadow-md hover:bg-gray-50 transition-colors step-hidden">
    ‚Üê Back
  </button>

  <div class="container">
    <div id="inputMethods" class="bg-white rounded-lg shadow-lg p-8 mb-8">
      <h2 class="text-2xl font-bold mb-6">Venice AI Image Generator</h2>
      
      <div class="flex border-b mb-6">
        <button class="px-4 py-2 tab-active" data-tab="prompt">Text Prompt</button>
        <button class="px-4 py-2" data-tab="variations">Variations</button>
        <button class="px-4 py-2" data-tab="templates">Templates</button>
        <button class="px-4 py-2" data-tab="negative">Negative Prompts</button>
        <button class="px-4 py-2" data-tab="batch">Batch Process</button>
      </div>

      <!-- Text Prompt Tab -->
      <div id="promptInput" class="input-group active">
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2" for="apiKey">API Key</label>
            <input type="password" id="apiKey" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2" for="model">Model</label>
            <select id="model" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
              <option value="venice-sd35">venice-sd35</option>
              <option value="fluently-xl">fluently-xl</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2" for="prompt">Prompt</label>
            <textarea id="prompt" rows="4" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Enter your prompt here"></textarea>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2" for="negativePrompt">Negative Prompt</label>
            <textarea id="negativePrompt" rows="2" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Enter negative prompt here"></textarea>
          </div>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2" for="seed">Seed</label>
              <input type="number" id="seed" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Random if empty">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2" for="cfgScale">CFG Scale</label>
              <input type="number" id="cfgScale" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" value="7" min="1" max="20">
            </div>
          </div>
          <button id="generate" class="w-full bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600 transition-colors">Generate Image</button>
        </div>
      </div>

      <!-- Variations Tab -->
      <div id="variationsInput" class="input-group">
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2" for="variationsApiKey">API Key</label>
            <input type="password" id="variationsApiKey" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2" for="variationsModel">Model</label>
            <select id="variationsModel" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
              <option value="venice-sd35">venice-sd35</option>
              <option value="fluently-xl">fluently-xl</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2" for="variationsPrompt">Prompt</label>
            <textarea id="variationsPrompt" rows="4" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Enter your prompt here"></textarea>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2" for="variationsCount">Number of Variations</label>
            <input type="number" id="variationsCount" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" value="4" min="1" max="10">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2" for="variationsSeedStart">Starting Seed</label>
            <input type="number" id="variationsSeedStart" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Random if empty">
          </div>
          <button id="generateVariations" class="w-full bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600 transition-colors">Generate Variations</button>
        </div>
      </div>

      <!-- Templates Tab -->
      <div id="templatesInput" class="input-group">
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2" for="templatesApiKey">API Key</label>
            <input type="password" id="templatesApiKey" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2" for="templateSelect">Select Template</label>
            <select id="templateSelect" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
              <option value="portrait">Portrait Photography</option>
              <option value="landscape">Landscape Photography</option>
              <option value="product">Product Photography</option>
              <option value="concept">Concept Art</option>
              <option value="custom">Custom Template</option>
            </select>
          </div>
          <div id="templateFields" class="space-y-4">
            <!-- Template fields will be dynamically inserted here -->
          </div>
          <div id="customTemplateEditor" class="hidden space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2" for="customTemplate">Custom Template</label>
              <textarea id="customTemplate" rows="4" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Use {variable} for replaceable parts"></textarea>
            </div>
            <button id="saveTemplate" class="px-4 py-2 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors">Save Template</button>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Preview</label>
            <div id="templatePreview" class="bg-gray-50 p-4 rounded-lg text-sm"></div>
          </div>
          <button id="generateTemplate" class="w-full bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600 transition-colors">Generate Image</button>
        </div>
      </div>

      <!-- Negative Prompts Tab -->
      <div id="negativeInput" class="input-group">
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2" for="negativeApiKey">API Key</label>
            <input type="password" id="negativeApiKey" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2" for="negativePromptInput">Prompt</label>
            <textarea id="negativePromptInput" rows="4" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Enter your prompt here"></textarea>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Common Negative Prompts</label>
            <div id="negativePromptLibrary" class="flex flex-wrap gap-2">
              <!-- Negative prompts will be dynamically inserted here -->
            </div>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Selected Negative Prompts</label>
            <textarea id="selectedNegativePrompts" rows="4" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" readonly></textarea>
          </div>
          <button id="generateNegative" class="w-full bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600 transition-colors">Generate Image</button>
        </div>
      </div>

      <!-- Batch Process Tab -->
      <div id="batchInput" class="input-group">
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2" for="batchApiKey">API Key</label>
            <input type="password" id="batchApiKey" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2" for="batchPrompts">Prompts (one per line)</label>
            <textarea id="batchPrompts" rows="8" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Enter your prompts here, one per line"></textarea>
          </div>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2" for="batchInterval">Interval (seconds)</label>
              <input type="number" id="batchInterval" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" value="5" min="1">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2" for="batchConcurrent">Concurrent Jobs</label>
              <input type="number" id="batchConcurrent" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" value="2" min="1" max="5">
            </div>
          </div>
          <button id="generateBatch" class="w-full bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600 transition-colors">Start Batch Process</button>
        </div>
      </div>
    </div>

    <div id="output" class="step-hidden">
      <div class="bg-white rounded-lg shadow-lg p-8">
        <h2 class="text-2xl font-bold mb-6">Generated Images</h2>
        <div id="progressContainer" class="mb-4 hidden">
          <div class="flex justify-between text-sm text-gray-600 mb-2">
            <span>Progress</span>
            <span id="progressText">0/1</span>
          </div>
          <div class="progress-bar">
            <div id="progressBarFill" class="progress-bar-fill" style="width: 0%"></div>
          </div>
        </div>
        <div id="logContainer" class="bg-gray-50 p-4 rounded-lg space-y-2 max-h-60 overflow-y-auto"></div>
        <div id="imageContainer" class="mt-8 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
      </div>
    </div>
  </div>

  <script>
    // Templates data
    const templates = {
      portrait: {
        template: "Professional {style} portrait of {subject}, {lighting} lighting, {background}",
        fields: {
          style: ["studio", "environmental", "candid", "dramatic"],
          subject: "Enter subject description",
          lighting: ["natural", "dramatic", "soft", "high-key"],
          background: "Enter background description"
        }
      },
      landscape: {
        template: "{time} landscape of {location}, {weather} conditions, {style} style",
        fields: {
          time: ["sunrise", "daylight", "sunset", "night"],
          location: "Enter location",
          weather: ["clear", "cloudy", "stormy", "misty"],
          style: ["photorealistic", "painterly", "cinematic"]
        }
      },
      product: {
        template: "{product} on {background}, {lighting} lighting, {angle} angle",
        fields: {
          product: "Enter product description",
          background: ["white seamless", "environmental", "studio"],
          lighting: ["soft", "dramatic", "high-key"],
          angle: ["front", "three-quarter", "side", "top-down"]
        }
      },
      concept: {
        template: "Concept art of {subject} in {style} style, {mood} atmosphere",
        fields: {
          subject: "Enter subject",
          style: ["sci-fi", "fantasy", "steampunk", "cyberpunk"],
          mood: ["dark", "vibrant", "mysterious", "peaceful"]
        }
      }
    };

    // Negative prompts library
    const negativePrompts = [
      "blurry",
      "low quality",
      "bad anatomy",
      "watermark",
      "signature",
      "deformed",
      "distorted",
      "ugly",
      "duplicate",
      "morbid",
      "mutilated",
      "extra limbs",
      "poorly drawn face",
      "mutation",
      "deformed",
      "bad proportions",
      "extra fingers",
      "cloned face",
      "disfigured",
      "gross proportions",
      "malformed limbs",
      "missing arms",
      "missing legs",
      "extra arms",
      "extra legs",
      "fused fingers",
      "too many fingers",
      "long neck",
      "username",
      "watermark",
      "signature",
      "text",
      "copyright",
      "low contrast",
      "overexposed",
      "underexposed"
    ];

    // Initialize negative prompts library
    const negativePromptLibrary = document.getElementById('negativePromptLibrary');
    negativePrompts.forEach(prompt => {
      const promptElement = document.createElement('div');
      promptElement.className = 'negative-prompt-item';
      promptElement.textContent = prompt;
      promptElement.addEventListener('click', () => toggleNegativePrompt(promptElement));
      negativePromptLibrary.appendChild(promptElement);
    });

    // Toggle negative prompt selection
    function toggleNegativePrompt(element) {
      element.classList.toggle('selected');
      updateSelectedNegativePrompts();
    }

    // Update selected negative prompts
    function updateSelectedNegativePrompts() {
      const selected = document.querySelectorAll('.negative-prompt-item.selected');
      const prompts = Array.from(selected).map(el => el.textContent);
      document.getElementById('selectedNegativePrompts').value = prompts.join(', ');
    }

    // Initialize template fields
    function initializeTemplateFields(templateId) {
      const template = templates[templateId];
      if (!template) return;

      const container = document.getElementById('templateFields');
      container.innerHTML = '';

      Object.entries(template.fields).forEach(([field, options]) => {
        const fieldContainer = document.createElement('div');
        
        const label = document.createElement('label');
        label.className = 'block text-sm font-medium text-gray-700 mb-2';
        label.textContent = field.charAt(0).toUpperCase() + field.slice(1);
        
        const input = Array.isArray(options) 
          ? createSelect(field, options)
          : createInput(field, options);
        
        fieldContainer.appendChild(label);
        fieldContainer.appendChild(input);
        container.appendChild(fieldContainer);
      });

      updateTemplatePreview();
    }

    // Create select element for template fields
    function createSelect(field, options) {
      const select = document.createElement('select');
      select.className = 'w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500';
      select.dataset.field = field;
      
      options.forEach(option => {
        const optionElement = document.createElement('option');
        optionElement.value = option;
        optionElement.textContent = option.charAt(0).toUpperCase() + option.slice(1);
        select.appendChild(optionElement);
      });
      
      select.addEventListener('change', updateTemplatePreview);
      return select;
    }

    // Create input element for template fields
    function createInput(field, placeholder) {
      const input = document.createElement('input');
      input.type = 'text';
      input.className = 'w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500';
      input.placeholder = placeholder;
      input.dataset.field = field;
      input.addEventListener('input', updateTemplatePreview);
      return input;
    }

    // Update template preview
    function updateTemplatePreview() {
      const templateId = document.getElementById('templateSelect').value;
      const template = templates[templateId];
      if (!template) return;

      let preview = template.template;
      const fields = document.querySelectorAll('#templateFields [data-field]');
      
      fields.forEach(field => {
        const value = field.value || field.placeholder;
        preview = preview.replace(`{${field.dataset.field}}`, value);
      });

      document.getElementById('templatePreview').textContent = preview;
    }

    // Initialize template selector
    document.getElementById('templateSelect').addEventListener('change', (e) => {
      const customEditor = document.getElementById('customTemplateEditor');
      customEditor.classList.toggle('hidden', e.target.value !== 'custom');
      
      if (e.target.value !== 'custom') {
        initializeTemplateFields(e.target.value);
      }
    });

    // Initialize first template
    initializeTemplateFields('portrait');

    // Tabs functionality
    const tabs = document.querySelectorAll('[data-tab]');
    const inputGroups = document.querySelectorAll('.input-group');
    
    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        tabs.forEach(t => t.classList.remove('tab-active'));
        tab.classList.add('tab-active');
        
        inputGroups.forEach(group => {
          group.classList.remove('active');
          if (group.id === `${tab.dataset.tab}Input`) {
            group.classList.add('active');
          }
        });
      });
    });

    // Back button functionality
    const backButton = document.getElementById('backButton');
    const inputMethods = document.getElementById('inputMethods');
    const output = document.getElementById('output');
    
    backButton.addEventListener('click', () => {
      output.classList.add('step-hidden');
      inputMethods.classList.remove('step-hidden');
      backButton.classList.add('step-hidden');
      document.getElementById('imageContainer').innerHTML = '';
    });

    // Image generation functionality
    async function generateImage(config) {
      try {
        const response = await fetch('https://api.venice.ai/api/v1/image/generate', {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${config.apiKey}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            model: config.model || 'venice-sd35',
            prompt: config.prompt,
            negative_prompt: config.negativePrompt,
            seed: config.seed || Math.floor(Math.random() * 1000000),
            width: config.width || 1024,
            height: config.height || 1024,
            steps: config.steps || 30,
            cfg_scale: config.cfgScale || 7,
            hide_watermark: true,
            safe_mode: false
          })
        });

        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        const blob = await response.blob();
        const imageUrl = URL.createObjectURL(blob);
        
        const container = document.createElement('div');
        container.className = 'relative';
        
        const img = document.createElement('img');
        img.src = imageUrl;
        img.className = 'w-full rounded-lg';
        
        container.appendChild(img);
        document.getElementById('imageContainer').appendChild(container);
        
        return true;
      } catch (error) {
        console.error('Error:', error);
        return false;
      }
    }

    // Event listeners for generate buttons
    document.getElementById('generate').addEventListener('click', async () => {
      const config = {
        apiKey: document.getElementById('apiKey').value,
        model: document.getElementById('model').value,
        prompt: document.getElementById('prompt').value,
        negativePrompt: document.getElementById('negativePrompt').value,
        seed: document.getElementById('seed').value,
        cfgScale: document.getElementById('cfgScale').value
      };

      inputMethods.classList.add('step-hidden');
      output.classList.remove('step-hidden');
      backButton.classList.remove('step-hidden');

      await generateImage(config);
    });

    document.getElementById('generateVariations').addEventListener('click', async () => {
      const config = {
        apiKey: document.getElementById('variationsApiKey').value,
        model: document.getElementById('variationsModel').value,
        prompt: document.getElementById('variationsPrompt').value,
        count: parseInt(document.getElementById('variationsCount').value),
        seedStart: document.getElementById('variationsSeedStart').value
      };

      inputMethods.classList.add('step-hidden');
      output.classList.remove('step-hidden');
      backButton.classList.remove('step-hidden');

      for (let i = 0; i < config.count; i++) {
        const seed = config.seedStart ? parseInt(config.seedStart) + i : Math.floor(Math.random() * 1000000);
        await generateImage({
          ...config,
          seed
        });
      }
    });

    document.getElementById('generateTemplate').addEventListener('click', async () => {
      const templateId = document.getElementById('templateSelect').value;
      const template = templates[templateId];
      
      let prompt;
      if (templateId === 'custom') {
        prompt = document.getElementById('customTemplate').value;
      } else {
        prompt = document.getElementById('templatePreview').textContent;
      }

      const config = {
        apiKey: document.getElementById('templatesApiKey').value,
        prompt
      };

      inputMethods.classList.add('step-hidden');
      output.classList.remove('step-hidden');
      backButton.classList.remove('step-hidden');

      await generateImage(config);
    });

    document.getElementById('generateNegative').addEventListener('click', async () => {
      const config = {
        apiKey: document.getElementById('negativeApiKey').value,
        prompt: document.getElementById('negativePromptInput').value,
        negativePrompt: document.getElementById('selectedNegativePrompts').value
      };

      inputMethods.classList.add('step-hidden');
      output.classList.remove('step-hidden');
      backButton.classList.remove('step-hidden');

      await generateImage(config);
    });

    document.getElementById('generateBatch').addEventListener('click', async () => {
      const prompts = document.getElementById('batchPrompts').value
        .split('\n')
        .map(p => p.trim())
        .filter(p => p);
      
      const config = {
        apiKey: document.getElementById('batchApiKey').value,
        interval: parseInt(document.getElementById('batchInterval').value) * 1000,
        concurrent: parseInt(document.getElementById('batchConcurrent').value)
      };

      inputMethods.classList.add('step-hidden');
      output.classList.remove('step-hidden');
      backButton.classList.remove('step-hidden');

      // Process prompts in batches
      for (let i = 0; i < prompts.length; i += config.concurrent) {
        const batch = prompts.slice(i, i + config.concurrent);
        await Promise.all(batch.map(prompt => generateImage({ ...config, prompt })));
        if (i + config.concurrent < prompts.length) {
          await new Promise(resolve => setTimeout(resolve, config.interval));
        }
      }
    });
  </script>
</body>
</html>