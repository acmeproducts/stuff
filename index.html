<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Venice AI Image Generator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background-color: #f3f4f6;
      min-height: 100vh;
      margin: 0;
      padding: 1rem;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
    }

    .step-hidden {
      display: none !important;
    }
    
    .download-btn {
      position: absolute;
      bottom: 8px;
      right: 8px;
      background-color: rgba(14, 165, 233, 0.9);
      color: white;
      padding: 6px 12px;
      border-radius: 6px;
      display: flex;
      align-items: center;
      gap: 4px;
      opacity: 0;
      transition: opacity 0.2s ease;
    }

    .image-container:hover .download-btn {
      opacity: 1;
    }

    .image-container {
      position: relative;
      overflow: hidden;
      border-radius: 8px;
      background-color: #f3f4f6;
      aspect-ratio: 1;
    }

    .generated-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      border-radius: 8px;
    }

    .progress-bar {
      width: 100%;
      height: 4px;
      background-color: #e5e7eb;
      border-radius: 2px;
      overflow: hidden;
    }

    .progress-bar-fill {
      height: 100%;
      background-color: #3b82f6;
      transition: width 0.3s ease;
    }

    .log-entry {
      padding: 8px;
      margin-bottom: 4px;
      border-radius: 4px;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 4px solid #f3f4f6;
      border-top: 4px solid #3b82f6;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .loading-overlay {
      position: absolute;
      inset: 0;
      background-color: rgba(255, 255, 255, 0.9);
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      gap: 1rem;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }

    .loading-overlay.active {
      opacity: 1;
      pointer-events: auto;
    }

    .tab-active {
      border-bottom: 2px solid #3b82f6;
      color: #3b82f6;
    }

    .input-group {
      opacity: 0;
      transform: translateY(10px);
      transition: all 0.3s ease;
      display: none;
    }

    .input-group.active {
      opacity: 1;
      transform: translateY(0);
      display: block;
    }

    .drag-drop-zone {
      border: 2px dashed #e5e7eb;
      transition: all 0.3s ease;
    }

    .drag-drop-zone.drag-over {
      border-color: #3b82f6;
      background-color: #eff6ff;
    }

    .csv-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }

    .csv-table th,
    .csv-table td {
      border: 1px solid #e5e7eb;
      padding: 8px;
      text-align: left;
    }

    .csv-table th {
      background-color: #f8fafc;
    }

    .csv-table td input {
      width: 100%;
      padding: 4px;
      border: 1px solid transparent;
      border-radius: 4px;
      transition: all 0.2s ease;
    }

    .csv-table td input:focus {
      border-color: #3b82f6;
      outline: none;
      box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
    }

    .back-btn {
      position: fixed;
      top: 1rem;
      left: 1rem;
      z-index: 50;
    }

    .template-item {
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
      transition: all 0.2s ease;
    }

    .template-item:hover {
      border-color: #3b82f6;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .negative-prompt-item {
      background-color: #f3f4f6;
      border-radius: 4px;
      padding: 0.5rem;
      margin: 0.25rem;
      display: inline-block;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .negative-prompt-item:hover {
      background-color: #e5e7eb;
    }

    .negative-prompt-item.selected {
      background-color: #3b82f6;
      color: white;
    }
  </style>
</head>
<body>
  <button id="backButton" class="back-btn bg-white px-4 py-2 rounded-lg shadow-md hover:bg-gray-50 transition-colors step-hidden">
    ‚Üê Back
  </button>

  <div class="container">
    <div id="inputMethods" class="bg-white rounded-lg shadow-lg p-8 mb-8">
      <h2 class="text-2xl font-bold mb-6">Venice AI Image Generator</h2>
      
      <div class="flex border-b mb-6">
        <button class="px-4 py-2 tab-active" data-tab="prompt">Text Prompt</button>
        <button class="px-4 py-2" data-tab="multi">Multi</button>
        <button class="px-4 py-2" data-tab="csv">CSV Upload</button>
        <button class="px-4 py-2" data-tab="variations">Variations</button>
        <button class="px-4 py-2" data-tab="templates">Templates</button>
        <button class="px-4 py-2" data-tab="negative">Negative Prompts</button>
        <button class="px-4 py-2" data-tab="batch">Batch Process</button>
        <button class="px-4 py-2" data-tab="api">API</button>
      </div>

      <!-- Previous tab content remains unchanged -->
      
      <!-- Add debug mode toggle to all tabs -->
      <div class="mt-4 flex items-center gap-2">
        <input type="checkbox" id="debugMode" class="rounded border-gray-300 text-blue-500 focus:ring-blue-500">
        <label for="debugMode" class="text-sm text-gray-700">Enable Debug Mode</label>
      </div>
    </div>

    <div id="output" class="step-hidden">
      <!-- Previous output content remains unchanged -->
      <div id="debugContainer" class="mt-4">
        <button id="downloadLogs" class="px-4 py-2 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors hidden">
          Download Debug Logs
        </button>
      </div>
    </div>
  </div>

  <script>
    // Previous JavaScript code remains unchanged
    
    // Add debug logging
    let debugMode = false;
    let debugLogs = [];

    document.getElementById('debugMode').addEventListener('change', (e) => {
      debugMode = e.target.checked;
      document.getElementById('downloadLogs').classList.toggle('hidden', !debugMode);
    });

    function addDebugLog(data) {
      if (debugMode) {
        debugLogs.push({
          timestamp: new Date().toISOString(),
          ...data
        });
      }
    }

    document.getElementById('downloadLogs').addEventListener('click', () => {
      const blob = new Blob([JSON.stringify(debugLogs, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `venice-ai-debug-logs-${new Date().toISOString()}.json`;
      link.click();
    });

    // Update image generation to include full API payload in metadata
    async function generateImage(config) {
      try {
        const apiPayload = {
          model: config.model || 'venice-sd35',
          prompt: config.prompt,
          negative_prompt: config.negativePrompt,
          seed: config.seed || Math.floor(Math.random() * 1000000),
          width: config.width || 1024,
          height: config.height || 1024,
          steps: config.steps || 30,
          cfg_scale: config.cfgScale || 7,
          hide_watermark: true,
          safe_mode: false
        };

        if (debugMode) {
          addDebugLog({
            type: 'api_request',
            payload: apiPayload
          });
        }

        const response = await fetch('https://api.venice.ai/api/v1/image/generate', {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${config.apiKey}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(apiPayload)
        });

        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        const blob = await response.blob();
        
        // Add metadata including full API payload
        const metadata = {
          timestamp: new Date().toISOString(),
          api_call: JSON.stringify(apiPayload),
          ...apiPayload
        };

        if (debugMode) {
          addDebugLog({
            type: 'metadata',
            data: metadata
          });
        }

        const imageUrl = URL.createObjectURL(blob);
        
        // Create image container with metadata
        const container = document.createElement('div');
        container.className = 'image-container';
        
        const img = document.createElement('img');
        img.src = imageUrl;
        img.className = 'generated-image';
        img.dataset.metadata = JSON.stringify(metadata);
        
        container.appendChild(img);
        
        // Add download button with metadata
        const downloadBtn = document.createElement('button');
        downloadBtn.className = 'download-btn';
        downloadBtn.innerHTML = 'Download';
        downloadBtn.onclick = () => {
          const link = document.createElement('a');
          link.href = imageUrl;
          link.download = `venice-ai-${metadata.seed}-${new Date().getTime()}.png`;
          link.click();
        };
        
        container.appendChild(downloadBtn);
        document.getElementById('imageContainer').appendChild(container);
        
        return true;
      } catch (error) {
        if (debugMode) {
          addDebugLog({
            type: 'error',
            message: error.message
          });
        }
        console.error('Error:', error);
        return false;
      }
    }

    // Previous event listeners and functionality remain unchanged
  </script>
</body>
</html>