
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Orbital8 - Test Entry</title>
<style>
  body { background: #121212; color: #fff; font-family: Arial, sans-serif; margin: 0; padding: 20px; }
  #entry-screen { text-align: center; }
  h1 { color: #0f0; }
  .btn { background: #0f0; color: #000; padding: 10px 20px; cursor: pointer; border: none; font-size: 16px; margin-top: 20px; }
</style>
</head>
<body>
<div id="entry-screen">
  <h1>Hello, here are the changes implemented:</h1>
  <ol style="text-align:left;display:inline-block;">
    <li>Integrated full metadata extraction using Google Drive API binary download.</li>
    <li>On-screen green debug logs for each metadata extraction step.</li>
    <li>Metadata saved to local appData and retrieved for display.</li>
    <li>Display of extracted metadata in a table on the metadata tab.</li>
    <li>Direct trigger of metadata extraction on window load for immediate execution.</li>
  </ol>
  <button class="btn" onclick="continueToApp()">Continue to Full App</button>
</div>
<iframe id="app-frame" src="" style="display:none;width:100%;height:100vh;border:none;"></iframe>
<script>
function continueToApp() {
  document.getElementById('entry-screen').style.display = 'none';
  const iframe = document.getElementById('app-frame');
  iframe.src = 'data:text/html;base64,PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KPGhlYWQ+CiAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEuMCwgdmlld3BvcnQtZml0PWNvdmVyLCB1c2VyLXNjYWxhYmxlPW5vLCBtYXhpbXVtLXNjYWxlPTEuMCI+CiAgICA8bWV0YSBuYW1lPSJhcHBsZS1tb2JpbGUtd2ViLWFwcC1jYXBhYmxlIiBjb250ZW50PSJ5ZXMiPgogICAgPG1ldGEgbmFtZT0iYXBwbGUtbW9iaWxlLXdlYi1hcHAtc3RhdHVzLWJhci1zdHlsZSIgY29udGVudD0iYmxhY2stdHJhbnNsdWNlbnQiPgogICAgPHRpdGxlPk9yYml0YWw4IC0gRml4ZWQgJiBTaW1wbGlmaWVkPC90aXRsZT4KICAgIDxzdHlsZT4KICAgICAgICA6cm9vdCB7CiAgICAgICAgICAgIC0tYXBwLWFjY2VudDogI2Y1OWUwYjsKICAgICAgICB9CgogICAgICAgICogeyBib3gtc2l6aW5nOiBib3JkZXItYm94OyB9CiAgICAgICAgCiAgICAgICAgYm9keSwgaHRtbCB7CiAgICAgICAgICAgIG1hcmdpbjogMDsgcGFkZGluZzogMDsgaGVpZ2h0OiAxMDAlOwogICAgICAgICAgICBmb250LWZhbWlseTogLWFwcGxlLXN5c3RlbSwgQmxpbmtNYWNTeXN0ZW1Gb250LCAnU2Vnb2UgVUknLCBSb2JvdG8sIHNhbnMtc2VyaWY7CiAgICAgICAgICAgIG92ZXJmbG93OiBoaWRkZW47IGJhY2tncm91bmQ6ICMwMDA7CiAgICAgICAgICAgIG92ZXJzY3JvbGwtYmVoYXZpb3I6IG5vbmU7IHRvdWNoLWFjdGlvbjogbm9uZTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLyogPT09PT0gU2NyZWVuIFN0eWxlcyA9PT09PSAqLwogICAgICAgIC5zY3JlZW4gewogICAgICAgICAgICBwb3NpdGlvbjogZml4ZWQ7IGluc2V0OiAwOwogICAgICAgICAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoMTM1ZGVnLCAjMGYwZjBmIDAlLCAjMWExYTFhIDEwMCUpOwogICAgICAgICAgICBkaXNwbGF5OiBmbGV4OyBmbGV4LWRpcmVjdGlvbjogY29sdW1uOyBhbGlnbi1pdGVtczogY2VudGVyOyBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICAgICAgICAgICAgei1pbmRleDogMTAwMDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLnNjcmVlbi5oaWRkZW4geyBkaXNwbGF5OiBub25lOyB9CiAgICAgICAgCiAgICAgICAgLmNhcmQgewogICAgICAgICAgICBiYWNrZ3JvdW5kOiByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMSk7IGJhY2tkcm9wLWZpbHRlcjogYmx1cigyMHB4KTsKICAgICAgICAgICAgYm9yZGVyOiAxcHggc29saWQgcmdiYSgyNDUsIDE1OCwgMTEsIDAuMyk7IGJvcmRlci1yYWRpdXM6IDIwcHg7CiAgICAgICAgICAgIHBhZGRpbmc6IDQwcHg7IHRleHQtYWxpZ246IGNlbnRlcjsgbWF4LXdpZHRoOiA1MDBweDsgd2lkdGg6IDkwJTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLnRpdGxlIHsKICAgICAgICAgICAgY29sb3I6IHdoaXRlOyBmb250LXNpemU6IDI0cHg7IGZvbnQtd2VpZ2h0OiA2MDA7IG1hcmdpbi1ib3R0b206IDE2cHg7CiAgICAgICAgICAgIHRleHQtc2hhZG93OiAwIDJweCA0cHggcmdiYSgwLCAwLCAwLCAwLjgpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAuc3VidGl0bGUgewogICAgICAgICAgICBjb2xvcjogcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjcpOyBmb250LXNpemU6IDE2cHg7IG1hcmdpbi1ib3R0b206IDI0cHg7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC5pbnB1dCB7CiAgICAgICAgICAgIHdpZHRoOiAxMDAlOyBwYWRkaW5nOiAxMnB4IDE2cHg7CiAgICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoMjU1LCAyNTUsIDI1NSwgMC4zKTsgYm9yZGVyLXJhZGl1czogMTJweDsKICAgICAgICAgICAgYmFja2dyb3VuZDogcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjEpOyBjb2xvcjogd2hpdGU7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMTRweDsgbWFyZ2luLWJvdHRvbTogMTZweDsgYmFja2Ryb3AtZmlsdGVyOiBibHVyKDEwcHgpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAuaW5wdXQ6OnBsYWNlaG9sZGVyIHsgY29sb3I6IHJnYmEoMjU1LCAyNTUsIDI1NSwgMC41KTsgfQogICAgICAgIC5pbnB1dDpmb2N1cyB7CiAgICAgICAgICAgIG91dGxpbmU6IG5vbmU7IGJvcmRlci1jb2xvcjogdmFyKC0tYXBwLWFjY2VudCk7CiAgICAgICAgICAgIGJveC1zaGFkb3c6IDAgMCAwIDJweCByZ2JhKDI0NSwgMTU4LCAxMSwgMC4yKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLmJ1dHRvbiB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCg0NWRlZywgdmFyKC0tYXBwLWFjY2VudCksICNkOTc3MDYpOwogICAgICAgICAgICBib3JkZXI6IG5vbmU7IGJvcmRlci1yYWRpdXM6IDE1cHg7IGNvbG9yOiB3aGl0ZTsKICAgICAgICAgICAgZm9udC1zaXplOiAxOHB4OyBmb250LXdlaWdodDogNjAwOyBwYWRkaW5nOiAxNnB4IDMycHg7CiAgICAgICAgICAgIGN1cnNvcjogcG9pbnRlcjsgdHJhbnNpdGlvbjogYWxsIDAuM3MgZWFzZTsKICAgICAgICAgICAgYm94LXNoYWRvdzogMCA0cHggMjBweCByZ2JhKDI0NSwgMTU4LCAxMSwgMC40KTsKICAgICAgICAgICAgd2lkdGg6IDEwMCU7IG1hcmdpbi1ib3R0b206IDE2cHg7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC5idXR0b246aG92ZXI6bm90KDpkaXNhYmxlZCkgewogICAgICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTJweCk7CiAgICAgICAgICAgIGJveC1zaGFkb3c6IDAgNnB4IDI1cHggcmdiYSgyNDUsIDE1OCwgMTEsIDAuNik7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC5idXR0b246ZGlzYWJsZWQgeyBvcGFjaXR5OiAwLjU7IGN1cnNvcjogbm90LWFsbG93ZWQ7IHRyYW5zZm9ybTogbm9uZTsgfQogICAgICAgIAogICAgICAgIC5zdGF0dXMgewogICAgICAgICAgICBwYWRkaW5nOiAxMnB4OyBib3JkZXItcmFkaXVzOiA4cHg7IG1hcmdpbi10b3A6IDE2cHg7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMTRweDsgZm9udC13ZWlnaHQ6IDUwMDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLnN0YXR1cy5zdWNjZXNzIHsKICAgICAgICAgICAgYmFja2dyb3VuZDogcmdiYSgxNiwgMTg1LCAxMjksIDAuMik7IGNvbG9yOiAjMTBiOTgxOwogICAgICAgICAgICBib3JkZXI6IDFweCBzb2xpZCByZ2JhKDE2LCAxODUsIDEyOSwgMC4zKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLnN0YXR1cy5lcnJvciB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IHJnYmEoMjM5LCA2OCwgNjgsIDAuMik7IGNvbG9yOiAjZWY0NDQ0OwogICAgICAgICAgICBib3JkZXI6IDFweCBzb2xpZCByZ2JhKDIzOSwgNjgsIDY4LCAwLjMpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAuc3RhdHVzLmluZm8gewogICAgICAgICAgICBiYWNrZ3JvdW5kOiByZ2JhKDU5LCAxMzAsIDI0NiwgMC4yKTsgY29sb3I6ICMzYjgyZjY7CiAgICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoNTksIDEzMCwgMjQ2LCAwLjMpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvKiA9PT09PSBGb2xkZXIgTGlzdCA9PT09PSAqLwogICAgICAgIC5mb2xkZXItbGlzdCB7CiAgICAgICAgICAgIGZsZXg6IDE7IG92ZXJmbG93LXk6IGF1dG87IG1hcmdpbi1ib3R0b206IDIwcHg7IG1heC1oZWlnaHQ6IDQwMHB4OwogICAgICAgIH0KICAgICAgICAKICAgICAgICAuZm9sZGVyLWl0ZW0gewogICAgICAgICAgICBkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogY2VudGVyOyBwYWRkaW5nOiAxMnB4IDE2cHg7IG1hcmdpbi1ib3R0b206IDhweDsKICAgICAgICAgICAgYmFja2dyb3VuZDogcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjA1KTsgYm9yZGVyOiAxcHggc29saWQgcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjEpOwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiAxMnB4OyBjdXJzb3I6IHBvaW50ZXI7IHRyYW5zaXRpb246IGFsbCAwLjJzIGVhc2U7IGNvbG9yOiB3aGl0ZTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLmZvbGRlci1pdGVtOmhvdmVyIHsKICAgICAgICAgICAgYmFja2dyb3VuZDogcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjEpOwogICAgICAgICAgICBib3JkZXItY29sb3I6IHJnYmEoMjQ1LCAxNTgsIDExLCAwLjMpOyB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTFweCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC5mb2xkZXItaWNvbiB7CiAgICAgICAgICAgIHdpZHRoOiAyMHB4OyBoZWlnaHQ6IDIwcHg7IG1hcmdpbi1yaWdodDogMTJweDsgY29sb3I6IHZhcigtLWFwcC1hY2NlbnQpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAuZm9sZGVyLWluZm8geyBmbGV4OiAxOyB9CiAgICAgICAgLmZvbGRlci1uYW1lIHsgZm9udC13ZWlnaHQ6IDUwMDsgbWFyZ2luLWJvdHRvbTogMnB4OyB9CiAgICAgICAgLmZvbGRlci1kYXRlIHsgZm9udC1zaXplOiAxMnB4OyBjb2xvcjogcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjYpOyB9CiAgICAgICAgCiAgICAgICAgLmZvbGRlci1sb2FkaW5nIHsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IGNlbnRlcjsganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICAgICAgICAgIHBhZGRpbmc6IDQwcHg7IGNvbG9yOiByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuNyk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC5zcGlubmVyIHsKICAgICAgICAgICAgd2lkdGg6IDIwcHg7IGhlaWdodDogMjBweDsgYm9yZGVyOiAycHggc29saWQgcmdiYSgyNDUsIDE1OCwgMTEsIDAuMyk7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDUwJTsgYm9yZGVyLXRvcC1jb2xvcjogdmFyKC0tYXBwLWFjY2VudCk7CiAgICAgICAgICAgIGFuaW1hdGlvbjogc3BpbiAxcyBsaW5lYXIgaW5maW5pdGU7IG1hcmdpbi1yaWdodDogMTJweDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgQGtleWZyYW1lcyBzcGluIHsgdG8geyB0cmFuc2Zvcm06IHJvdGF0ZSgzNjBkZWcpOyB9IH0KICAgICAgICAKICAgICAgICAuZm9sZGVyLWFjdGlvbnMgeyBkaXNwbGF5OiBmbGV4OyBnYXA6IDEycHg7IH0KICAgICAgICAKICAgICAgICAuZm9sZGVyLWJ1dHRvbiB7CiAgICAgICAgICAgIGZsZXg6IDE7IHBhZGRpbmc6IDEycHggMjRweDsKICAgICAgICAgICAgYm9yZGVyOiAxcHggc29saWQgcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjMpOyBib3JkZXItcmFkaXVzOiAxMnB4OwogICAgICAgICAgICBiYWNrZ3JvdW5kOiByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMSk7IGNvbG9yOiB3aGl0ZTsKICAgICAgICAgICAgZm9udC1zaXplOiAxNHB4OyBjdXJzb3I6IHBvaW50ZXI7IHRyYW5zaXRpb246IGFsbCAwLjJzIGVhc2U7CiAgICAgICAgICAgIGJhY2tkcm9wLWZpbHRlcjogYmx1cigxMHB4KTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLmZvbGRlci1idXR0b246aG92ZXIgewogICAgICAgICAgICBiYWNrZ3JvdW5kOiByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMik7IHRyYW5zZm9ybTogdHJhbnNsYXRlWSgtMXB4KTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLmZvbGRlci1idXR0b24uZGFuZ2VyIHsKICAgICAgICAgICAgYm9yZGVyLWNvbG9yOiByZ2JhKDIzOSwgNjgsIDY4LCAwLjMpOyBjb2xvcjogI2VmNDQ0NDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLmZvbGRlci1idXR0b24uZGFuZ2VyOmhvdmVyIHsgYmFja2dyb3VuZDogcmdiYSgyMzksIDY4LCA2OCwgMC4xKTsgfQogICAgICAgIAogICAgICAgIC8qID09PT09IExvYWRpbmcgU2NyZWVuID09PT09ICovCiAgICAgICAgLmxvYWRpbmctY291bnRlciB7CiAgICAgICAgICAgIGNvbG9yOiB2YXIoLS1hcHAtYWNjZW50KTsgZm9udC1zaXplOiA0OHB4OyBmb250LXdlaWdodDogNzAwOwogICAgICAgICAgICBtYXJnaW46IDIwcHggMDsgdGV4dC1zaGFkb3c6IDAgMnB4IDRweCByZ2JhKDAsIDAsIDAsIDAuOCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC5sb2FkaW5nLW1lc3NhZ2UgewogICAgICAgICAgICBjb2xvcjogcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjcpOyBmb250LXNpemU6IDE2cHg7IG1hcmdpbi1ib3R0b206IDIwcHg7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC5sb2FkaW5nLXByb2dyZXNzIHsKICAgICAgICAgICAgd2lkdGg6IDEwMCU7IGhlaWdodDogNnB4OyBiYWNrZ3JvdW5kOiByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMik7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDNweDsgb3ZlcmZsb3c6IGhpZGRlbjsgbWFyZ2luLWJvdHRvbTogMjBweDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLmxvYWRpbmctcHJvZ3Jlc3MtYmFyIHsKICAgICAgICAgICAgaGVpZ2h0OiAxMDAlOyBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoNDVkZWcsIHZhcigtLWFwcC1hY2NlbnQpLCAjZDk3NzA2KTsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogM3B4OyB0cmFuc2l0aW9uOiB3aWR0aCAwLjNzIGVhc2U7IHdpZHRoOiAwJTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLyogPT09PT0gTWFpbiBBcHAgPT09PT0gKi8KICAgICAgICAuYXBwLWNvbnRhaW5lciB7CiAgICAgICAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsgd2lkdGg6IDEwMHZ3OyBoZWlnaHQ6IDEwMHZoOwogICAgICAgICAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoMTM1ZGVnLCAjMGYwZjBmIDAlLCAjMWExYTFhIDEwMCUpOwogICAgICAgICAgICBvdmVyZmxvdzogaGlkZGVuOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAubmF2LWJ1dHRvbiB7CiAgICAgICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsgdG9wOiAyMHB4OyBiYWNrZ3JvdW5kOiByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMSk7CiAgICAgICAgICAgIGJhY2tkcm9wLWZpbHRlcjogYmx1cigxMHB4KTsgYm9yZGVyOiAxcHggc29saWQgcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjIpOwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiAyMHB4OyBwYWRkaW5nOiA4cHggMTJweDsgZm9udC1zaXplOiAxMXB4OwogICAgICAgICAgICBjb2xvcjogd2hpdGU7IGN1cnNvcjogcG9pbnRlcjsgdHJhbnNpdGlvbjogYWxsIDAuM3MgZWFzZTsKICAgICAgICAgICAgei1pbmRleDogMTU7IGRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiBjZW50ZXI7IGdhcDogNnB4OyBvcGFjaXR5OiAwLjc7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC5uYXYtYnV0dG9uOmhvdmVyIHsgb3BhY2l0eTogMTsgYmFja2dyb3VuZDogcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjIpOyB9CiAgICAgICAgLm5hdi1idXR0b24uYmFjayB7IGxlZnQ6IDIwcHg7IH0KICAgICAgICAubmF2LWJ1dHRvbi5kZXRhaWxzIHsgcmlnaHQ6IDIwcHg7IH0KICAgICAgICAKICAgICAgICAuaW1hZ2Utdmlld3BvcnQgewogICAgICAgICAgICBwb3NpdGlvbjogYWJzb2x1dGU7IGluc2V0OiAwOyBkaXNwbGF5OiBmbGV4OwogICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOyBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsgei1pbmRleDogMTsgb3ZlcmZsb3c6IGhpZGRlbjsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLmNlbnRlci1pbWFnZSB7CiAgICAgICAgICAgIG1heC13aWR0aDogMTAwdnc7IG1heC1oZWlnaHQ6IDEwMHZoOyB3aWR0aDogYXV0bzsgaGVpZ2h0OiBhdXRvOwogICAgICAgICAgICBvYmplY3QtZml0OiBjb250YWluOyB1c2VyLXNlbGVjdDogbm9uZTsgcG9pbnRlci1ldmVudHM6IG5vbmU7CiAgICAgICAgICAgIHRyYW5zaXRpb246IGFsbCAwLjNzIGN1YmljLWJlemllcigwLjI1LCAwLjQ2LCAwLjQ1LCAwLjk0KSwgb3BhY2l0eSAwLjJzIGVhc2U7CiAgICAgICAgICAgIHRyYW5zZm9ybS1vcmlnaW46IGNlbnRlciBjZW50ZXI7IGN1cnNvcjogZ3JhYjsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLmNlbnRlci1pbWFnZS5kcmFnZ2luZyB7IGZpbHRlcjogYnJpZ2h0bmVzcygwLjkpOyBjdXJzb3I6IGdyYWJiaW5nOyB9CiAgICAgICAgLmNlbnRlci1pbWFnZS56b29tYWJsZSB7IHBvaW50ZXItZXZlbnRzOiBhdXRvOyB9CiAgICAgICAgCiAgICAgICAgLmVkZ2UtZ2xvdyB7CiAgICAgICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsgb3BhY2l0eTogMDsgdHJhbnNpdGlvbjogb3BhY2l0eSAwLjJzIGVhc2U7IHotaW5kZXg6IDI7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC5lZGdlLWdsb3cudG9wIHsKICAgICAgICAgICAgdG9wOiAwOyBsZWZ0OiAwOyByaWdodDogMDsgaGVpZ2h0OiA4cHg7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxODBkZWcsIHJnYmEoMjQ1LCAxNTgsIDExLCAwLjQpIDAlLCB0cmFuc3BhcmVudCAxMDAlKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLmVkZ2UtZ2xvdy5ib3R0b20gewogICAgICAgICAgICBib3R0b206IDA7IGxlZnQ6IDA7IHJpZ2h0OiAwOyBoZWlnaHQ6IDhweDsKICAgICAgICAgICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDBkZWcsIHJnYmEoMjQ1LCAxNTgsIDExLCAwLjQpIDAlLCB0cmFuc3BhcmVudCAxMDAlKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLmVkZ2UtZ2xvdy5sZWZ0IHsKICAgICAgICAgICAgdG9wOiAwOyBsZWZ0OiAwOyBib3R0b206IDA7IHdpZHRoOiA4cHg7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCg5MGRlZywgcmdiYSgyNDUsIDE1OCwgMTEsIDAuNCkgMCUsIHRyYW5zcGFyZW50IDEwMCUpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAuZWRnZS1nbG93LnJpZ2h0IHsKICAgICAgICAgICAgdG9wOiAwOyByaWdodDogMDsgYm90dG9tOiAwOyB3aWR0aDogOHB4OwogICAgICAgICAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoMjcwZGVnLCByZ2JhKDI0NSwgMTU4LCAxMSwgMC40KSAwJSwgdHJhbnNwYXJlbnQgMTAwJSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC5lZGdlLWdsb3cuYWN0aXZlIHsgb3BhY2l0eTogMTsgfQogICAgICAgIAogICAgICAgIC8qID09PT09IFBpbGwgQ291bnRlcnMgPT09PT0gKi8KICAgICAgICAucGlsbC1jb3VudGVyIHsKICAgICAgICAgICAgcG9zaXRpb246IGZpeGVkOyBiYWNrZHJvcC1maWx0ZXI6IGJsdXIoMTBweCk7IGJvcmRlci1yYWRpdXM6IDIwcHg7CiAgICAgICAgICAgIHBhZGRpbmc6IDEycHggMjBweDsgZm9udC1zaXplOiAxOHB4OyBmb250LXdlaWdodDogNTAwOyBjb2xvcjogYmxhY2s7CiAgICAgICAgICAgIG9wYWNpdHk6IDA7IHRyYW5zaXRpb246IGFsbCAwLjNzIGVhc2U7IGN1cnNvcjogcG9pbnRlcjsgei1pbmRleDogMTA7CiAgICAgICAgICAgIG1pbi13aWR0aDogNTBweDsgdGV4dC1hbGlnbjogY2VudGVyOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAucGlsbC1jb3VudGVyLnZpc2libGUgeyBvcGFjaXR5OiAwLjk7IH0KICAgICAgICAucGlsbC1jb3VudGVyLmFjdGl2ZSB7CiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiA3MDA7IGJhY2tncm91bmQ6IHdoaXRlOyBvcGFjaXR5OiAxOyBib3JkZXI6IDNweCBzb2xpZCBibGFjazsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLnBpbGwtY291bnRlcjpub3QoLmFjdGl2ZSkgeyBiYWNrZ3JvdW5kOiByZ2JhKDEyOCwgMTI4LCAxMjgsIDAuNCk7IGJvcmRlcjogbm9uZTsgfQogICAgICAgIC5waWxsLWNvdW50ZXI6aG92ZXIgeyBvcGFjaXR5OiAxOyB0cmFuc2Zvcm06IHNjYWxlKDEuMDUpOyB9CiAgICAgICAgCiAgICAgICAgLnBpbGwtY291bnRlci50b3AgeyB0b3A6IDEwcHg7IGxlZnQ6IDUwJTsgdHJhbnNmb3JtOiB0cmFuc2xhdGVYKC01MCUpOyB9CiAgICAgICAgLnBpbGwtY291bnRlci5ib3R0b20geyBib3R0b206IDYwcHg7IGxlZnQ6IDUwJTsgdHJhbnNmb3JtOiB0cmFuc2xhdGVYKC01MCUpOyB9CiAgICAgICAgLnBpbGwtY291bnRlci5sZWZ0IHsgbGVmdDogMTBweDsgdG9wOiA1MCU7IHRyYW5zZm9ybTogdHJhbnNsYXRlWSgtNTAlKTsgfQogICAgICAgIC5waWxsLWNvdW50ZXIucmlnaHQgeyByaWdodDogMTBweDsgdG9wOiA1MCU7IHRyYW5zZm9ybTogdHJhbnNsYXRlWSgtNTAlKTsgfQogICAgICAgIAogICAgICAgIC8qID09PT09IFJpcHBsZSBFZmZlY3RzID09PT09ICovCiAgICAgICAgLnBpbGwtY291bnRlcjo6YmVmb3JlLCAucGlsbC1jb3VudGVyOjphZnRlciB7CiAgICAgICAgICAgIGNvbnRlbnQ6ICcnOyBwb3NpdGlvbjogYWJzb2x1dGU7IGJvcmRlcjogMnB4IHNvbGlkIHJnYmEoMjQ1LCAxNTgsIDExLCAwLjgpOwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiAxNnB4OyBvcGFjaXR5OiAwOyBwb2ludGVyLWV2ZW50czogbm9uZTsgei1pbmRleDogLTE7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC5waWxsLWNvdW50ZXIudHJpcGxlLXJpcHBsZTo6YmVmb3JlIHsgYW5pbWF0aW9uOiB0cmlwbGVSaXBwbGUxIDEuNXMgZWFzZS1vdXQ7IH0KICAgICAgICAucGlsbC1jb3VudGVyLnRyaXBsZS1yaXBwbGU6OmFmdGVyIHsgYW5pbWF0aW9uOiB0cmlwbGVSaXBwbGUyIDEuNXMgZWFzZS1vdXQgMC4yczsgfQogICAgICAgIC5waWxsLWNvdW50ZXIudHJpcGxlLXJpcHBsZSB7IGFuaW1hdGlvbjogdHJpcGxlUmlwcGxlMyAxLjVzIGVhc2Utb3V0IDAuNHM7IH0KICAgICAgICAKICAgICAgICAucGlsbC1jb3VudGVyLmdsb3ctZWZmZWN0IHsKICAgICAgICAgICAgYm94LXNoYWRvdzogMCAwIDI1cHggcmdiYSgyNDUsIDE1OCwgMTEsIDAuOCksIDAgMCA1MHB4IHJnYmEoMjQ1LCAxNTgsIDExLCAwLjYpOwogICAgICAgICAgICBhbmltYXRpb246IHN1c3RhaW5lZEdsb3cgMXMgZWFzZS1vdXQgMS41czsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgQGtleWZyYW1lcyB0cmlwbGVSaXBwbGUxIHsKICAgICAgICAgICAgMCUgeyBvcGFjaXR5OiAwLjk7IHRyYW5zZm9ybTogc2NhbGUoMSk7IHRvcDogLTRweDsgbGVmdDogLTRweDsgcmlnaHQ6IC00cHg7IGJvdHRvbTogLTRweDsgfQogICAgICAgICAgICAxMDAlIHsgb3BhY2l0eTogMDsgdHJhbnNmb3JtOiBzY2FsZSgyKTsgdG9wOiAtMjBweDsgbGVmdDogLTIwcHg7IHJpZ2h0OiAtMjBweDsgYm90dG9tOiAtMjBweDsgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICBAa2V5ZnJhbWVzIHRyaXBsZVJpcHBsZTIgewogICAgICAgICAgICAwJSB7IG9wYWNpdHk6IDAuNzsgdHJhbnNmb3JtOiBzY2FsZSgxKTsgdG9wOiAtNnB4OyBsZWZ0OiAtNnB4OyByaWdodDogLTZweDsgYm90dG9tOiAtNnB4OyB9CiAgICAgICAgICAgIDEwMCUgeyBvcGFjaXR5OiAwOyB0cmFuc2Zvcm06IHNjYWxlKDIuNSk7IHRvcDogLTMwcHg7IGxlZnQ6IC0zMHB4OyByaWdodDogLTMwcHg7IGJvdHRvbTogLTMwcHg7IH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgQGtleWZyYW1lcyB0cmlwbGVSaXBwbGUzIHsKICAgICAgICAgICAgMCUgeyBib3gtc2hhZG93OiAwIDAgMTBweCByZ2JhKDI0NSwgMTU4LCAxMSwgMC41KTsgfQogICAgICAgICAgICA1MCUgeyBib3gtc2hhZG93OiAwIDAgMjBweCByZ2JhKDI0NSwgMTU4LCAxMSwgMC44KTsgfQogICAgICAgICAgICAxMDAlIHsgYm94LXNoYWRvdzogMCAwIDE1cHggcmdiYSgyNDUsIDE1OCwgMTEsIDAuNik7IH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgQGtleWZyYW1lcyBzdXN0YWluZWRHbG93IHsKICAgICAgICAgICAgMCUgeyBib3gtc2hhZG93OiAwIDAgMjVweCByZ2JhKDI0NSwgMTU4LCAxMSwgMC44KSwgMCAwIDUwcHggcmdiYSgyNDUsIDE1OCwgMTEsIDAuNik7IH0KICAgICAgICAgICAgNTAlIHsgYm94LXNoYWRvdzogMCAwIDM1cHggcmdiYSgyNDUsIDE1OCwgMTEsIDEpLCAwIDAgNzBweCByZ2JhKDI0NSwgMTU4LCAxMSwgMC44KTsgfQogICAgICAgICAgICAxMDAlIHsgYm94LXNoYWRvdzogMCAwIDEwcHggcmdiYSgyNDUsIDE1OCwgMTEsIDAuNCk7IH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLyogPT09PT0gRW1wdHkgU3RhdGUgPT09PT0gKi8KICAgICAgICAuZW1wdHktc3RhdGUgewogICAgICAgICAgICBwb3NpdGlvbjogYWJzb2x1dGU7IHRvcDogNTAlOyBsZWZ0OiA1MCU7IHRyYW5zZm9ybTogdHJhbnNsYXRlKC01MCUsIC01MCUpOwogICAgICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7IGNvbG9yOiByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuNyk7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMThweDsgZm9udC13ZWlnaHQ6IDMwMDsgdGV4dC1zaGFkb3c6IDAgMnB4IDRweCByZ2JhKDAsIDAsIDAsIDAuOCk7IHotaW5kZXg6IDU7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC5lbXB0eS1tZXNzYWdlIHsgbWFyZ2luLWJvdHRvbTogMjBweDsgZm9udC1zaXplOiAyNHB4OyBmb250LXdlaWdodDogNDAwOyB9CiAgICAgICAgCiAgICAgICAgLm5ldy1pbWFnZXMtYnV0dG9uIHsKICAgICAgICAgICAgYmFja2dyb3VuZDogcmdiYSgyNDUsIDE1OCwgMTEsIDAuMik7IGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoMjQ1LCAxNTgsIDExLCAwLjQpOwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiAyMHB4OyBwYWRkaW5nOiAxMnB4IDI0cHg7IGNvbG9yOiB3aGl0ZTsKICAgICAgICAgICAgZm9udC1zaXplOiAxNnB4OyBjdXJzb3I6IHBvaW50ZXI7IHRyYW5zaXRpb246IGFsbCAwLjJzIGVhc2U7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC5uZXctaW1hZ2VzLWJ1dHRvbjpob3ZlciB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IHJnYmEoMjQ1LCAxNTgsIDExLCAwLjQpOyB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTJweCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8qID09PT09IEdyaWQgTW9kYWwgPT09PT0gKi8KICAgICAgICAubW9kYWwgewogICAgICAgICAgICBwb3NpdGlvbjogZml4ZWQ7IGluc2V0OiAwOyBiYWNrZ3JvdW5kLWNvbG9yOiByZ2JhKDAsIDAsIDAsIDAuNSk7CiAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiBjZW50ZXI7IGp1c3RpZnktY29udGVudDogY2VudGVyOyB6LWluZGV4OiA1MDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLm1vZGFsLmhpZGRlbiB7IGRpc3BsYXk6IG5vbmUgIWltcG9ydGFudDsgfQogICAgICAgIAogICAgICAgIC5tb2RhbC1jb250ZW50IHsKICAgICAgICAgICAgYmFja2dyb3VuZDogd2hpdGU7IGJvcmRlci1yYWRpdXM6IDhweDsgYm94LXNoYWRvdzogMCA0cHggNnB4IHJnYmEoMCwgMCwgMCwgMC4xKTsKICAgICAgICAgICAgd2lkdGg6IDEwMCU7IGhlaWdodDogMTAwJTsgbWF4LXdpZHRoOiAxMTUycHg7IG1heC1oZWlnaHQ6IDkwdmg7CiAgICAgICAgICAgIG1hcmdpbjogMTZweDsgZGlzcGxheTogZmxleDsgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLm1vZGFsLWhlYWRlciB7CiAgICAgICAgICAgIHBvc2l0aW9uOiBzdGlja3k7IHRvcDogMDsgYmFja2dyb3VuZDogd2hpdGU7IHotaW5kZXg6IDEwOwogICAgICAgICAgICBib3JkZXItYm90dG9tOiAxcHggc29saWQgI2U1ZTdlYjsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLm1vZGFsLWhlYWRlci1tYWluIHsKICAgICAgICAgICAgcGFkZGluZzogMTZweDsgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICNmM2Y0ZjY7CiAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiBjZW50ZXI7IGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLm1vZGFsLWhlYWRlci1sZWZ0IHsgZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IGNlbnRlcjsgZ2FwOiAxMnB4OyB9CiAgICAgICAgCiAgICAgICAgLm1vZGFsLXRpdGxlIHsKICAgICAgICAgICAgZm9udC1zaXplOiAyMHB4OyBmb250LXdlaWdodDogNTAwOyBjb2xvcjogIzFmMjkzNzsgbGluZS1oZWlnaHQ6IDEuNTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLnNlbGVjdC1hbGwtYnRuIHsKICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogI2U1ZTdlYjsgY29sb3I6ICM0YjU1NjM7IHBhZGRpbmc6IDJweCA4cHg7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDk5OTlweDsgZm9udC1zaXplOiAxNHB4OyBmb250LXdlaWdodDogNTAwOwogICAgICAgICAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7IG1pbi13aWR0aDogMzZweDsgdGV4dC1hbGlnbjogY2VudGVyOwogICAgICAgICAgICBjdXJzb3I6IHBvaW50ZXI7IHRyYW5zaXRpb246IGJhY2tncm91bmQtY29sb3IgMC4yczsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLnNlbGVjdC1hbGwtYnRuOmhvdmVyIHsgYmFja2dyb3VuZC1jb2xvcjogI2QxZDVkYjsgfQogICAgICAgIAogICAgICAgIC5jbG9zZS1idG4gewogICAgICAgICAgICBjb2xvcjogIzZiNzI4MDsgdHJhbnNpdGlvbjogYWxsIDAuMnM7IGN1cnNvcjogcG9pbnRlcjsKICAgICAgICAgICAgYmFja2dyb3VuZDogdHJhbnNwYXJlbnQ7IGJvcmRlcjogbm9uZTsgYm9yZGVyLXJhZGl1czogNnB4OwogICAgICAgICAgICBwYWRkaW5nOiA0cHg7IGRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiBjZW50ZXI7IGp1c3RpZnktY29udGVudDogY2VudGVyOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAuY2xvc2UtYnRuOmhvdmVyIHsgY29sb3I6ICMzNzQxNTE7IGJhY2tncm91bmQ6IHJnYmEoMCwgMCwgMCwgMC4wNSk7IH0KICAgICAgICAuY2xvc2UtYnRuIHN2ZyB7IHdpZHRoOiAyNHB4OyBoZWlnaHQ6IDI0cHg7IH0KICAgICAgICAKICAgICAgICAuc2VsZWN0aW9uLWluZm8tcm93IHsKICAgICAgICAgICAgcGFkZGluZzogOHB4IDE2cHg7IGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjZjNmNGY2OwogICAgICAgICAgICBtaW4taGVpZ2h0OiA0OHB4OyBkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAuc2VsZWN0aW9uLWluZm8geyBkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogY2VudGVyOyBnYXA6IDhweDsgfQogICAgICAgIAogICAgICAgIC5zZWxlY3Rpb24tY291bnQgewogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZGJlYWZlOyBjb2xvcjogIzFlNDBhZjsgcGFkZGluZzogNHB4IDEycHg7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDk5OTlweDsgZm9udC1zaXplOiAxNHB4OwogICAgICAgICAgICBkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogY2VudGVyOyBnYXA6IDhweDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLmRlc2VsZWN0LWFsbC1idG4gewogICAgICAgICAgICBtYXJnaW4tbGVmdDogNHB4OyB0cmFuc2l0aW9uOiBhbGwgMC4yczsgY3Vyc29yOiBwb2ludGVyOwogICAgICAgICAgICBiYWNrZ3JvdW5kOiB0cmFuc3BhcmVudDsgYm9yZGVyOiBub25lOyBib3JkZXItcmFkaXVzOiA0cHg7CiAgICAgICAgICAgIHBhZGRpbmc6IDJweDsgZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IGNlbnRlcjsganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC5kZXNlbGVjdC1hbGwtYnRuOmhvdmVyIHsgY29sb3I6ICMxZTNhOGE7IGJhY2tncm91bmQ6IHJnYmEoMCwgMCwgMCwgMC4wNSk7IH0KICAgICAgICAuZGVzZWxlY3QtYWxsLWJ0biBzdmcgeyB3aWR0aDogMTZweDsgaGVpZ2h0OiAxNnB4OyB9CiAgICAgICAgCiAgICAgICAgLmNvbnRyb2xzLXJvdyB7CiAgICAgICAgICAgIHBhZGRpbmc6IDEycHggMTZweDsgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICNmM2Y0ZjY7CiAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7IGZsZXgtd3JhcDogd3JhcDsgZ2FwOiAxNnB4OwogICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOyBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC5ncmlkLWNvbnRyb2xzIHsgZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IGNlbnRlcjsgZ2FwOiAxNnB4OyB9CiAgICAgICAgLmNvbnRyb2wtZ3JvdXAgeyBkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogY2VudGVyOyB9CiAgICAgICAgLmNvbnRyb2wtbGFiZWwgeyBtYXJnaW4tcmlnaHQ6IDhweDsgZm9udC1zaXplOiAxNHB4OyBjb2xvcjogIzRiNTU2MzsgfQogICAgICAgIC5ncmlkLXNsaWRlciB7IHdpZHRoOiA5NnB4OyB9CiAgICAgICAgLmdyaWQtdmFsdWUgeyBtYXJnaW4tbGVmdDogOHB4OyBmb250LXNpemU6IDE0cHg7IGNvbG9yOiAjNGI1NTYzOyB9CiAgICAgICAgCiAgICAgICAgLmdyaWQtc2VsZWN0IHsKICAgICAgICAgICAgcGFkZGluZzogNHB4IDhweDsgYm9yZGVyOiAxcHggc29saWQgI2QxZDVkYjsgYm9yZGVyLXJhZGl1czogNHB4OwogICAgICAgICAgICBmb250LXNpemU6IDE0cHg7IGNvbG9yOiAjNGI1NTYzOyBiYWNrZ3JvdW5kOiB3aGl0ZTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLmFjdGlvbi1idXR0b25zIHsgZGlzcGxheTogZmxleDsgZ2FwOiA4cHg7IH0KICAgICAgICAKICAgICAgICAuYnRuIHsKICAgICAgICAgICAgcGFkZGluZzogNHB4IDEycHg7IGJvcmRlci1yYWRpdXM6IDZweDsgZm9udC1zaXplOiAxNHB4OwogICAgICAgICAgICBmb250LXdlaWdodDogNTAwOyBjdXJzb3I6IHBvaW50ZXI7IHRyYW5zaXRpb246IGFsbCAwLjJzOwogICAgICAgICAgICBib3JkZXI6IG5vbmU7IG91dGxpbmU6IG5vbmU7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC5idG4tcHJpbWFyeSB7IGJhY2tncm91bmQtY29sb3I6ICMzYjgyZjY7IGNvbG9yOiB3aGl0ZTsgfQogICAgICAgIC5idG4tcHJpbWFyeTpob3ZlciB7IGJhY2tncm91bmQtY29sb3I6ICMyNTYzZWI7IH0KICAgICAgICAuYnRuLWRhbmdlciB7IGJhY2tncm91bmQtY29sb3I6ICNlZjQ0NDQ7IGNvbG9yOiB3aGl0ZTsgfQogICAgICAgIC5idG4tZGFuZ2VyOmhvdmVyIHsgYmFja2dyb3VuZC1jb2xvcjogI2RjMjYyNjsgfQogICAgICAgIC5idG4tc2Vjb25kYXJ5IHsgYmFja2dyb3VuZC1jb2xvcjogI2U1ZTdlYjsgY29sb3I6ICM0YjU1NjM7IH0KICAgICAgICAuYnRuLXNlY29uZGFyeTpob3ZlciB7IGJhY2tncm91bmQtY29sb3I6ICNkMWQ1ZGI7IH0KICAgICAgICAKICAgICAgICAuZ3JpZC1jb250ZW50IHsgZmxleDogMTsgb3ZlcmZsb3cteTogYXV0bzsgcGFkZGluZzogMTZweDsgfQogICAgICAgIAogICAgICAgIC5ncmlkLWNvbnRhaW5lciB7CiAgICAgICAgICAgIGRpc3BsYXk6IGdyaWQ7IGdyaWQtdGVtcGxhdGUtY29sdW1uczogcmVwZWF0KGF1dG8tZmlsbCwgbWlubWF4KDE1MHB4LCAxZnIpKTsgZ2FwOiAxNnB4OwogICAgICAgIH0KICAgICAgICAKICAgICAgICAuZ3JpZC1pdGVtIHsKICAgICAgICAgICAgcG9zaXRpb246IHJlbGF0aXZlOyBhc3BlY3QtcmF0aW86IDE7IG92ZXJmbG93OiBoaWRkZW47CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDhweDsgY3Vyc29yOiBwb2ludGVyOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAuZ3JpZC1pbWFnZSB7IHdpZHRoOiAxMDAlOyBoZWlnaHQ6IDEwMCU7IG9iamVjdC1maXQ6IGNvdmVyOyB9CiAgICAgICAgLmdyaWQtaXRlbS5zZWxlY3RlZCB7IGJveC1zaGFkb3c6IDAgMCAwIDRweCAjM2I4MmY2OyB9CiAgICAgICAgLmJ0bi5oaWRkZW4geyBkaXNwbGF5OiBub25lOyB9CiAgICAgICAgCiAgICAgICAgLyogPT09PT0gQWN0aW9uIE1vZGFscyA9PT09PSAqLwogICAgICAgIC5hY3Rpb24tbW9kYWwgeyBtYXgtd2lkdGg6IDQ0OHB4OyBwYWRkaW5nOiAyNHB4OyB9CiAgICAgICAgCiAgICAgICAgLmFjdGlvbi10aXRsZSB7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMThweDsgZm9udC13ZWlnaHQ6IDUwMDsgY29sb3I6ICMxZjI5Mzc7IG1hcmdpbi1ib3R0b206IDE2cHg7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC5hY3Rpb24tYnV0dG9ucy1yb3cgewogICAgICAgICAgICBkaXNwbGF5OiBmbGV4OyBqdXN0aWZ5LWNvbnRlbnQ6IGZsZXgtZW5kOyBnYXA6IDhweDsgbWFyZ2luLXRvcDogMTZweDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLm1vdmUtb3B0aW9ucyB7CiAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7IGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47IGdhcDogOHB4OyBtYXJnaW4tYm90dG9tOiAxNnB4OwogICAgICAgIH0KICAgICAgICAKICAgICAgICAubW92ZS1vcHRpb24gewogICAgICAgICAgICB3aWR0aDogMTAwJTsgdGV4dC1hbGlnbjogbGVmdDsgcGFkZGluZzogOHB4IDE2cHg7IGJvcmRlci1yYWRpdXM6IDZweDsKICAgICAgICAgICAgYm9yZGVyOiBub25lOyBiYWNrZ3JvdW5kOiB0cmFuc3BhcmVudDsgY3Vyc29yOiBwb2ludGVyOwogICAgICAgICAgICB0cmFuc2l0aW9uOiBiYWNrZ3JvdW5kLWNvbG9yIDAuMnM7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC5tb3ZlLW9wdGlvbjpob3ZlciB7IGJhY2tncm91bmQtY29sb3I6ICNmM2Y0ZjY7IH0KICAgICAgICAKICAgICAgICAudGFnLWlucHV0LWdyb3VwIHsgbWFyZ2luLWJvdHRvbTogMTZweDsgfQogICAgICAgIAogICAgICAgIC50YWctaW5wdXQtbGFiZWwgewogICAgICAgICAgICBkaXNwbGF5OiBibG9jazsgZm9udC1zaXplOiAxNHB4OyBmb250LXdlaWdodDogNTAwOwogICAgICAgICAgICBjb2xvcjogIzM3NDE1MTsgbWFyZ2luLWJvdHRvbTogNHB4OwogICAgICAgIH0KICAgICAgICAKICAgICAgICAudGFnLWlucHV0IHsKICAgICAgICAgICAgd2lkdGg6IDEwMCU7IHBhZGRpbmc6IDhweCAxMnB4OyBib3JkZXI6IDFweCBzb2xpZCAjZDFkNWRiOwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiA2cHg7IGZvbnQtc2l6ZTogMTRweDsgb3V0bGluZTogbm9uZTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLnRhZy1pbnB1dDpmb2N1cyB7CiAgICAgICAgICAgIGJvcmRlci1jb2xvcjogIzNiODJmNjsgYm94LXNoYWRvdzogMCAwIDAgM3B4IHJnYmEoNTksIDEzMCwgMjQ2LCAwLjEpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAudGFnLXN1Z2dlc3Rpb25zIHsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsgZmxleC13cmFwOiB3cmFwOyBnYXA6IDhweDsgbWFyZ2luLWJvdHRvbTogMTZweDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLnRhZy1zdWdnZXN0aW9uIHsKICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogI2U1ZTdlYjsgY29sb3I6ICMzNzQxNTE7IHBhZGRpbmc6IDRweCA4cHg7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDZweDsgZm9udC1zaXplOiAxMnB4OyBjdXJzb3I6IHBvaW50ZXI7CiAgICAgICAgICAgIHRyYW5zaXRpb246IGJhY2tncm91bmQtY29sb3IgMC4yczsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLnRhZy1zdWdnZXN0aW9uOmhvdmVyIHsgYmFja2dyb3VuZC1jb2xvcjogI2QxZDVkYjsgfQogICAgICAgIC5kZWxldGUtbWVzc2FnZSB7IGNvbG9yOiAjNGI1NTYzOyBtYXJnaW4tYm90dG9tOiAxNnB4OyB9CiAgICAgICAgCiAgICAgICAgLyogPT09PT0gRGV0YWlscyBNb2RhbCA9PT09PSAqLwogICAgICAgIC5kZXRhaWxzLW1vZGFsLWNvbnRlbnQgeyBtYXgtd2lkdGg6IDcwMHB4OyBtYXgtaGVpZ2h0OiA4NXZoOyB9CiAgICAgICAgCiAgICAgICAgLmRldGFpbHMtaGVhZGVyIHsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IGNlbnRlcjsganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOwogICAgICAgICAgICBwYWRkaW5nOiAxNnB4OyBib3JkZXItYm90dG9tOiAxcHggc29saWQgI2U1ZTdlYjsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLmRldGFpbHMtdGl0bGUgeyBmb250LXNpemU6IDE4cHg7IGZvbnQtd2VpZ2h0OiA1MDA7IGNvbG9yOiAjMWYyOTM3OyB9CiAgICAgICAgCiAgICAgICAgLnRhYi1uYXYgewogICAgICAgICAgICBkaXNwbGF5OiBmbGV4OyBib3JkZXItYm90dG9tOiAxcHggc29saWQgI2U1ZTdlYjsgYmFja2dyb3VuZDogI2Y4ZmFmYzsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLnRhYi1idXR0b24gewogICAgICAgICAgICBmbGV4OiAxOyBwYWRkaW5nOiAxNnB4OyBib3JkZXI6IG5vbmU7IGJhY2tncm91bmQ6IHRyYW5zcGFyZW50OwogICAgICAgICAgICBjb2xvcjogIzZiNzI4MDsgZm9udC1zaXplOiAxNHB4OyBmb250LXdlaWdodDogNTAwOyBjdXJzb3I6IHBvaW50ZXI7CiAgICAgICAgICAgIHRyYW5zaXRpb246IGFsbCAwLjJzOyBib3JkZXItYm90dG9tOiAycHggc29saWQgdHJhbnNwYXJlbnQ7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC50YWItYnV0dG9uOmhvdmVyIHsgY29sb3I6ICMzNzQxNTE7IGJhY2tncm91bmQ6IHJnYmEoMCwgMCwgMCwgMC4wMik7IH0KICAgICAgICAudGFiLWJ1dHRvbi5hY3RpdmUgeyBjb2xvcjogIzNiODJmNjsgYm9yZGVyLWJvdHRvbS1jb2xvcjogIzNiODJmNjsgYmFja2dyb3VuZDogd2hpdGU7IH0KICAgICAgICAKICAgICAgICAuZGV0YWlscy1jb250ZW50IHsgZmxleDogMTsgb3ZlcmZsb3cteTogYXV0bzsgb3ZlcmZsb3cteDogaGlkZGVuOyB9CiAgICAgICAgLnRhYi1jb250ZW50IHsgZGlzcGxheTogbm9uZTsgcGFkZGluZzogMjBweDsgfQogICAgICAgIC50YWItY29udGVudC5hY3RpdmUgeyBkaXNwbGF5OiBibG9jazsgfQogICAgICAgIAogICAgICAgIC5pbmZvLXNlY3Rpb24geyBtYXJnaW4tYm90dG9tOiAyMHB4OyB9CiAgICAgICAgCiAgICAgICAgLmluZm8taXRlbSB7CiAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiBjZW50ZXI7IG1hcmdpbi1ib3R0b206IDEycHg7IGdhcDogMTJweDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLmluZm8tbGFiZWwgewogICAgICAgICAgICBmb250LXNpemU6IDE0cHg7IGNvbG9yOiAjNmI3MjgwOyBtaW4td2lkdGg6IDgwcHg7IGZvbnQtd2VpZ2h0OiA1MDA7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC5pbmZvLXZhbHVlIHsKICAgICAgICAgICAgZm9udC1zaXplOiAxNHB4OyBjb2xvcjogIzM3NDE1MTsgZmxleDogMTsgd29yZC1icmVhazogYnJlYWstd29yZDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLmluZm8tbGluayB7IGNvbG9yOiAjM2I4MmY2OyB0ZXh0LWRlY29yYXRpb246IG5vbmU7IH0KICAgICAgICAuaW5mby1saW5rOmhvdmVyIHsgdGV4dC1kZWNvcmF0aW9uOiB1bmRlcmxpbmU7IH0KICAgICAgICAKICAgICAgICAudGFncy1zZWN0aW9uIHsgbWFyZ2luLWJvdHRvbTogMjBweDsgfQogICAgICAgIAogICAgICAgIC50YWdzLWNvbnRhaW5lciB7CiAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7IGZsZXgtd3JhcDogd3JhcDsgZ2FwOiA4cHg7CiAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDE2cHg7IG1pbi1oZWlnaHQ6IDQwcHg7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC50YWctaXRlbSB7CiAgICAgICAgICAgIGRpc3BsYXk6IGlubGluZS1mbGV4OyBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICAgICAgICBiYWNrZ3JvdW5kOiAjZGJlYWZlOyBjb2xvcjogIzFlNDBhZjsgcGFkZGluZzogNHB4IDhweDsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogMTJweDsgZm9udC1zaXplOiAxMnB4OyBnYXA6IDZweDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLnRhZy1yZW1vdmUgewogICAgICAgICAgICBiYWNrZ3JvdW5kOiB0cmFuc3BhcmVudDsgYm9yZGVyOiBub25lOyBjb2xvcjogIzFlNDBhZjsgY3Vyc29yOiBwb2ludGVyOwogICAgICAgICAgICBmb250LXNpemU6IDE0cHg7IGxpbmUtaGVpZ2h0OiAxOyBwYWRkaW5nOiAwOyB3aWR0aDogMTZweDsgaGVpZ2h0OiAxNnB4OwogICAgICAgICAgICBkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogY2VudGVyOyBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogNTAlOyB0cmFuc2l0aW9uOiBiYWNrZ3JvdW5kLWNvbG9yIDAuMnM7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC50YWctcmVtb3ZlOmhvdmVyIHsgYmFja2dyb3VuZDogcmdiYSg1OSwgMTMwLCAyNDYsIDAuMSk7IH0KICAgICAgICAKICAgICAgICAuYWRkLXRhZy1idG4gewogICAgICAgICAgICBiYWNrZ3JvdW5kOiAjZjNmNGY2OyBib3JkZXI6IDFweCBkYXNoZWQgI2QxZDVkYjsgYm9yZGVyLXJhZGl1czogMTJweDsKICAgICAgICAgICAgcGFkZGluZzogNHB4IDEycHg7IGZvbnQtc2l6ZTogMTJweDsgY29sb3I6ICM2YjcyODA7IGN1cnNvcjogcG9pbnRlcjsKICAgICAgICAgICAgdHJhbnNpdGlvbjogYWxsIDAuMnM7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC5hZGQtdGFnLWJ0bjpob3ZlciB7IGJhY2tncm91bmQ6ICNlNWU3ZWI7IGNvbG9yOiAjMzc0MTUxOyB9CiAgICAgICAgCiAgICAgICAgLm5vdGVzLXNlY3Rpb24geyBtYXJnaW4tYm90dG9tOiAyNHB4OyB9CiAgICAgICAgCiAgICAgICAgLm5vdGVzLXRleHRhcmVhIHsKICAgICAgICAgICAgd2lkdGg6IDEwMCU7IG1pbi1oZWlnaHQ6IDEyMHB4OyBwYWRkaW5nOiAxMnB4OwogICAgICAgICAgICBib3JkZXI6IDFweCBzb2xpZCAjZDFkNWRiOyBib3JkZXItcmFkaXVzOiA2cHg7IGZvbnQtc2l6ZTogMTRweDsKICAgICAgICAgICAgZm9udC1mYW1pbHk6IGluaGVyaXQ7IHJlc2l6ZTogdmVydGljYWw7IG91dGxpbmU6IG5vbmU7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC5ub3Rlcy10ZXh0YXJlYTpmb2N1cyB7CiAgICAgICAgICAgIGJvcmRlci1jb2xvcjogIzNiODJmNjsgYm94LXNoYWRvdzogMCAwIDAgM3B4IHJnYmEoNTksIDEzMCwgMjQ2LCAwLjEpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAucmF0aW5nLXNlY3Rpb24geyBtYXJnaW4tYm90dG9tOiAyMHB4OyB9CiAgICAgICAgCiAgICAgICAgLnJhdGluZy1sYWJlbCB7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMTRweDsgZm9udC13ZWlnaHQ6IDUwMDsgY29sb3I6ICMzNzQxNTE7IG1hcmdpbi1ib3R0b206IDhweDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLnN0YXItcmF0aW5nIHsgZGlzcGxheTogZmxleDsgZ2FwOiA0cHg7IH0KICAgICAgICAKICAgICAgICAuc3RhciB7CiAgICAgICAgICAgIHdpZHRoOiAyNHB4OyBoZWlnaHQ6IDI0cHg7IGN1cnNvcjogcG9pbnRlcjsgY29sb3I6ICNkMWQ1ZGI7CiAgICAgICAgICAgIHRyYW5zaXRpb246IGNvbG9yIDAuMnM7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC5zdGFyOmhvdmVyLCAuc3Rhci5hY3RpdmUgeyBjb2xvcjogI2ZiYmYyNDsgfQogICAgICAgIAogICAgICAgIC5tZXRhZGF0YS10YWJsZSB7CiAgICAgICAgICAgIHdpZHRoOiAxMDAlOyBib3JkZXItY29sbGFwc2U6IGNvbGxhcHNlOyBib3JkZXI6IDFweCBzb2xpZCAjZTVlN2ViOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAubWV0YWRhdGEtdGFibGUgdGQgewogICAgICAgICAgICBwYWRkaW5nOiAxMnB4OyBib3JkZXItYm90dG9tOiAxcHggc29saWQgI2U1ZTdlYjsgdmVydGljYWwtYWxpZ246IHRvcDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLm1ldGFkYXRhLXRhYmxlIC5rZXktY2VsbCB7CiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiA1MDA7IGNvbG9yOiAjMzc0MTUxOyB3aWR0aDogMzAlOyB3b3JkLXdyYXA6IGJyZWFrLXdvcmQ7CiAgICAgICAgICAgIGJvcmRlci1yaWdodDogMXB4IHNvbGlkICNlNWU3ZWI7IGJhY2tncm91bmQ6ICNmOWZhZmI7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC5tZXRhZGF0YS10YWJsZSAudmFsdWUtY2VsbCB7CiAgICAgICAgICAgIGNvbG9yOiAjNmI3MjgwOyB3b3JkLXdyYXA6IGJyZWFrLXdvcmQ7IHdoaXRlLXNwYWNlOiBwcmUtd3JhcDsgcG9zaXRpb246IHJlbGF0aXZlOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAuY29weS1idXR0b24gewogICAgICAgICAgICBiYWNrZ3JvdW5kOiAjZjNmNGY2OyBib3JkZXI6IDFweCBzb2xpZCAjZTVlN2ViOyBib3JkZXItcmFkaXVzOiA0cHg7CiAgICAgICAgICAgIHBhZGRpbmc6IDRweCA4cHg7IGZvbnQtc2l6ZTogMTFweDsgY29sb3I6ICM2YjcyODA7IGN1cnNvcjogcG9pbnRlcjsKICAgICAgICAgICAgdHJhbnNpdGlvbjogYWxsIDAuMnM7IG1hcmdpbi1sZWZ0OiA4cHg7IHZlcnRpY2FsLWFsaWduOiB0b3A7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC5jb3B5LWJ1dHRvbjpob3ZlciB7IGJhY2tncm91bmQ6ICNlNWU3ZWI7IGNvbG9yOiAjMzc0MTUxOyB9CiAgICAgICAgCiAgICAgICAgLyogPT09PT0gVG9hc3QgPT09PT0gKi8KICAgICAgICAudG9hc3QgewogICAgICAgICAgICBwb3NpdGlvbjogZml4ZWQ7IGJvdHRvbTogMjBweDsgbGVmdDogNTAlOyB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoLTUwJSk7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IHJnYmEoMCwgMCwgMCwgMC44KTsgY29sb3I6IHdoaXRlOyBwYWRkaW5nOiAxMnB4IDIwcHg7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDhweDsgZm9udC1zaXplOiAxNHB4OyBmb250LXdlaWdodDogNTAwOyB6LWluZGV4OiAxMDAwOwogICAgICAgICAgICBvcGFjaXR5OiAwOyB0cmFuc2l0aW9uOiBvcGFjaXR5IDAuM3MgZWFzZTsgYmFja2Ryb3AtZmlsdGVyOiBibHVyKDEwcHgpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAudG9hc3Quc2hvdyB7IG9wYWNpdHk6IDE7IH0KICAgICAgICAudG9hc3Quc3VjY2VzcyB7IGJhY2tncm91bmQ6IHJnYmEoMTYsIDE4NSwgMTI5LCAwLjkpOyB9CiAgICAgICAgLnRvYXN0LmluZm8geyBiYWNrZ3JvdW5kOiByZ2JhKDU5LCAxMzAsIDI0NiwgMC45KTsgfQogICAgICAgIC50b2FzdC5lcnJvciB7IGJhY2tncm91bmQ6IHJnYmEoMjM5LCA2OCwgNjgsIDAuOSk7IH0KICAgICAgICAKICAgICAgICAuaGlkZGVuIHsgZGlzcGxheTogbm9uZSAhaW1wb3J0YW50OyB9CiAgICAgICAgCiAgICAgICAgQG1lZGlhIHNjcmVlbiBhbmQgKG1pbi13aWR0aDogNzY4cHgpIHsKICAgICAgICAgICAgLmltYWdlLXZpZXdwb3J0IHsgdG9wOiAtMTB2aDsgfQogICAgICAgICAgICAucGlsbC1jb3VudGVyIHsgZm9udC1zaXplOiAxNnB4OyBwYWRkaW5nOiA4cHggMTZweDsgbWluLXdpZHRoOiA0MHB4OyB9CiAgICAgICAgICAgIC5uYXYtYnV0dG9uIHsgZm9udC1zaXplOiAxNHB4OyBwYWRkaW5nOiAxMHB4IDE2cHg7IH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgQG1lZGlhIHNjcmVlbiBhbmQgKG1heC13aWR0aDogNzY3cHgpIHsKICAgICAgICAgICAgLm5hdi1idXR0b24geyBmb250LXNpemU6IDE2cHg7IHBhZGRpbmc6IDEycHggMjBweDsgYm9yZGVyLXJhZGl1czogMjVweDsgbWluLXdpZHRoOiA4MHB4OyB9CiAgICAgICAgICAgIC5waWxsLWNvdW50ZXIuYm90dG9tIHsgYm90dG9tOiA4MHB4OyB9CiAgICAgICAgfQogICAgPC9zdHlsZT4KPC9oZWFkPgo8Ym9keT4KICAgIDwhLS0gQXV0aGVudGljYXRpb24gU2NyZWVuIC0tPgogICAgPGRpdiBjbGFzcz0ic2NyZWVuIiBpZD0iYXV0aC1zY3JlZW4iPgogICAgICAgIDxkaXYgY2xhc3M9ImNhcmQiPgogICAgICAgICAgICA8aDEgY2xhc3M9InRpdGxlIiBzdHlsZT0iZm9udC1zaXplOiAzMnB4OyI+T3JiaXRhbDg8L2gxPgogICAgICAgICAgICA8cCBjbGFzcz0ic3VidGl0bGUiPkNvbm5lY3QgdG8gR29vZ2xlIERyaXZlPC9wPgogICAgICAgICAgICA8aW5wdXQgdHlwZT0icGFzc3dvcmQiIGlkPSJjbGllbnQtc2VjcmV0IiBjbGFzcz0iaW5wdXQiIHBsYWNlaG9sZGVyPSJFbnRlciBHb29nbGUgQ2xpZW50IFNlY3JldCI+CiAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImJ1dHRvbiIgaWQ9ImF1dGgtYnV0dG9uIj5Db25uZWN0IERyaXZlPC9idXR0b24+CiAgICAgICAgICAgIDxkaXYgaWQ9ImF1dGgtc3RhdHVzIiBjbGFzcz0ic3RhdHVzIGluZm8iPkVudGVyIHlvdXIgY2xpZW50IHNlY3JldCB0byBjb250aW51ZTwvZGl2PgogICAgICAgIDwvZGl2PgogICAgPC9kaXY+CiAgICAKICAgIDwhLS0gRm9sZGVyIFNlbGVjdGlvbiBTY3JlZW4gLS0+CiAgICA8ZGl2IGNsYXNzPSJzY3JlZW4gaGlkZGVuIiBpZD0iZm9sZGVyLXNjcmVlbiI+CiAgICAgICAgPGRpdiBjbGFzcz0iY2FyZCIgc3R5bGU9Im1heC1oZWlnaHQ6IDgwdmg7IGRpc3BsYXk6IGZsZXg7IGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47Ij4KICAgICAgICAgICAgPGgyIGNsYXNzPSJ0aXRsZSI+U2VsZWN0IGEgRm9sZGVyPC9oMj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9sZGVyLWxpc3QiIGlkPSJmb2xkZXItbGlzdCI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb2xkZXItbG9hZGluZyI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic3Bpbm5lciI+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPHNwYW4+TG9hZGluZyBmb2xkZXJzLi4uPC9zcGFuPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb2xkZXItYWN0aW9ucyI+CiAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJmb2xkZXItYnV0dG9uIiBpZD0icmVmcmVzaC1mb2xkZXJzIj5SZWZyZXNoPC9idXR0b24+CiAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJmb2xkZXItYnV0dG9uIGRhbmdlciIgaWQ9ImxvZ291dCI+RGlzY29ubmVjdDwvYnV0dG9uPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgIDwvZGl2PgogICAgCiAgICA8IS0tIExvYWRpbmcgU2NyZWVuIC0tPgogICAgPGRpdiBjbGFzcz0ic2NyZWVuIGhpZGRlbiIgaWQ9ImxvYWRpbmctc2NyZWVuIiBzdHlsZT0iei1pbmRleDogMTUwMDsiPgogICAgICAgIDxkaXYgY2xhc3M9ImNhcmQiPgogICAgICAgICAgICA8aDIgY2xhc3M9InRpdGxlIj5Mb2FkaW5nIEltYWdlczwvaDI+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImxvYWRpbmctY291bnRlciIgaWQ9ImxvYWRpbmctY291bnRlciI+MDwvZGl2PgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJsb2FkaW5nLW1lc3NhZ2UiIGlkPSJsb2FkaW5nLW1lc3NhZ2UiPlByb2Nlc3NpbmcgZmlsZXMuLi48L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0ibG9hZGluZy1wcm9ncmVzcyI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJsb2FkaW5nLXByb2dyZXNzLWJhciIgaWQ9ImxvYWRpbmctcHJvZ3Jlc3MtYmFyIj48L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KICAgIAogICAgPCEtLSBNYWluIEFwcCBDb250YWluZXIgLS0+CiAgICA8ZGl2IGNsYXNzPSJhcHAtY29udGFpbmVyIGhpZGRlbiIgaWQ9ImFwcC1jb250YWluZXIiPgogICAgICAgIDxkaXYgY2xhc3M9Im5hdi1idXR0b24gYmFjayIgaWQ9ImJhY2stYnV0dG9uIj7ihpAgRm9sZGVyczwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9Im5hdi1idXR0b24gZGV0YWlscyIgaWQ9ImRldGFpbHMtYnV0dG9uIj5EZXRhaWxzIOKGkjwvZGl2PgogICAgICAgIAogICAgICAgIDxkaXYgY2xhc3M9ImltYWdlLXZpZXdwb3J0IiBpZD0iaW1hZ2Utdmlld3BvcnQiPgogICAgICAgICAgICA8aW1nIGNsYXNzPSJjZW50ZXItaW1hZ2Ugem9vbWFibGUiIGlkPSJjZW50ZXItaW1hZ2UiIGFsdD0iU2VsZWN0IGEgZm9sZGVyIHRvIHN0YXJ0IiAvPgogICAgICAgIDwvZGl2PgogICAgICAgIAogICAgICAgIDxkaXYgY2xhc3M9ImVkZ2UtZ2xvdyB0b3AiIGlkPSJlZGdlLXRvcCI+PC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0iZWRnZS1nbG93IGJvdHRvbSIgaWQ9ImVkZ2UtYm90dG9tIj48L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJlZGdlLWdsb3cgbGVmdCIgaWQ9ImVkZ2UtbGVmdCI+PC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0iZWRnZS1nbG93IHJpZ2h0IiBpZD0iZWRnZS1yaWdodCI+PC9kaXY+CiAgICAgICAgCiAgICAgICAgPGRpdiBjbGFzcz0icGlsbC1jb3VudGVyIHRvcCIgaWQ9InBpbGwtcHJpb3JpdHkiIGRhdGEtc3RhY2s9InByaW9yaXR5Ij4wPC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0icGlsbC1jb3VudGVyIGJvdHRvbSIgaWQ9InBpbGwtdHJhc2giIGRhdGEtc3RhY2s9InRyYXNoIj4wPC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0icGlsbC1jb3VudGVyIGxlZnQgYWN0aXZlIiBpZD0icGlsbC1pbiIgZGF0YS1zdGFjaz0iaW4iPjA8L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJwaWxsLWNvdW50ZXIgcmlnaHQiIGlkPSJwaWxsLW91dCIgZGF0YS1zdGFjaz0ib3V0Ij4wPC9kaXY+CiAgICAgICAgCiAgICAgICAgPGRpdiBjbGFzcz0iZW1wdHktc3RhdGUgaGlkZGVuIiBpZD0iZW1wdHktc3RhdGUiPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJlbXB0eS1tZXNzYWdlIj5ObyBtb3JlIGltYWdlcyBpbiB0aGlzIHN0YWNrPC9kaXY+CiAgICAgICAgICAgIDxidXR0b24gY2xhc3M9Im5ldy1pbWFnZXMtYnV0dG9uIiBpZD0ic2VsZWN0LWFub3RoZXItc3RhY2stYnRuIj5TZWxlY3QgQW5vdGhlciBTdGFjazwvYnV0dG9uPgogICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJuZXctaW1hZ2VzLWJ1dHRvbiIgaWQ9InNlbGVjdC1hbm90aGVyLWZvbGRlci1idG4iIHN0eWxlPSJtYXJnaW4tdG9wOiAxMnB4OyI+Q2hvb3NlIERpZmZlcmVudCBGb2xkZXI8L2J1dHRvbj4KICAgICAgICA8L2Rpdj4KICAgICAgICAKICAgICAgICA8ZGl2IGlkPSJ0b2FzdCIgY2xhc3M9InRvYXN0Ij48L2Rpdj4KICAgIDwvZGl2PgogICAgCiAgICA8IS0tIEdyaWQgTW9kYWwgLS0+CiAgICA8ZGl2IGlkPSJncmlkLW1vZGFsIiBjbGFzcz0ibW9kYWwgaGlkZGVuIj4KICAgICAgICA8ZGl2IGNsYXNzPSJtb2RhbC1jb250ZW50Ij4KICAgICAgICAgICAgPGRpdiBjbGFzcz0ibW9kYWwtaGVhZGVyIj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1vZGFsLWhlYWRlci1tYWluIj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtb2RhbC1oZWFkZXItbGVmdCI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxoMiBpZD0iZ3JpZC10aXRsZSIgY2xhc3M9Im1vZGFsLXRpdGxlIj5HcmlkIFZpZXc8L2gyPgogICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSJzZWxlY3QtYWxsLWJ0biIgY2xhc3M9InNlbGVjdC1hbGwtYnRuIj4wPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0iY2xvc2UtZ3JpZCIgY2xhc3M9ImNsb3NlLWJ0biI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxzdmcgZmlsbD0ibm9uZSIgc3Ryb2tlPSJjdXJyZW50Q29sb3IiIHZpZXdCb3g9IjAgMCAyNCAyNCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cGF0aCBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTYgMThMMTggNk02IDZsMTIgMTIiIC8+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvc3ZnPgogICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzZWxlY3Rpb24taW5mby1yb3ciPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNlbGVjdGlvbi1pbmZvIj4KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InNlbGVjdGlvbi1jb3VudCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBpZD0ic2VsZWN0aW9uLXRleHQiPjAgc2VsZWN0ZWQ8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSJkZXNlbGVjdC1hbGwtYnRuIiBjbGFzcz0iZGVzZWxlY3QtYWxsLWJ0biI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHN2ZyBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHBhdGggc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik02IDE4TDE4IDZNNiA2bDEyIDEyIiAvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc3ZnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29udHJvbHMtcm93Ij4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJncmlkLWNvbnRyb2xzIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29udHJvbC1ncm91cCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iY29udHJvbC1sYWJlbCI+R3JpZCBTaXplOjwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJyYW5nZSIgaWQ9ImdyaWQtc2l6ZSIgY2xhc3M9ImdyaWQtc2xpZGVyIiBtaW49IjEiIG1heD0iMTAiIHZhbHVlPSI0Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGlkPSJncmlkLXNpemUtdmFsdWUiIGNsYXNzPSJncmlkLXZhbHVlIj40PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29udHJvbC1ncm91cCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iY29udHJvbC1sYWJlbCI+U29ydDo8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c2VsZWN0IGlkPSJncmlkLXNvcnQiIGNsYXNzPSJncmlkLXNlbGVjdCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iZGF0ZS1kZXNjIj5EYXRlIChuZXdlc3QgZmlyc3QpPC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iZGF0ZS1hc2MiPkRhdGUgKG9sZGVzdCBmaXJzdCk8L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJuYW1lLWFzYyI+TmFtZSAoQS1aKTwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9Im5hbWUtZGVzYyI+TmFtZSAoWi1BKTwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zZWxlY3Q+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImFjdGlvbi1idXR0b25zIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0idGFnLXNlbGVjdGVkIiBjbGFzcz0iYnRuIGJ0bi1wcmltYXJ5IGhpZGRlbiI+VGFnPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9Im1vdmUtc2VsZWN0ZWQiIGNsYXNzPSJidG4gYnRuLXByaW1hcnkgaGlkZGVuIj5Nb3ZlPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9ImRlbGV0ZS1zZWxlY3RlZCIgY2xhc3M9ImJ0biBidG4tZGFuZ2VyIGhpZGRlbiI+RGVsZXRlPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImdyaWQtY29udGVudCI+CiAgICAgICAgICAgICAgICA8ZGl2IGlkPSJncmlkLWNvbnRhaW5lciIgY2xhc3M9ImdyaWQtY29udGFpbmVyIj48L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KICAgIAogICAgPCEtLSBBY3Rpb24gTW9kYWxzIC0tPgogICAgPGRpdiBpZD0ibW92ZS1tb2RhbCIgY2xhc3M9Im1vZGFsIGhpZGRlbiI+CiAgICAgICAgPGRpdiBjbGFzcz0ibW9kYWwtY29udGVudCBhY3Rpb24tbW9kYWwiPgogICAgICAgICAgICA8aDMgY2xhc3M9ImFjdGlvbi10aXRsZSI+TW92ZSB0byBTdGFjazwvaDM+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1vdmUtb3B0aW9ucyI+CiAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJtb3ZlLW9wdGlvbiIgZGF0YS1zdGFjaz0iaW4iPkluPC9idXR0b24+CiAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJtb3ZlLW9wdGlvbiIgZGF0YS1zdGFjaz0ib3V0Ij5PdXQ8L2J1dHRvbj4KICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9Im1vdmUtb3B0aW9uIiBkYXRhLXN0YWNrPSJwcmlvcml0eSI+UHJpb3JpdHk8L2J1dHRvbj4KICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9Im1vdmUtb3B0aW9uIiBkYXRhLXN0YWNrPSJ0cmFzaCI+VHJhc2g8L2J1dHRvbj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImFjdGlvbi1idXR0b25zLXJvdyI+CiAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSJjYW5jZWwtbW92ZSIgY2xhc3M9ImJ0biBidG4tc2Vjb25kYXJ5Ij5DYW5jZWw8L2J1dHRvbj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KICAgIAogICAgPGRpdiBpZD0idGFnLW1vZGFsIiBjbGFzcz0ibW9kYWwgaGlkZGVuIj4KICAgICAgICA8ZGl2IGNsYXNzPSJtb2RhbC1jb250ZW50IGFjdGlvbi1tb2RhbCI+CiAgICAgICAgICAgIDxoMyBjbGFzcz0iYWN0aW9uLXRpdGxlIj5BZGQgVGFnczwvaDM+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9InRhZy1pbnB1dC1ncm91cCI+CiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJ0YWctaW5wdXQiIGNsYXNzPSJ0YWctaW5wdXQtbGFiZWwiPkVudGVyIHRhZ3MgKGNvbW1hIHNlcGFyYXRlZCk8L2xhYmVsPgogICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InRleHQiIGlkPSJ0YWctaW5wdXQiIGNsYXNzPSJ0YWctaW5wdXQiIHBsYWNlaG9sZGVyPSJuYXR1cmUsIGxhbmRzY2FwZSwgdmFjYXRpb24iPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBpZD0idGFnLXN1Z2dlc3Rpb25zIiBjbGFzcz0idGFnLXN1Z2dlc3Rpb25zIj48L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iYWN0aW9uLWJ1dHRvbnMtcm93Ij4KICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9ImNhbmNlbC10YWciIGNsYXNzPSJidG4gYnRuLXNlY29uZGFyeSI+Q2FuY2VsPC9idXR0b24+CiAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSJhcHBseS10YWciIGNsYXNzPSJidG4gYnRuLXByaW1hcnkiPkFwcGx5PC9idXR0b24+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PgogICAgPC9kaXY+CiAgICAKICAgIDxkaXYgaWQ9ImRlbGV0ZS1tb2RhbCIgY2xhc3M9Im1vZGFsIGhpZGRlbiI+CiAgICAgICAgPGRpdiBjbGFzcz0ibW9kYWwtY29udGVudCBhY3Rpb24tbW9kYWwiPgogICAgICAgICAgICA8aDMgY2xhc3M9ImFjdGlvbi10aXRsZSI+Q29uZmlybSBEZWxldGU8L2gzPgogICAgICAgICAgICA8cCBpZD0iZGVsZXRlLW1lc3NhZ2UiIGNsYXNzPSJkZWxldGUtbWVzc2FnZSI+QXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIG1vdmUgdGhlIHNlbGVjdGVkIGltYWdlcyB0byBUcmFzaD88L3A+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImFjdGlvbi1idXR0b25zLXJvdyI+CiAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSJjYW5jZWwtZGVsZXRlIiBjbGFzcz0iYnRuIGJ0bi1zZWNvbmRhcnkiPkNhbmNlbDwvYnV0dG9uPgogICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0iY29uZmlybS1kZWxldGUiIGNsYXNzPSJidG4gYnRuLWRhbmdlciI+Q29uZmlybTwvYnV0dG9uPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgIDwvZGl2PgogICAgCiAgICA8IS0tIERldGFpbHMgTW9kYWwgLS0+CiAgICA8ZGl2IGlkPSJkZXRhaWxzLW1vZGFsIiBjbGFzcz0ibW9kYWwgaGlkZGVuIj4KICAgICAgICA8ZGl2IGNsYXNzPSJtb2RhbC1jb250ZW50IGRldGFpbHMtbW9kYWwtY29udGVudCI+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImRldGFpbHMtaGVhZGVyIj4KICAgICAgICAgICAgICAgIDxoMyBjbGFzcz0iZGV0YWlscy10aXRsZSI+SW1hZ2UgRGV0YWlsczwvaDM+CiAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSJkZXRhaWxzLWNsb3NlIiBjbGFzcz0iY2xvc2UtYnRuIj4KICAgICAgICAgICAgICAgICAgICA8c3ZnIGZpbGw9Im5vbmUiIHN0cm9rZT0iY3VycmVudENvbG9yIiB2aWV3Qm94PSIwIDAgMjQgMjQiPgogICAgICAgICAgICAgICAgICAgICAgICA8cGF0aCBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTYgMThMMTggNk02IDZsMTIgMTIiIC8+CiAgICAgICAgICAgICAgICAgICAgPC9zdmc+CiAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIAogICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0YWItbmF2Ij4KICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9InRhYi1idXR0b24gYWN0aXZlIiBkYXRhLXRhYj0iaW5mbyI+SW5mbzwvYnV0dG9uPgogICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0idGFiLWJ1dHRvbiIgZGF0YS10YWI9InRhZ3MiPlRhZ3M8L2J1dHRvbj4KICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9InRhYi1idXR0b24iIGRhdGEtdGFiPSJub3RlcyI+Tm90ZXM8L2J1dHRvbj4KICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9InRhYi1idXR0b24iIGRhdGEtdGFiPSJtZXRhZGF0YSI+TWV0YWRhdGE8L2J1dHRvbj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIAogICAgICAgICAgICA8ZGl2IGNsYXNzPSJkZXRhaWxzLWNvbnRlbnQiPgogICAgICAgICAgICAgICAgPGRpdiBpZD0idGFiLWluZm8iIGNsYXNzPSJ0YWItY29udGVudCBhY3RpdmUiPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImluZm8tc2VjdGlvbiI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImluZm8taXRlbSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iaW5mby1sYWJlbCI+RmlsZW5hbWU6PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGEgaWQ9ImRldGFpbC1maWxlbmFtZS1saW5rIiBjbGFzcz0iaW5mby12YWx1ZSBpbmZvLWxpbmsiIGhyZWY9IiMiIHRhcmdldD0iX2JsYW5rIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBpZD0iZGV0YWlsLWZpbGVuYW1lIj48L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2E+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJpbmZvLWl0ZW0iPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImluZm8tbGFiZWwiPkRhdGU6PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImluZm8tdmFsdWUiIGlkPSJkZXRhaWwtZGF0ZSI+PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iaW5mby1pdGVtIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJpbmZvLWxhYmVsIj5TaXplOjwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJpbmZvLXZhbHVlIiBpZD0iZGV0YWlsLXNpemUiPjwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgPGRpdiBpZD0idGFiLXRhZ3MiIGNsYXNzPSJ0YWItY29udGVudCI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idGFncy1zZWN0aW9uIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idGFncy1jb250YWluZXIiIGlkPSJkZXRhaWwtdGFncyI+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgPGRpdiBpZD0idGFiLW5vdGVzIiBjbGFzcz0idGFiLWNvbnRlbnQiPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im5vdGVzLXNlY3Rpb24iPgogICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJkZXRhaWwtbm90ZXMiIGNsYXNzPSJpbmZvLWxhYmVsIj5Ob3Rlczo8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICA8dGV4dGFyZWEgaWQ9ImRldGFpbC1ub3RlcyIgY2xhc3M9Im5vdGVzLXRleHRhcmVhIiBwbGFjZWhvbGRlcj0iQWRkIHlvdXIgbm90ZXMgaGVyZS4uLiI+PC90ZXh0YXJlYT4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJyYXRpbmctc2VjdGlvbiI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InJhdGluZy1sYWJlbCI+UXVhbGl0eSBSYXRpbmc6PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InN0YXItcmF0aW5nIiBpZD0icXVhbGl0eS1yYXRpbmciPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHN2ZyBjbGFzcz0ic3RhciIgZGF0YS1yYXRpbmc9IjEiIGZpbGw9ImN1cnJlbnRDb2xvciIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTIgMmwzLjA5IDYuMjZMMjIgOS4yN2wtNSA0Ljg3IDEuMTggNi44OEwxMiAxNy43N2wtNi4xOCAzLjI1TDcgMTQuMTQgMiA5LjI3bDYuOTEtMS4wMUwxMiAyeiIvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zdmc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3ZnIGNsYXNzPSJzdGFyIiBkYXRhLXJhdGluZz0iMiIgZmlsbD0iY3VycmVudENvbG9yIiB2aWV3Qm94PSIwIDAgMjQgMjQiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xMiAybDMuMDkgNi4yNkwyMiA5LjI3bC01IDQuODcgMS4xOCA2Ljg4TDEyIDE3Ljc3bC02LjE4IDMuMjVMNyAxNC4xNCAyIDkuMjdsNi45MS0xLjAxTDEyIDJ6Ii8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3N2Zz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzdmcgY2xhc3M9InN0YXIiIGRhdGEtcmF0aW5nPSIzIiBmaWxsPSJjdXJyZW50Q29sb3IiIHZpZXdCb3g9IjAgMCAyNCAyNCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTEyIDJsMy4wOSA2LjI2TDIyIDkuMjdsLTUgNC44NyAxLjE4IDYuODhMMTIgMTcuNzdsLTYuMTggMy4yNUw3IDE0LjE0IDIgOS4yN2w2LjkxLTEuMDFMMTIgMnoiLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc3ZnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHN2ZyBjbGFzcz0ic3RhciIgZGF0YS1yYXRpbmc9IjQiIGZpbGw9ImN1cnJlbnRDb2xvciIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTIgMmwzLjA5IDYuMjZMMjIgOS4yN2wtNSA0Ljg3IDEuMTggNi44OEwxMiAxNy43N2wtNi4xOCAzLjI1TDcgMTQuMTQgMiA5LjI3bDYuOTEtMS4wMUwxMiAyeiIvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zdmc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3ZnIGNsYXNzPSJzdGFyIiBkYXRhLXJhdGluZz0iNSIgZmlsbD0iY3VycmVudENvbG9yIiB2aWV3Qm94PSIwIDAgMjQgMjQiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xMiAybDMuMDkgNi4yNkwyMiA5LjI3bC01IDQuODcgMS4xOCA2Ljg4TDEyIDE3Ljc3bC02LjE4IDMuMjVMNyAxNC4xNCAyIDkuMjdsNi45MS0xLjAxTDEyIDJ6Ii8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3N2Zz4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icmF0aW5nLXNlY3Rpb24iPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJyYXRpbmctbGFiZWwiPkNvbnRlbnQgUmF0aW5nOjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzdGFyLXJhdGluZyIgaWQ9ImNvbnRlbnQtcmF0aW5nIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzdmcgY2xhc3M9InN0YXIiIGRhdGEtcmF0aW5nPSIxIiBmaWxsPSJjdXJyZW50Q29sb3IiIHZpZXdCb3g9IjAgMCAyNCAyNCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTEyIDJsMy4wOSA2LjI2TDIyIDkuMjdsLTUgNC44NyAxLjE4IDYuODhMMTIgMTcuNzdsLTYuMTggMy4yNUw3IDE0LjE0IDIgOS4yN2w2LjkxLTEuMDFMMTIgMnoiLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc3ZnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHN2ZyBjbGFzcz0ic3RhciIgZGF0YS1yYXRpbmc9IjIiIGZpbGw9ImN1cnJlbnRDb2xvciIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTIgMmwzLjA5IDYuMjZMMjIgOS4yN2wtNSA0Ljg3IDEuMTggNi44OEwxMiAxNy43N2wtNi4xOCAzLjI1TDcgMTQuMTQgMiA5LjI3bDYuOTEtMS4wMUwxMiAyeiIvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zdmc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3ZnIGNsYXNzPSJzdGFyIiBkYXRhLXJhdGluZz0iMyIgZmlsbD0iY3VycmVudENvbG9yIiB2aWV3Qm94PSIwIDAgMjQgMjQiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xMiAybDMuMDkgNi4yNkwyMiA5LjI3bC01IDQuODkgMS4xOCA2Ljg4TDEyIDE3Ljc3bC02LjE4IDMuMjVMNyAxNC4xNCAyIDkuMjdsNi45MS0xLjAxTDEyIDJ6Ii8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3N2Zz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzdmcgY2xhc3M9InN0YXIiIGRhdGEtcmF0aW5nPSI0IiBmaWxsPSJjdXJyZW50Q29sb3IiIHZpZXdCb3g9IjAgMCAyNCAyNCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTEyIDJsMy4wOSA2LjI2TDIyIDkuMjdsLTUgNC44NyAxLjE4IDYuODhMMTIgMTcuNzdsLTYuMTggMy4yNUw3IDE0LjE0IDIgOS4yN2w2LjkxLTEuMDFMMTIgMnoiLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc3ZnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHN2ZyBjbGFzcz0ic3RhciIgZGF0YS1yYXRpbmc9IjUiIGZpbGw9ImN1cnJlbnRDb2xvciIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTIgMmwzLjA5IDYuMjZMMjIgOS4yN2wtNSA0Ljg3IDEuMTggNi44OEwxMiAxNy43N2wtNi4xOCAzLjI1TDcgMTQuMTQgMiA5LjI3bDYuOTEtMS4wMUwxMiAyeiIvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zdmc+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIDxkaXYgaWQ9InRhYi1tZXRhZGF0YSIgY2xhc3M9InRhYi1jb250ZW50Ij4KICAgICAgICAgICAgICAgICAgICA8dGFibGUgY2xhc3M9Im1ldGFkYXRhLXRhYmxlIiBpZD0ibWV0YWRhdGEtdGFibGUiPjwvdGFibGU+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KCiAgICA8c2NyaXB0PgogICAgICAgIC8vID09PT09IFNJTVBMSUZJRUQgTWV0YWRhdGFFeHRyYWN0b3IgPT09PT0KICAgICAgICBjbGFzcyBNZXRhZGF0YUV4dHJhY3RvciB7CiAgICAgICAgICAgIGV4dHJhY3RQTkdNZXRhZGF0YShidWZmZXIsIHZpZXcpIHsKICAgICAgICAgICAgICAgIGNvbnN0IG1ldGFkYXRhID0ge307CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygn8J+UjSBQTkcgZXh0cmFjdGlvbiBzdGFydGluZzonLCBidWZmZXIuYnl0ZUxlbmd0aCwgJ2J5dGVzJyk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmlldy5ieXRlTGVuZ3RoIC0gNDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHZpZXcuZ2V0VWludDgoaSkgPT09IDExNiAmJiB2aWV3LmdldFVpbnQ4KGkrMSkgPT09IDY5ICYmIHZpZXcuZ2V0VWludDgoaSsyKSA9PT0gODggJiYgdmlldy5nZXRVaW50OChpKzMpID09PSAxMTYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGxlbmd0aCA9IHZpZXcuZ2V0VWludDMyKGktNCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsZW5ndGggPiAwICYmIGxlbmd0aCA8IDY1NTM2KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCB0ZXh0RGF0YSA9IG5ldyBUZXh0RGVjb2RlcigpLmRlY29kZShuZXcgVWludDhBcnJheShidWZmZXIuc2xpY2UoaSs0LCBpKzQrbGVuZ3RoKSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBudWxsSW5kZXggPSB0ZXh0RGF0YS5pbmRleE9mKCdcMCcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChudWxsSW5kZXggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBrZXkgPSB0ZXh0RGF0YS5zdWJzdHJpbmcoMCwgbnVsbEluZGV4KS50cmltKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCB2YWx1ZSA9IHRleHREYXRhLnN1YnN0cmluZyhudWxsSW5kZXggKyAxKS50cmltKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChrZXkgJiYgdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGFkYXRhW2tleV0gPSB2YWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCfinIUgRm91bmQ6Jywga2V5LCAnPScsIHZhbHVlLnN1YnN0cmluZygwLCA1MCkgKyAnLi4uJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7fQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygn8J+OryBFeHRyYWN0ZWQga2V5czonLCBPYmplY3Qua2V5cyhtZXRhZGF0YSkpOwogICAgICAgICAgICAgICAgcmV0dXJuIG1ldGFkYXRhOwogICAgICAgICAgICB9CgogICAgICAgICAgICBleHRyYWN0SlBFR01ldGFkYXRhKGJ1ZmZlciwgdmlldykgewogICAgICAgICAgICAgICAgY29uc3QgbWV0YWRhdGEgPSB7fTsKICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmlldy5ieXRlTGVuZ3RoIC0gNDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHZpZXcuZ2V0VWludDgoaSkgPT09IDB4RkYgJiYgdmlldy5nZXRVaW50OChpKzEpID09PSAweEUxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGFkYXRhWydFWElGIERhdGEnXSA9ICdQcmVzZW50JzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIG1ldGFkYXRhOwogICAgICAgICAgICB9CgogICAgICAgICAgICBhc3luYyBleHRyYWN0SW1hZ2VNZXRhZGF0YShhcnJheUJ1ZmZlciwgbWltZVR5cGUpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHZpZXcgPSBuZXcgRGF0YVZpZXcoYXJyYXlCdWZmZXIpOwogICAgICAgICAgICAgICAgbGV0IG1ldGFkYXRhID0ge307CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIChtaW1lVHlwZSA9PT0gImltYWdlL3BuZyIpIHsKICAgICAgICAgICAgICAgICAgICBtZXRhZGF0YSA9IHRoaXMuZXh0cmFjdFBOR01ldGFkYXRhKGFycmF5QnVmZmVyLCB2aWV3KTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobWltZVR5cGUgPT09ICJpbWFnZS9qcGVnIikgewogICAgICAgICAgICAgICAgICAgIG1ldGFkYXRhID0gdGhpcy5leHRyYWN0SlBFR01ldGFkYXRhKGFycmF5QnVmZmVyLCB2aWV3KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmV0dXJuIG1ldGFkYXRhOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyA9PT09PSBDbG91ZFN0b3JhZ2VNb2R1bGUgKHVuY2hhbmdlZCkgPT09PT0KICAgICAgICBjbGFzcyBDbG91ZFN0b3JhZ2VNb2R1bGUgewogICAgICAgICAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgICAgICAgICAgIHRoaXMucHJvdmlkZXJzID0ge307CiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRQcm92aWRlciA9IG51bGw7CiAgICAgICAgICAgICAgICB0aGlzLm9uQXV0aFN0YXRlQ2hhbmdlZCA9IG51bGw7CiAgICAgICAgICAgICAgICB0aGlzLm9uRXJyb3IgPSBudWxsOwogICAgICAgICAgICAgICAgdGhpcy5wcm92aWRlcnMuZ29vZ2xlZHJpdmUgPSBuZXcgR29vZ2xlRHJpdmVQcm92aWRlcigpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBzZXRQcm92aWRlcihwcm92aWRlck5hbWUpIHsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5wcm92aWRlcnNbcHJvdmlkZXJOYW1lXSkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgVW5rbm93biBwcm92aWRlcjogJHtwcm92aWRlck5hbWV9YCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRQcm92aWRlciA9IHRoaXMucHJvdmlkZXJzW3Byb3ZpZGVyTmFtZV07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGFzeW5jIGF1dGhlbnRpY2F0ZShjbGllbnRTZWNyZXQgPSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuY3VycmVudFByb3ZpZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyBwcm92aWRlciBzZWxlY3RlZC4gQ2FsbCBzZXRQcm92aWRlcigpIGZpcnN0LicpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzdWNjZXNzID0gYXdhaXQgdGhpcy5jdXJyZW50UHJvdmlkZXIuYXV0aGVudGljYXRlKGNsaWVudFNlY3JldCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMub25BdXRoU3RhdGVDaGFuZ2VkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub25BdXRoU3RhdGVDaGFuZ2VkKHN1Y2Nlc3MsIHRoaXMuY3VycmVudFByb3ZpZGVyLm5hbWUpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3VjY2VzczsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMub25FcnJvcikgdGhpcy5vbkVycm9yKGVycm9yKTsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBlcnJvcjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgaXNBdXRoZW50aWNhdGVkKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudFByb3ZpZGVyPy5pc0F1dGhlbnRpY2F0ZWQgfHwgZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGFzeW5jIGdldEZpbGVzKGZvbGRlcklkID0gJ3Jvb3QnKSB7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuY3VycmVudFByb3ZpZGVyPy5pc0F1dGhlbnRpY2F0ZWQpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vdCBhdXRoZW50aWNhdGVkLiBDYWxsIGF1dGhlbnRpY2F0ZSgpIGZpcnN0LicpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuY3VycmVudFByb3ZpZGVyLmdldEZpbGVzKGZvbGRlcklkKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgYXN5bmMgZ2V0Rm9sZGVycygpIHsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5jdXJyZW50UHJvdmlkZXI/LmlzQXV0aGVudGljYXRlZCkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTm90IGF1dGhlbnRpY2F0ZWQuIENhbGwgYXV0aGVudGljYXRlKCkgZmlyc3QuJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5jdXJyZW50UHJvdmlkZXIuZ2V0Rm9sZGVycygpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBhc3luYyBtb3ZlRmlsZVRvU3RhY2soZmlsZUlkLCB0YXJnZXRTdGFjaykgewogICAgICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuY3VycmVudFByb3ZpZGVyLm1vdmVGaWxlVG9TdGFjayhmaWxlSWQsIHRhcmdldFN0YWNrKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgYXN5bmMgdXBkYXRlRmlsZVByb3BlcnRpZXMoZmlsZUlkLCBwcm9wZXJ0aWVzKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5jdXJyZW50UHJvdmlkZXIudXBkYXRlRmlsZVByb3BlcnRpZXMoZmlsZUlkLCBwcm9wZXJ0aWVzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgYXN5bmMgZGVsZXRlRmlsZShmaWxlSWQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBhd2FpdCB0aGlzLmN1cnJlbnRQcm92aWRlci5kZWxldGVGaWxlKGZpbGVJZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGFzeW5jIGRpc2Nvbm5lY3QoKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5jdXJyZW50UHJvdmlkZXIpIHsKICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmN1cnJlbnRQcm92aWRlci5kaXNjb25uZWN0KCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMub25BdXRoU3RhdGVDaGFuZ2VkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub25BdXRoU3RhdGVDaGFuZ2VkKGZhbHNlLCB0aGlzLmN1cnJlbnRQcm92aWRlci5uYW1lKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGNsYXNzIFN0b3JhZ2VQcm92aWRlciB7CiAgICAgICAgICAgIGNvbnN0cnVjdG9yKG5hbWUpIHsKICAgICAgICAgICAgICAgIHRoaXMubmFtZSA9IG5hbWU7CiAgICAgICAgICAgICAgICB0aGlzLmlzQXV0aGVudGljYXRlZCA9IGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBhc3luYyBhdXRoZW50aWNhdGUoY2xpZW50U2VjcmV0KSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2F1dGhlbnRpY2F0ZSgpIG11c3QgYmUgaW1wbGVtZW50ZWQgYnkgcHJvdmlkZXInKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgYXN5bmMgZGlzY29ubmVjdCgpIHsKICAgICAgICAgICAgICAgIHRoaXMuaXNBdXRoZW50aWNhdGVkID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGFzeW5jIGdldEZpbGVzKGZvbGRlcklkKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2dldEZpbGVzKCkgbXVzdCBiZSBpbXBsZW1lbnRlZCBieSBwcm92aWRlcicpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBhc3luYyBnZXRGb2xkZXJzKCkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdnZXRGb2xkZXJzKCkgbXVzdCBiZSBpbXBsZW1lbnRlZCBieSBwcm92aWRlcicpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBjbGFzcyBHb29nbGVEcml2ZVByb3ZpZGVyIGV4dGVuZHMgU3RvcmFnZVByb3ZpZGVyIHsKICAgICAgICAgICAgY29uc3RydWN0b3IoKSB7CiAgICAgICAgICAgICAgICBzdXBlcignZ29vZ2xlZHJpdmUnKTsKICAgICAgICAgICAgICAgIHRoaXMuY2xpZW50SWQgPSAnNTY3OTg4MDYyNDY0LWZhNmMxb3Zlc3FldWRxczUzOTh2djRtYm82cTA2OHA5LmFwcHMuZ29vZ2xldXNlcmNvbnRlbnQuY29tJzsKICAgICAgICAgICAgICAgIHRoaXMucmVkaXJlY3RVcmkgPSB3aW5kb3cubG9jYXRpb24ub3JpZ2luICsgd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lOwogICAgICAgICAgICAgICAgdGhpcy5zY29wZSA9ICdodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9hdXRoL2RyaXZlJzsKICAgICAgICAgICAgICAgIHRoaXMuYXBpQmFzZSA9ICdodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9kcml2ZS92Myc7CiAgICAgICAgICAgICAgICB0aGlzLmFjY2Vzc1Rva2VuID0gbnVsbDsKICAgICAgICAgICAgICAgIHRoaXMucmVmcmVzaFRva2VuID0gbnVsbDsgCiAgICAgICAgICAgICAgICB0aGlzLmNsaWVudFNlY3JldCA9IG51bGw7CiAgICAgICAgICAgICAgICB0aGlzLmxvYWRTdG9yZWRDcmVkZW50aWFscygpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBsb2FkU3RvcmVkQ3JlZGVudGlhbHMoKSB7CiAgICAgICAgICAgICAgICB0aGlzLmFjY2Vzc1Rva2VuID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2dvb2dsZV9hY2Nlc3NfdG9rZW4nKTsKICAgICAgICAgICAgICAgIHRoaXMucmVmcmVzaFRva2VuID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2dvb2dsZV9yZWZyZXNoX3Rva2VuJyk7CiAgICAgICAgICAgICAgICB0aGlzLmNsaWVudFNlY3JldCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdnb29nbGVfY2xpZW50X3NlY3JldCcpOwogICAgICAgICAgICAgICAgdGhpcy5pc0F1dGhlbnRpY2F0ZWQgPSAhISh0aGlzLmFjY2Vzc1Rva2VuICYmIHRoaXMucmVmcmVzaFRva2VuICYmIHRoaXMuY2xpZW50U2VjcmV0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgc3RvcmVDcmVkZW50aWFscygpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmFjY2Vzc1Rva2VuKSBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnZ29vZ2xlX2FjY2Vzc190b2tlbicsIHRoaXMuYWNjZXNzVG9rZW4pOwogICAgICAgICAgICAgICAgaWYgKHRoaXMucmVmcmVzaFRva2VuKSBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnZ29vZ2xlX3JlZnJlc2hfdG9rZW4nLCB0aGlzLnJlZnJlc2hUb2tlbik7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5jbGllbnRTZWNyZXQpIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdnb29nbGVfY2xpZW50X3NlY3JldCcsIHRoaXMuY2xpZW50U2VjcmV0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgY2xlYXJTdG9yZWRDcmVkZW50aWFscygpIHsKICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCdnb29nbGVfYWNjZXNzX3Rva2VuJyk7CiAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgnZ29vZ2xlX3JlZnJlc2hfdG9rZW4nKTsKICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCdnb29nbGVfY2xpZW50X3NlY3JldCcpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBhc3luYyBhdXRoZW50aWNhdGUoY2xpZW50U2VjcmV0KSB7CiAgICAgICAgICAgICAgICBpZiAoY2xpZW50U2VjcmV0KSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGllbnRTZWNyZXQgPSBjbGllbnRTZWNyZXQ7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdG9yZUNyZWRlbnRpYWxzKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmICghdGhpcy5jbGllbnRTZWNyZXQpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NsaWVudCBzZWNyZXQgaXMgcmVxdWlyZWQgZm9yIEdvb2dsZSBEcml2ZSBhdXRoZW50aWNhdGlvbicpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAodGhpcy5hY2Nlc3NUb2tlbiAmJiB0aGlzLnJlZnJlc2hUb2tlbikgewogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMubWFrZUFwaUNhbGwoJy9maWxlcz9wYWdlU2l6ZT0xJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXNBdXRoZW50aWNhdGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0V4aXN0aW5nIHRva2VucyBpbnZhbGlkLCBzdGFydGluZyBmcmVzaCBhdXRoZW50aWNhdGlvbicpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBhdXRoVXJsID0gdGhpcy5idWlsZEF1dGhVcmwoKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBwb3B1cCA9IHdpbmRvdy5vcGVuKGF1dGhVcmwsICdnb29nbGUtYXV0aCcsICd3aWR0aD01MDAsaGVpZ2h0PTYwMCxzY3JvbGxiYXJzPXllcyxyZXNpemFibGU9eWVzJyk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgKCFwb3B1cCkgewogICAgICAgICAgICAgICAgICAgICAgICByZWplY3QobmV3IEVycm9yKCdQb3B1cCBibG9ja2VkIGJ5IGJyb3dzZXInKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2hlY2tDbG9zZWQgPSBzZXRJbnRlcnZhbCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwb3B1cC5jbG9zZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoY2hlY2tDbG9zZWQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcignQXV0aGVudGljYXRpb24gY2FuY2VsbGVkJykpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwgMTAwMCk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgY29uc3QgbWVzc2FnZUhhbmRsZXIgPSBhc3luYyAoZXZlbnQpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50Lm9yaWdpbiAhPT0gd2luZG93LmxvY2F0aW9uLm9yaWdpbikgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50LmRhdGEudHlwZSA9PT0gJ0dPT0dMRV9BVVRIX1NVQ0NFU1MnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKGNoZWNrQ2xvc2VkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgbWVzc2FnZUhhbmRsZXIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9wdXAuY2xvc2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmV4Y2hhbmdlQ29kZUZvclRva2VucyhldmVudC5kYXRhLmNvZGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXNBdXRoZW50aWNhdGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyb3IpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LmRhdGEudHlwZSA9PT0gJ0dPT0dMRV9BVVRIX0VSUk9SJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChjaGVja0Nsb3NlZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIG1lc3NhZ2VIYW5kbGVyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvcHVwLmNsb3NlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QobmV3IEVycm9yKGV2ZW50LmRhdGEuZXJyb3IpKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCBtZXNzYWdlSGFuZGxlcik7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgYnVpbGRBdXRoVXJsKCkgewogICAgICAgICAgICAgICAgY29uc3QgcGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcyh7CiAgICAgICAgICAgICAgICAgICAgY2xpZW50X2lkOiB0aGlzLmNsaWVudElkLAogICAgICAgICAgICAgICAgICAgIHJlZGlyZWN0X3VyaTogdGhpcy5yZWRpcmVjdFVyaSwKICAgICAgICAgICAgICAgICAgICByZXNwb25zZV90eXBlOiAnY29kZScsCiAgICAgICAgICAgICAgICAgICAgc2NvcGU6IHRoaXMuc2NvcGUsCiAgICAgICAgICAgICAgICAgICAgYWNjZXNzX3R5cGU6ICdvZmZsaW5lJywKICAgICAgICAgICAgICAgICAgICBwcm9tcHQ6ICdjb25zZW50JwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICByZXR1cm4gYGh0dHBzOi8vYWNjb3VudHMuZ29vZ2xlLmNvbS9vL29hdXRoMi92Mi9hdXRoPyR7cGFyYW1zLnRvU3RyaW5nKCl9YDsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgYXN5bmMgZXhjaGFuZ2VDb2RlRm9yVG9rZW5zKGNvZGUpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goJ2h0dHBzOi8vb2F1dGgyLmdvb2dsZWFwaXMuY29tL3Rva2VuJywgewogICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLAogICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnIH0sCiAgICAgICAgICAgICAgICAgICAgYm9keTogbmV3IFVSTFNlYXJjaFBhcmFtcyh7CiAgICAgICAgICAgICAgICAgICAgICAgIGNsaWVudF9pZDogdGhpcy5jbGllbnRJZCwKICAgICAgICAgICAgICAgICAgICAgICAgY2xpZW50X3NlY3JldDogdGhpcy5jbGllbnRTZWNyZXQsCiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGU6IGNvZGUsCiAgICAgICAgICAgICAgICAgICAgICAgIGdyYW50X3R5cGU6ICdhdXRob3JpemF0aW9uX2NvZGUnLAogICAgICAgICAgICAgICAgICAgICAgICByZWRpcmVjdF91cmk6IHRoaXMucmVkaXJlY3RVcmkKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2Uub2spIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBlcnJvclRleHQgPSBhd2FpdCByZXNwb25zZS50ZXh0KCk7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBUb2tlbiBleGNoYW5nZSBmYWlsZWQ6ICR7cmVzcG9uc2Uuc3RhdHVzfSAtICR7ZXJyb3JUZXh0fWApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb25zdCB0b2tlbnMgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7CiAgICAgICAgICAgICAgICB0aGlzLmFjY2Vzc1Rva2VuID0gdG9rZW5zLmFjY2Vzc190b2tlbjsKICAgICAgICAgICAgICAgIHRoaXMucmVmcmVzaFRva2VuID0gdG9rZW5zLnJlZnJlc2hfdG9rZW47CiAgICAgICAgICAgICAgICB0aGlzLnN0b3JlQ3JlZGVudGlhbHMoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgYXN5bmMgcmVmcmVzaEFjY2Vzc1Rva2VuKCkgewogICAgICAgICAgICAgICAgaWYgKCF0aGlzLnJlZnJlc2hUb2tlbiB8fCAhdGhpcy5jbGllbnRTZWNyZXQpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIHJlZnJlc2ggdG9rZW4gb3IgY2xpZW50IHNlY3JldCBhdmFpbGFibGUnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCgnaHR0cHM6Ly9vYXV0aDIuZ29vZ2xlYXBpcy5jb20vdG9rZW4nLCB7CiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsCiAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCcgfSwKICAgICAgICAgICAgICAgICAgICBib2R5OiBuZXcgVVJMU2VhcmNoUGFyYW1zKHsKICAgICAgICAgICAgICAgICAgICAgICAgY2xpZW50X2lkOiB0aGlzLmNsaWVudElkLAogICAgICAgICAgICAgICAgICAgICAgICBjbGllbnRfc2VjcmV0OiB0aGlzLmNsaWVudFNlY3JldCwKICAgICAgICAgICAgICAgICAgICAgICAgcmVmcmVzaF90b2tlbjogdGhpcy5yZWZyZXNoVG9rZW4sCiAgICAgICAgICAgICAgICAgICAgICAgIGdyYW50X3R5cGU6ICdyZWZyZXNoX3Rva2VuJwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5vaykgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIHJlZnJlc2ggYWNjZXNzIHRva2VuJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNvbnN0IHRva2VucyA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTsKICAgICAgICAgICAgICAgIHRoaXMuYWNjZXNzVG9rZW4gPSB0b2tlbnMuYWNjZXNzX3Rva2VuOwogICAgICAgICAgICAgICAgdGhpcy5zdG9yZUNyZWRlbnRpYWxzKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5hY2Nlc3NUb2tlbjsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgYXN5bmMgbWFrZUFwaUNhbGwoZW5kcG9pbnQsIG9wdGlvbnMgPSB7fSkgewogICAgICAgICAgICAgICAgaWYgKCF0aGlzLmFjY2Vzc1Rva2VuKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdOb3QgYXV0aGVudGljYXRlZCcpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb25zdCB1cmwgPSBgJHt0aGlzLmFwaUJhc2V9JHtlbmRwb2ludH1gOwogICAgICAgICAgICAgICAgY29uc3QgaGVhZGVycyA9IHsKICAgICAgICAgICAgICAgICAgICAnQXV0aG9yaXphdGlvbic6IGBCZWFyZXIgJHt0aGlzLmFjY2Vzc1Rva2VufWAsCiAgICAgICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJywKICAgICAgICAgICAgICAgICAgICAuLi5vcHRpb25zLmhlYWRlcnMKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxldCByZXNwb25zZSA9IGF3YWl0IGZldGNoKHVybCwgeyAuLi5vcHRpb25zLCBoZWFkZXJzIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MDEgJiYgdGhpcy5yZWZyZXNoVG9rZW4gJiYgdGhpcy5jbGllbnRTZWNyZXQpIHsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnJlZnJlc2hBY2Nlc3NUb2tlbigpOwogICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzWydBdXRob3JpemF0aW9uJ10gPSBgQmVhcmVyICR7dGhpcy5hY2Nlc3NUb2tlbn1gOwogICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZSA9IGF3YWl0IGZldGNoKHVybCwgeyAuLi5vcHRpb25zLCBoZWFkZXJzIH0pOwogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKHJlZnJlc2hFcnJvcikgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzQXV0aGVudGljYXRlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNsZWFyU3RvcmVkQ3JlZGVudGlhbHMoKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdBdXRoZW50aWNhdGlvbiBleHBpcmVkLiBQbGVhc2UgcmVjb25uZWN0LicpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5vaykgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGVycm9yVGV4dCA9IGF3YWl0IHJlc3BvbnNlLnRleHQoKTsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEFQSSBjYWxsIGZhaWxlZDogJHtyZXNwb25zZS5zdGF0dXNUZXh0fSAtICR7ZXJyb3JUZXh0fWApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXR1cm4gYXdhaXQgcmVzcG9uc2UuanNvbigpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBhc3luYyBnZXRGb2xkZXJzKCkgewogICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLm1ha2VBcGlDYWxsKCcvZmlsZXM/cT1taW1lVHlwZSUzRCUyN2FwcGxpY2F0aW9uL3ZuZC5nb29nbGUtYXBwcy5mb2xkZXIlMjcmZmllbGRzPWZpbGVzKGlkLG5hbWUsY3JlYXRlZFRpbWUsbW9kaWZpZWRUaW1lKSZvcmRlckJ5PW1vZGlmaWVkVGltZSUyMGRlc2MnKTsKICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5maWxlcy5tYXAoZm9sZGVyID0+ICh7CiAgICAgICAgICAgICAgICAgICAgaWQ6IGZvbGRlci5pZCwKICAgICAgICAgICAgICAgICAgICBuYW1lOiBmb2xkZXIubmFtZSwKICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZm9sZGVyJywKICAgICAgICAgICAgICAgICAgICBjcmVhdGVkVGltZTogZm9sZGVyLmNyZWF0ZWRUaW1lLAogICAgICAgICAgICAgICAgICAgIG1vZGlmaWVkVGltZTogZm9sZGVyLm1vZGlmaWVkVGltZQogICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBhc3luYyBnZXRGaWxlcyhmb2xkZXJJZCA9ICdyb290JykgewogICAgICAgICAgICAgICAgY29uc3QgYWxsRmlsZXMgPSBbXTsKICAgICAgICAgICAgICAgIGxldCBuZXh0UGFnZVRva2VuID0gbnVsbDsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHF1ZXJ5ID0gYCcke2ZvbGRlcklkfScgaW4gcGFyZW50cyBhbmQgdHJhc2hlZD1mYWxzZSBhbmQgKG1pbWVUeXBlIGNvbnRhaW5zICdpbWFnZS8nKWA7CiAgICAgICAgICAgICAgICAgICAgbGV0IHVybCA9IGAvZmlsZXM/cT0ke2VuY29kZVVSSUNvbXBvbmVudChxdWVyeSl9JmZpZWxkcz1maWxlcyhpZCxuYW1lLG1pbWVUeXBlLHNpemUsY3JlYXRlZFRpbWUsbW9kaWZpZWRUaW1lLHRodW1ibmFpbExpbmssd2ViQ29udGVudExpbmssYXBwUHJvcGVydGllcyksbmV4dFBhZ2VUb2tlbiZwYWdlU2l6ZT0xMDBgOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIChuZXh0UGFnZVRva2VuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVybCArPSBgJnBhZ2VUb2tlbj0ke25leHRQYWdlVG9rZW59YDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLm1ha2VBcGlDYWxsKHVybCk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZmlsZXMgPSByZXNwb25zZS5maWxlcwogICAgICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKGZpbGUgPT4gZmlsZS5taW1lVHlwZSAmJiBmaWxlLm1pbWVUeXBlLnN0YXJ0c1dpdGgoJ2ltYWdlLycpKQogICAgICAgICAgICAgICAgICAgICAgICAubWFwKGZpbGUgPT4gKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBmaWxlLmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogZmlsZS5uYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2ZpbGUnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWltZVR5cGU6IGZpbGUubWltZVR5cGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaXplOiBmaWxlLnNpemUgPyBwYXJzZUludChmaWxlLnNpemUpIDogMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZWRUaW1lOiBmaWxlLmNyZWF0ZWRUaW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kaWZpZWRUaW1lOiBmaWxlLm1vZGlmaWVkVGltZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRodW1ibmFpbExpbms6IGZpbGUudGh1bWJuYWlsTGluaywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvd25sb2FkVXJsOiBmaWxlLndlYkNvbnRlbnRMaW5rLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwUHJvcGVydGllczogZmlsZS5hcHBQcm9wZXJ0aWVzIHx8IHt9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBhbGxGaWxlcy5wdXNoKC4uLmZpbGVzKTsKICAgICAgICAgICAgICAgICAgICBuZXh0UGFnZVRva2VuID0gcmVzcG9uc2UubmV4dFBhZ2VUb2tlbjsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5vblByb2dyZXNzQ2FsbGJhY2spIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vblByb2dyZXNzQ2FsbGJhY2soYWxsRmlsZXMubGVuZ3RoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB9IHdoaWxlIChuZXh0UGFnZVRva2VuKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmV0dXJuIHsgZm9sZGVyczogW10sIGZpbGVzOiBhbGxGaWxlcyB9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBhc3luYyBtb3ZlRmlsZVRvU3RhY2soZmlsZUlkLCB0YXJnZXRTdGFjaykgewogICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5tYWtlQXBpQ2FsbChgL2ZpbGVzLyR7ZmlsZUlkfWAsIHsKICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdQQVRDSCcsCiAgICAgICAgICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoewogICAgICAgICAgICAgICAgICAgICAgICBhcHBQcm9wZXJ0aWVzOiB7IHNsaWRlYm94U3RhY2s6IHRhcmdldFN0YWNrIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgYXN5bmMgdXBkYXRlRmlsZVByb3BlcnRpZXMoZmlsZUlkLCBwcm9wZXJ0aWVzKSB7CiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLm1ha2VBcGlDYWxsKGAvZmlsZXMvJHtmaWxlSWR9YCwgewogICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BBVENIJywKICAgICAgICAgICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7CiAgICAgICAgICAgICAgICAgICAgICAgIGFwcFByb3BlcnRpZXM6IHByb3BlcnRpZXMKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgYXN5bmMgZGVsZXRlRmlsZShmaWxlSWQpIHsKICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMubWFrZUFwaUNhbGwoYC9maWxlcy8ke2ZpbGVJZH1gLCB7CiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnUEFUQ0gnLAogICAgICAgICAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgdHJhc2hlZDogdHJ1ZSB9KQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgYXN5bmMgZGlzY29ubmVjdCgpIHsKICAgICAgICAgICAgICAgIHN1cGVyLmRpc2Nvbm5lY3QoKTsKICAgICAgICAgICAgICAgIHRoaXMuYWNjZXNzVG9rZW4gPSBudWxsOwogICAgICAgICAgICAgICAgdGhpcy5yZWZyZXNoVG9rZW4gPSBudWxsOwogICAgICAgICAgICAgICAgdGhpcy5jbGllbnRTZWNyZXQgPSBudWxsOwogICAgICAgICAgICAgICAgdGhpcy5jbGVhclN0b3JlZENyZWRlbnRpYWxzKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIEhhbmRsZSBPQXV0aCBjYWxsYmFjawogICAgICAgIGlmICh3aW5kb3cubG9jYXRpb24uc2VhcmNoLmluY2x1ZGVzKCdjb2RlPScpIHx8IHdpbmRvdy5sb2NhdGlvbi5zZWFyY2guaW5jbHVkZXMoJ2Vycm9yPScpKSB7CiAgICAgICAgICAgIGNvbnN0IHVybFBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMod2luZG93LmxvY2F0aW9uLnNlYXJjaCk7CiAgICAgICAgICAgIGNvbnN0IGNvZGUgPSB1cmxQYXJhbXMuZ2V0KCdjb2RlJyk7CiAgICAgICAgICAgIGNvbnN0IGVycm9yID0gdXJsUGFyYW1zLmdldCgnZXJyb3InKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICh3aW5kb3cub3BlbmVyKSB7CiAgICAgICAgICAgICAgICBpZiAoZXJyb3IpIHsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cub3BlbmVyLnBvc3RNZXNzYWdlKHsgdHlwZTogJ0dPT0dMRV9BVVRIX0VSUk9SJywgZXJyb3I6IGVycm9yIH0sIHdpbmRvdy5sb2NhdGlvbi5vcmlnaW4pOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjb2RlKSB7CiAgICAgICAgICAgICAgICAgICAgd2luZG93Lm9wZW5lci5wb3N0TWVzc2FnZSh7IHR5cGU6ICdHT09HTEVfQVVUSF9TVUNDRVNTJywgY29kZTogY29kZSB9LCB3aW5kb3cubG9jYXRpb24ub3JpZ2luKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHdpbmRvdy5jbG9zZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyA9PT09PSBBcHAgQ29uZmlndXJhdGlvbiA9PT09PQogICAgICAgIGNvbnN0IFNUQUNLX1RZUEVTID0gWydpbicsICdvdXQnLCAncHJpb3JpdHknLCAndHJhc2gnXTsKICAgICAgICAKICAgICAgICBjb25zdCBhcHBTdGF0ZSA9IHsKICAgICAgICAgICAgY2xvdWRTdG9yYWdlOiBudWxsLAogICAgICAgICAgICBtZXRhZGF0YUV4dHJhY3RvcjogbnVsbCwKICAgICAgICAgICAgY3VycmVudEZvbGRlcjogeyBpZDogbnVsbCwgbmFtZTogJycgfSwKICAgICAgICAgICAgaW1hZ2VGaWxlczogW10sCiAgICAgICAgICAgIGN1cnJlbnRJbWFnZUluZGV4OiAwLAogICAgICAgICAgICBjdXJyZW50U3RhY2s6ICdpbicsCiAgICAgICAgICAgIHN0YWNrczogeyBpbjogW10sIG91dDogW10sIHByaW9yaXR5OiBbXSwgdHJhc2g6IFtdIH0sCiAgICAgICAgICAgIGlzRHJhZ2dpbmc6IGZhbHNlLAogICAgICAgICAgICBpc1BpbmNoaW5nOiBmYWxzZSwKICAgICAgICAgICAgaW5pdGlhbERpc3RhbmNlOiAwLAogICAgICAgICAgICBjdXJyZW50U2NhbGU6IDEsCiAgICAgICAgICAgIG1heFNjYWxlOiA0LAogICAgICAgICAgICBtaW5TY2FsZTogMC4zLAogICAgICAgICAgICBwYW5PZmZzZXQ6IHsgeDogMCwgeTogMCB9LAogICAgICAgICAgICBncmlkOiB7IHN0YWNrOiBudWxsLCBzZWxlY3RlZDogW10gfSwKICAgICAgICAgICAgdGFnczogbmV3IFNldCgpLAogICAgICAgICAgICBpbWFnZUNhY2hlOiBuZXcgTWFwKCksCiAgICAgICAgICAgIGxvYWRpbmdQcm9ncmVzczogeyBjdXJyZW50OiAwLCB0b3RhbDogMCB9CiAgICAgICAgfTsKICAgICAgICAKICAgICAgICAvLyA9PT09PSBET00gRWxlbWVudHMgPT09PT0KICAgICAgICBjb25zdCBlbGVtZW50cyA9IHsKICAgICAgICAgICAgYXV0aFNjcmVlbjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2F1dGgtc2NyZWVuJyksCiAgICAgICAgICAgIGZvbGRlclNjcmVlbjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZvbGRlci1zY3JlZW4nKSwKICAgICAgICAgICAgbG9hZGluZ1NjcmVlbjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWRpbmctc2NyZWVuJyksCiAgICAgICAgICAgIGFwcENvbnRhaW5lcjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FwcC1jb250YWluZXInKSwKICAgICAgICAgICAgY2xpZW50U2VjcmV0OiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2xpZW50LXNlY3JldCcpLAogICAgICAgICAgICBhdXRoQnV0dG9uOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYXV0aC1idXR0b24nKSwKICAgICAgICAgICAgYXV0aFN0YXR1czogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2F1dGgtc3RhdHVzJyksCiAgICAgICAgICAgIGZvbGRlckxpc3Q6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmb2xkZXItbGlzdCcpLAogICAgICAgICAgICByZWZyZXNoRm9sZGVyczogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JlZnJlc2gtZm9sZGVycycpLAogICAgICAgICAgICBsb2dvdXQ6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2dvdXQnKSwKICAgICAgICAgICAgYmFja0J1dHRvbjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JhY2stYnV0dG9uJyksCiAgICAgICAgICAgIGRldGFpbHNCdXR0b246IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZXRhaWxzLWJ1dHRvbicpLAogICAgICAgICAgICBpbWFnZVZpZXdwb3J0OiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW1hZ2Utdmlld3BvcnQnKSwKICAgICAgICAgICAgY2VudGVySW1hZ2U6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjZW50ZXItaW1hZ2UnKSwKICAgICAgICAgICAgZW1wdHlTdGF0ZTogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VtcHR5LXN0YXRlJyksCiAgICAgICAgICAgIHNlbGVjdEFub3RoZXJTdGFja0J0bjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlbGVjdC1hbm90aGVyLXN0YWNrLWJ0bicpLAogICAgICAgICAgICBzZWxlY3RBbm90aGVyRm9sZGVyQnRuOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VsZWN0LWFub3RoZXItZm9sZGVyLWJ0bicpLAogICAgICAgICAgICB0b2FzdDogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvYXN0JyksCiAgICAgICAgICAgIGxvYWRpbmdDb3VudGVyOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGluZy1jb3VudGVyJyksCiAgICAgICAgICAgIGxvYWRpbmdNZXNzYWdlOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGluZy1tZXNzYWdlJyksCiAgICAgICAgICAgIGxvYWRpbmdQcm9ncmVzc0JhcjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWRpbmctcHJvZ3Jlc3MtYmFyJyksCiAgICAgICAgICAgIGVkZ2VHbG93czogewogICAgICAgICAgICAgICAgdG9wOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWRnZS10b3AnKSwKICAgICAgICAgICAgICAgIGJvdHRvbTogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkZ2UtYm90dG9tJyksCiAgICAgICAgICAgICAgICBsZWZ0OiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWRnZS1sZWZ0JyksCiAgICAgICAgICAgICAgICByaWdodDogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkZ2UtcmlnaHQnKQogICAgICAgICAgICB9LAogICAgICAgICAgICBwaWxsQ291bnRlcnM6IHsKICAgICAgICAgICAgICAgIHByaW9yaXR5OiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGlsbC1wcmlvcml0eScpLAogICAgICAgICAgICAgICAgdHJhc2g6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwaWxsLXRyYXNoJyksCiAgICAgICAgICAgICAgICBpbjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BpbGwtaW4nKSwKICAgICAgICAgICAgICAgIG91dDogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BpbGwtb3V0JykKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZ3JpZE1vZGFsOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ3JpZC1tb2RhbCcpLAogICAgICAgICAgICBncmlkVGl0bGU6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdncmlkLXRpdGxlJyksCiAgICAgICAgICAgIGdyaWRDb250YWluZXI6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdncmlkLWNvbnRhaW5lcicpLAogICAgICAgICAgICBzZWxlY3RBbGxCdG46IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZWxlY3QtYWxsLWJ0bicpLAogICAgICAgICAgICBkZXNlbGVjdEFsbEJ0bjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Rlc2VsZWN0LWFsbC1idG4nKSwKICAgICAgICAgICAgc2VsZWN0aW9uVGV4dDogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlbGVjdGlvbi10ZXh0JyksCiAgICAgICAgICAgIGNsb3NlR3JpZDogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Nsb3NlLWdyaWQnKSwKICAgICAgICAgICAgZ3JpZFNpemU6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdncmlkLXNpemUnKSwKICAgICAgICAgICAgZ3JpZFNpemVWYWx1ZTogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dyaWQtc2l6ZS12YWx1ZScpLAogICAgICAgICAgICBncmlkU29ydDogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dyaWQtc29ydCcpLAogICAgICAgICAgICB0YWdTZWxlY3RlZDogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RhZy1zZWxlY3RlZCcpLAogICAgICAgICAgICBtb3ZlU2VsZWN0ZWQ6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb3ZlLXNlbGVjdGVkJyksCiAgICAgICAgICAgIGRlbGV0ZVNlbGVjdGVkOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGVsZXRlLXNlbGVjdGVkJyksCiAgICAgICAgICAgIG1vdmVNb2RhbDogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21vdmUtbW9kYWwnKSwKICAgICAgICAgICAgdGFnTW9kYWw6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0YWctbW9kYWwnKSwKICAgICAgICAgICAgZGVsZXRlTW9kYWw6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZWxldGUtbW9kYWwnKSwKICAgICAgICAgICAgdGFnSW5wdXQ6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0YWctaW5wdXQnKSwKICAgICAgICAgICAgdGFnU3VnZ2VzdGlvbnM6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0YWctc3VnZ2VzdGlvbnMnKSwKICAgICAgICAgICAgZGVsZXRlTWVzc2FnZTogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RlbGV0ZS1tZXNzYWdlJyksCiAgICAgICAgICAgIGNvbmZpcm1EZWxldGU6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb25maXJtLWRlbGV0ZScpLAogICAgICAgICAgICBkZXRhaWxzTW9kYWw6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZXRhaWxzLW1vZGFsJyksCiAgICAgICAgICAgIGRldGFpbHNDbG9zZTogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RldGFpbHMtY2xvc2UnKSwKICAgICAgICAgICAgZGV0YWlsRmlsZW5hbWU6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZXRhaWwtZmlsZW5hbWUnKSwKICAgICAgICAgICAgZGV0YWlsRmlsZW5hbWVMaW5rOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGV0YWlsLWZpbGVuYW1lLWxpbmsnKSwKICAgICAgICAgICAgZGV0YWlsRGF0ZTogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RldGFpbC1kYXRlJyksCiAgICAgICAgICAgIGRldGFpbFNpemU6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZXRhaWwtc2l6ZScpLAogICAgICAgICAgICBkZXRhaWxUYWdzOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGV0YWlsLXRhZ3MnKSwKICAgICAgICAgICAgZGV0YWlsTm90ZXM6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZXRhaWwtbm90ZXMnKSwKICAgICAgICAgICAgcXVhbGl0eVJhdGluZzogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3F1YWxpdHktcmF0aW5nJyksCiAgICAgICAgICAgIGNvbnRlbnRSYXRpbmc6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb250ZW50LXJhdGluZycpLAogICAgICAgICAgICBtZXRhZGF0YVRhYmxlOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWV0YWRhdGEtdGFibGUnKQogICAgICAgIH07CgogICAgICAgIC8vID09PT09IENhY2hlIE1hbmFnZXIgPT09PT0KICAgICAgICBjb25zdCBjYWNoZU1hbmFnZXIgPSB7CiAgICAgICAgICAgIGFzeW5jIGluaXQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlcXVlc3QgPSBpbmRleGVkREIub3BlbignT3JiaXRhbDhDYWNoZScsIDEpOwogICAgICAgICAgICAgICAgICAgIHJlcXVlc3Qub25lcnJvciA9ICgpID0+IHJlamVjdChyZXF1ZXN0LmVycm9yKTsKICAgICAgICAgICAgICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9ICgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgYXBwU3RhdGUuZGIgPSByZXF1ZXN0LnJlc3VsdDsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgpOwogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5vbnVwZ3JhZGVuZWVkZWQgPSAoZXZlbnQpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGIgPSBldmVudC50YXJnZXQucmVzdWx0OwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWRiLm9iamVjdFN0b3JlTmFtZXMuY29udGFpbnMoJ3RodW1ibmFpbHMnKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGIuY3JlYXRlT2JqZWN0U3RvcmUoJ3RodW1ibmFpbHMnLCB7IGtleVBhdGg6ICdpZCcgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIAogICAgICAgICAgICBhc3luYyBjYWNoZVRodW1ibmFpbChmaWxlSWQsIHVybCkgewogICAgICAgICAgICAgICAgaWYgKCFhcHBTdGF0ZS5kYikgcmV0dXJuOwogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB0cmFuc2FjdGlvbiA9IGFwcFN0YXRlLmRiLnRyYW5zYWN0aW9uKFsndGh1bWJuYWlscyddLCAncmVhZHdyaXRlJyk7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RvcmUgPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZSgndGh1bWJuYWlscycpOwogICAgICAgICAgICAgICAgICAgIGF3YWl0IHN0b3JlLnB1dCh7IGlkOiBmaWxlSWQsIHVybCwgdGltZXN0YW1wOiBEYXRlLm5vdygpIH0pOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ0ZhaWxlZCB0byBjYWNoZSB0aHVtYm5haWw6JywgZXJyb3IpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICAKICAgICAgICAgICAgYXN5bmMgZ2V0Q2FjaGVkVGh1bWJuYWlsKGZpbGVJZCkgewogICAgICAgICAgICAgICAgaWYgKCFhcHBTdGF0ZS5kYikgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5zYWN0aW9uID0gYXBwU3RhdGUuZGIudHJhbnNhY3Rpb24oWyd0aHVtYm5haWxzJ10sICdyZWFkb25seScpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoJ3RodW1ibmFpbHMnKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzdG9yZS5nZXQoZmlsZUlkKTsKICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0ICYmIChEYXRlLm5vdygpIC0gcmVzdWx0LnRpbWVzdGFtcCA8IDI0ICogNjAgKiA2MCAqIDEwMDApKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQudXJsOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdGYWlsZWQgdG8gZ2V0IGNhY2hlZCB0aHVtYm5haWw6JywgZXJyb3IpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIAogICAgICAgIC8vID09PT09IFV0aWxpdHkgRnVuY3Rpb25zID09PT09CiAgICAgICAgZnVuY3Rpb24gZ2V0RGlzdGFuY2UodG91Y2gxLCB0b3VjaDIpIHsKICAgICAgICAgICAgY29uc3QgZHggPSB0b3VjaDEuY2xpZW50WCAtIHRvdWNoMi5jbGllbnRYOwogICAgICAgICAgICBjb25zdCBkeSA9IHRvdWNoMS5jbGllbnRZIC0gdG91Y2gyLmNsaWVudFk7CiAgICAgICAgICAgIHJldHVybiBNYXRoLnNxcnQoZHggKiBkeCArIGR5ICogZHkpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBmdW5jdGlvbiBnZXRDZW50ZXIodG91Y2gxLCB0b3VjaDIpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIHg6ICh0b3VjaDEuY2xpZW50WCArIHRvdWNoMi5jbGllbnRYKSAvIDIsCiAgICAgICAgICAgICAgICB5OiAodG91Y2gxLmNsaWVudFkgKyB0b3VjaDIuY2xpZW50WSkgLyAyCiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGNvbnN0IHV0aWxzID0gewogICAgICAgICAgICBzaG93U2NyZWVuOiBmdW5jdGlvbihzY3JlZW5JZCkgewogICAgICAgICAgICAgICAgY29uc3Qgc2NyZWVucyA9IFtlbGVtZW50cy5hdXRoU2NyZWVuLCBlbGVtZW50cy5mb2xkZXJTY3JlZW4sIGVsZW1lbnRzLmxvYWRpbmdTY3JlZW4sIGVsZW1lbnRzLmFwcENvbnRhaW5lcl07CiAgICAgICAgICAgICAgICBzY3JlZW5zLmZvckVhY2goc2NyZWVuID0+IHsKICAgICAgICAgICAgICAgICAgICBzY3JlZW4uY2xhc3NMaXN0LnRvZ2dsZSgnaGlkZGVuJywgc2NyZWVuLmlkICE9PSBzY3JlZW5JZCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgCiAgICAgICAgICAgIHNob3dUb2FzdDogZnVuY3Rpb24obWVzc2FnZSwgdHlwZSA9ICdzdWNjZXNzJykgewogICAgICAgICAgICAgICAgY29uc3QgdG9hc3QgPSBlbGVtZW50cy50b2FzdDsKICAgICAgICAgICAgICAgIHRvYXN0LnRleHRDb250ZW50ID0gbWVzc2FnZTsKICAgICAgICAgICAgICAgIHRvYXN0LmNsYXNzTmFtZSA9IGB0b2FzdCAke3R5cGV9IHNob3dgOwogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7IHRvYXN0LmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3cnKTsgfSwgMzAwMCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIAogICAgICAgICAgICB1cGRhdGVMb2FkaW5nUHJvZ3Jlc3M6IGZ1bmN0aW9uKGN1cnJlbnQsIHRvdGFsKSB7CiAgICAgICAgICAgICAgICBhcHBTdGF0ZS5sb2FkaW5nUHJvZ3Jlc3MgPSB7IGN1cnJlbnQsIHRvdGFsIH07CiAgICAgICAgICAgICAgICBlbGVtZW50cy5sb2FkaW5nQ291bnRlci50ZXh0Q29udGVudCA9IGN1cnJlbnQ7CiAgICAgICAgICAgICAgICBlbGVtZW50cy5sb2FkaW5nTWVzc2FnZS50ZXh0Q29udGVudCA9IHRvdGFsID8gCiAgICAgICAgICAgICAgICAgICAgYFByb2Nlc3NpbmcgJHtjdXJyZW50fSBvZiAke3RvdGFsfSBpbWFnZXMuLi5gIDogCiAgICAgICAgICAgICAgICAgICAgYEZvdW5kICR7Y3VycmVudH0gaW1hZ2VzYDsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKHRvdGFsID4gMCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHBlcmNlbnRhZ2UgPSAoY3VycmVudCAvIHRvdGFsKSAqIDEwMDsKICAgICAgICAgICAgICAgICAgICBlbGVtZW50cy5sb2FkaW5nUHJvZ3Jlc3NCYXIuc3R5bGUud2lkdGggPSBgJHtwZXJjZW50YWdlfSVgOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICAKICAgICAgICAgICAgc2V0SW1hZ2VTcmM6IGFzeW5jIGZ1bmN0aW9uKGltZywgZmlsZSkgewogICAgICAgICAgICAgICAgbGV0IGltYWdlVXJsID0gYXBwU3RhdGUuaW1hZ2VDYWNoZS5nZXQoZmlsZS5pZCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmICghaW1hZ2VVcmwpIHsKICAgICAgICAgICAgICAgICAgICBpbWFnZVVybCA9IGF3YWl0IGNhY2hlTWFuYWdlci5nZXRDYWNoZWRUaHVtYm5haWwoZmlsZS5pZCk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgKCFpbWFnZVVybCkgewogICAgICAgICAgICAgICAgICAgICAgICBpbWFnZVVybCA9IGZpbGUudGh1bWJuYWlsTGluayA/IGZpbGUudGh1bWJuYWlsTGluay5yZXBsYWNlKCc9czIyMCcsICc9czEwMDAnKSA6IGZpbGUuZG93bmxvYWRVcmw7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW1hZ2VVcmwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcFN0YXRlLmltYWdlQ2FjaGUuc2V0KGZpbGUuaWQsIGltYWdlVXJsKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IGNhY2hlTWFuYWdlci5jYWNoZVRodW1ibmFpbChmaWxlLmlkLCBpbWFnZVVybCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBhcHBTdGF0ZS5pbWFnZUNhY2hlLnNldChmaWxlLmlkLCBpbWFnZVVybCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAoaW1hZ2VVcmwpIHsKICAgICAgICAgICAgICAgICAgICBpbWcuc3JjID0gaW1hZ2VVcmw7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGltZy5zcmMgPSAnZGF0YTppbWFnZS9zdmcreG1sLCUzQ3N2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNTAiIGhlaWdodD0iMTUwIiB2aWV3Qm94PSIwIDAgMTUwIDE1MCIgZmlsbD0ibm9uZSIlM0UlM0NyZWN0IHdpZHRoPSIxNTAiIGhlaWdodD0iMTUwIiBmaWxsPSIlMjNFNUU3RUIiLyUzRSUzQ3BhdGggZD0iTTY1IDYwSDg1VjkwSDY1VjYwWiIgZmlsbD0iJTIzOUNBM0FGIi8lM0UlM0NjaXJjbGUgY3g9Ijc1IiBjeT0iNDUiIHI9IjEwIiBmaWxsPSIlMjM5Q0EzQUYiLyUzRSUzQy9zdmclM0UnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpbWcuYWx0ID0gZmlsZS5uYW1lIHx8ICdJbWFnZSc7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgICAgIGltZy5vbmxvYWQgPSAoKSA9PiByZXNvbHZlKCk7CiAgICAgICAgICAgICAgICAgICAgaW1nLm9uZXJyb3IgPSAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGltZy5zcmMgPSAnZGF0YTppbWFnZS9zdmcreG1sLCUzQ3N2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNTAiIGhlaWdodD0iMTUwIiB2aWV3Qm94PSIwIDAgMTUwIDE1MCIgZmlsbD0ibm9uZSIlM0UlM0NyZWN0IHdpZHRoPSIxNTAiIGhlaWdodD0iMTUwIiBmaWxsPSIlMjNFNUU3RUIiLyUzRSUzQ3BhdGggZD0iTTY1IDYwSDg1VjkwSDY1VjYwWiIgZmlsbD0iJTIzOUNBM0FGIi8lM0UlM0NjaXJjbGUgY3g9Ijc1IiBjeT0iNDUiIHI9IjEwIiBmaWxsPSIlMjM5Q0EzQUYiLyUzRSUzQy9zdmclM0UnOwogICAgICAgICAgICAgICAgICAgICAgICBpbWcuYWx0ID0gJ0ltYWdlIG5vdCBhdmFpbGFibGUnOwogICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCk7CiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9LAogICAgICAgICAgICAKICAgICAgICAgICAgZm9ybWF0RmlsZVNpemU6IGZ1bmN0aW9uKGJ5dGVzKSB7CiAgICAgICAgICAgICAgICBpZiAoYnl0ZXMgPT09IDApIHJldHVybiAnMCBCeXRlcyc7CiAgICAgICAgICAgICAgICBjb25zdCBrID0gMTAyNDsKICAgICAgICAgICAgICAgIGNvbnN0IHNpemVzID0gWydCeXRlcycsICdLQicsICdNQicsICdHQiddOwogICAgICAgICAgICAgICAgY29uc3QgaSA9IE1hdGguZmxvb3IoTWF0aC5sb2coYnl0ZXMpIC8gTWF0aC5sb2coaykpOwogICAgICAgICAgICAgICAgcmV0dXJuIHBhcnNlRmxvYXQoKGJ5dGVzIC8gTWF0aC5wb3coaywgaSkpLnRvRml4ZWQoMikpICsgJyAnICsgc2l6ZXNbaV07CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIAogICAgICAgIC8vID09PT09IEF1dGhlbnRpY2F0aW9uIE1hbmFnZXIgPT09PT0KICAgICAgICBjb25zdCBhdXRoTWFuYWdlciA9IHsKICAgICAgICAgICAgYXN5bmMgYXV0aGVudGljYXRlKCkgewogICAgICAgICAgICAgICAgY29uc3QgY2xpZW50U2VjcmV0ID0gZWxlbWVudHMuY2xpZW50U2VjcmV0LnZhbHVlLnRyaW0oKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKCFjbGllbnRTZWNyZXQpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXR1cygnUGxlYXNlIGVudGVyIGNsaWVudCBzZWNyZXQnLCAnZXJyb3InKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgZWxlbWVudHMuYXV0aEJ1dHRvbi5kaXNhYmxlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgZWxlbWVudHMuYXV0aEJ1dHRvbi50ZXh0Q29udGVudCA9ICdDb25uZWN0aW5nLi4uJzsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXR1cygnQ29ubmVjdGluZyB0byBHb29nbGUgRHJpdmUuLi4nLCAnaW5mbycpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGNvbnN0IHN1Y2Nlc3MgPSBhd2FpdCBhcHBTdGF0ZS5jbG91ZFN0b3JhZ2UuYXV0aGVudGljYXRlKGNsaWVudFNlY3JldCk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgKHN1Y2Nlc3MpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0dXMoJ+KchSBDb25uZWN0ZWQgdG8gR29vZ2xlIERyaXZlIScsICdzdWNjZXNzJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnRzLmNsaWVudFNlY3JldC52YWx1ZSA9ICcnOwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dGlscy5zaG93U2NyZWVuKCdmb2xkZXItc2NyZWVuJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb2xkZXJNYW5hZ2VyLmxvYWRGb2xkZXJzKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0sIDEwMDApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignQXV0aGVudGljYXRpb24gZXJyb3I6JywgZXJyb3IpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdHVzKGBBdXRoZW50aWNhdGlvbiBmYWlsZWQ6ICR7ZXJyb3IubWVzc2FnZX1gLCAnZXJyb3InKTsKICAgICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICAgICAgZWxlbWVudHMuYXV0aEJ1dHRvbi5kaXNhYmxlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIGVsZW1lbnRzLmF1dGhCdXR0b24udGV4dENvbnRlbnQgPSAnQ29ubmVjdCBEcml2ZSc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIAogICAgICAgICAgICBzZXRTdGF0dXMobWVzc2FnZSwgdHlwZSkgewogICAgICAgICAgICAgICAgZWxlbWVudHMuYXV0aFN0YXR1cy50ZXh0Q29udGVudCA9IG1lc3NhZ2U7CiAgICAgICAgICAgICAgICBlbGVtZW50cy5hdXRoU3RhdHVzLmNsYXNzTmFtZSA9IGBzdGF0dXMgJHt0eXBlfWA7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIAogICAgICAgICAgICBsb2dvdXQoKSB7CiAgICAgICAgICAgICAgICBhcHBTdGF0ZS5jbG91ZFN0b3JhZ2UuZGlzY29ubmVjdCgpOwogICAgICAgICAgICAgICAgdXRpbHMuc2hvd1NjcmVlbignYXV0aC1zY3JlZW4nKTsKICAgICAgICAgICAgICAgIGVsZW1lbnRzLmNsaWVudFNlY3JldC52YWx1ZSA9ICcnOwogICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0dXMoJ0VudGVyIHlvdXIgY2xpZW50IHNlY3JldCB0byBjb250aW51ZScsICdpbmZvJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIAogICAgICAgIC8vID09PT09IFNJTVBMSUZJRUQgVGFnIFN5c3RlbSA9PT09PQogICAgICAgIGNvbnN0IHRhZ1N5c3RlbSA9IHsKICAgICAgICAgICAgYXN5bmMgYWRkVGFnc1RvRmlsZShmaWxlSWQsIHRhZ3MpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCfwn4+377iPIEFkZGluZyB0YWdzOicsIHRhZ3MsICd0bycsIGZpbGVJZCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNvbnN0IGZpbGUgPSBhcHBTdGF0ZS5pbWFnZUZpbGVzLmZpbmQoZiA9PiBmLmlkID09PSBmaWxlSWQpOwogICAgICAgICAgICAgICAgaWYgKCFmaWxlKSB0aHJvdyBuZXcgRXJyb3IoJ0ZpbGUgbm90IGZvdW5kJyk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRUYWdzID0gdGhpcy5nZXRGaWxlVGFncyhmaWxlKTsKICAgICAgICAgICAgICAgIGNvbnN0IG5ld1RhZ3MgPSBbLi4ubmV3IFNldChbLi4uY3VycmVudFRhZ3MsIC4uLnRhZ3NdKV07CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGZpbGUuYXBwUHJvcGVydGllcyA9IGZpbGUuYXBwUHJvcGVydGllcyB8fCB7fTsKICAgICAgICAgICAgICAgIGZpbGUuYXBwUHJvcGVydGllcy5zbGlkZWJveFRhZ3MgPSBuZXdUYWdzLmpvaW4oJywnKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdGFncy5mb3JFYWNoKHRhZyA9PiBhcHBTdGF0ZS50YWdzLmFkZCh0YWcpKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgYXdhaXQgYXBwU3RhdGUuY2xvdWRTdG9yYWdlLnVwZGF0ZUZpbGVQcm9wZXJ0aWVzKGZpbGVJZCwgZmlsZS5hcHBQcm9wZXJ0aWVzKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ+KchSBUYWdzIHNhdmVkOicsIG5ld1RhZ3MpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB0aGlzLnJlZnJlc2hUYWdEaXNwbGF5cygpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3VGFnczsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgCiAgICAgICAgICAgIGdldEZpbGVUYWdzKGZpbGUpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHRhZ1N0cmluZyA9IGZpbGUuYXBwUHJvcGVydGllcz8uc2xpZGVib3hUYWdzIHx8ICcnOwogICAgICAgICAgICAgICAgcmV0dXJuIHRhZ1N0cmluZyA/IHRhZ1N0cmluZy5zcGxpdCgnLCcpLm1hcCh0ID0+IHQudHJpbSgpKS5maWx0ZXIodCA9PiB0KSA6IFtdOwogICAgICAgICAgICB9LAogICAgICAgICAgICAKICAgICAgICAgICAgcmVmcmVzaFRhZ0Rpc3BsYXlzKCkgewogICAgICAgICAgICAgICAgaWYgKCFlbGVtZW50cy5kZXRhaWxzTW9kYWwuY2xhc3NMaXN0LmNvbnRhaW5zKCdoaWRkZW4nKSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRGaWxlID0gYXBwU3RhdGUuaW1hZ2VGaWxlc1thcHBTdGF0ZS5jdXJyZW50SW1hZ2VJbmRleF07CiAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRGaWxlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRldGFpbHNNb2RhbC5wb3B1bGF0ZVRhZ3NUYWIoY3VycmVudEZpbGUpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgCiAgICAgICAgLy8gPT09PT0gRm9sZGVyIE1hbmFnZXIgPT09PT0KICAgICAgICBjb25zdCBmb2xkZXJNYW5hZ2VyID0gewogICAgICAgICAgICBhc3luYyBsb2FkRm9sZGVycygpIHsKICAgICAgICAgICAgICAgIGVsZW1lbnRzLmZvbGRlckxpc3QuaW5uZXJIVE1MID0gYAogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvbGRlci1sb2FkaW5nIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic3Bpbm5lciI+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuPkxvYWRpbmcgZm9sZGVycy4uLjwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIGA7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZm9sZGVycyA9IGF3YWl0IGFwcFN0YXRlLmNsb3VkU3RvcmFnZS5nZXRGb2xkZXJzKCk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgKGZvbGRlcnMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnRzLmZvbGRlckxpc3QuaW5uZXJIVE1MID0gYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9sZGVyLWxvYWRpbmciPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuPk5vIGZvbGRlcnMgZm91bmQgaW4geW91ciBEcml2ZTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICBgOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGVsZW1lbnRzLmZvbGRlckxpc3QuaW5uZXJIVE1MID0gJyc7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgZm9sZGVycy5mb3JFYWNoKGZvbGRlciA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgICAgICAgICAgICAgICAgICBkaXYuY2xhc3NOYW1lID0gJ2ZvbGRlci1pdGVtJzsKICAgICAgICAgICAgICAgICAgICAgICAgZGl2LmlubmVySFRNTCA9IGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzdmcgY2xhc3M9ImZvbGRlci1pY29uIiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cGF0aCBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTMgN3YxMGEyIDIgMCAwMDIgMmgxNGEyIDIgMCAwMDItMlY5YTIgMiAwIDAwLTItMmgtNmwtMi0ySDVhMiAyIDAgMDAtMiAyeiI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zdmc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb2xkZXItaW5mbyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9sZGVyLW5hbWUiPiR7Zm9sZGVyLm5hbWV9PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9sZGVyLWRhdGUiPiR7bmV3IERhdGUoZm9sZGVyLm1vZGlmaWVkVGltZSkudG9Mb2NhbGVEYXRlU3RyaW5nKCl9PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgYDsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGRpdi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHRoaXMuc2VsZWN0Rm9sZGVyKGZvbGRlcikpOwogICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50cy5mb2xkZXJMaXN0LmFwcGVuZENoaWxkKGRpdik7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGxvYWRpbmcgZm9sZGVyczonLCBlcnJvcik7CiAgICAgICAgICAgICAgICAgICAgZWxlbWVudHMuZm9sZGVyTGlzdC5pbm5lckhUTUwgPSBgCiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvbGRlci1sb2FkaW5nIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuPkVycm9yIGxvYWRpbmcgZm9sZGVycy4gUGxlYXNlIHRyeSBhZ2Fpbi48L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIGA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIAogICAgICAgICAgICBhc3luYyBzZWxlY3RGb2xkZXIoZm9sZGVyKSB7CiAgICAgICAgICAgICAgICBhcHBTdGF0ZS5jdXJyZW50Rm9sZGVyLmlkID0gZm9sZGVyLmlkOwogICAgICAgICAgICAgICAgYXBwU3RhdGUuY3VycmVudEZvbGRlci5uYW1lID0gZm9sZGVyLm5hbWU7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHV0aWxzLnNob3dTY3JlZW4oJ2xvYWRpbmctc2NyZWVuJyk7CiAgICAgICAgICAgICAgICB1dGlscy51cGRhdGVMb2FkaW5nUHJvZ3Jlc3MoMCwgMCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGFwcFN0YXRlLmNsb3VkU3RvcmFnZS5jdXJyZW50UHJvdmlkZXIub25Qcm9ncmVzc0NhbGxiYWNrID0gKGNvdW50KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgdXRpbHMudXBkYXRlTG9hZGluZ1Byb2dyZXNzKGNvdW50LCAwKTsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgZWxlbWVudHMubG9hZGluZ01lc3NhZ2UudGV4dENvbnRlbnQgPSAnTG9hZGluZyBpbWFnZXMgZnJvbSBHb29nbGUgRHJpdmUuLi4nOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGFwcFN0YXRlLmNsb3VkU3RvcmFnZS5nZXRGaWxlcyhmb2xkZXIuaWQpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGZpbGVzID0gcmVzdWx0LmZpbGVzIHx8IFtdOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIChmaWxlcy5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgdXRpbHMuc2hvd1RvYXN0KCdObyBpbWFnZXMgZm91bmQgaW4gdGhpcyBmb2xkZXInKTsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB1dGlscy5zaG93U2NyZWVuKCdmb2xkZXItc2NyZWVuJyksIDIwMDApOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHV0aWxzLnVwZGF0ZUxvYWRpbmdQcm9ncmVzcyhmaWxlcy5sZW5ndGgsIGZpbGVzLmxlbmd0aCk7CiAgICAgICAgICAgICAgICAgICAgZWxlbWVudHMubG9hZGluZ01lc3NhZ2UudGV4dENvbnRlbnQgPSAnUHJvY2Vzc2luZyBtZXRhZGF0YS4uLic7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgYXBwU3RhdGUuaW1hZ2VGaWxlcyA9IFtdOwogICAgICAgICAgICAgICAgICAgIGxldCBwcm9jZXNzZWRDb3VudCA9IDA7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBmaWxlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmaWxlID0gZmlsZXNbaV07CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpbWFnZUZpbGUgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogZmlsZS5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGZpbGUubmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVuYW1lOiBmaWxlLm5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcmlnaW5hbE5hbWU6IGZpbGUubmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pbWVUeXBlOiBmaWxlLm1pbWVUeXBlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZTogZmlsZS5zaXplLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlZFRpbWU6IGZpbGUuY3JlYXRlZFRpbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RpZmllZFRpbWU6IGZpbGUubW9kaWZpZWRUaW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGh1bWJuYWlsTGluazogZmlsZS50aHVtYm5haWxMaW5rLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG93bmxvYWRVcmw6IGZpbGUuZG93bmxvYWRVcmwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBQcm9wZXJ0aWVzOiBmaWxlLmFwcFByb3BlcnRpZXMgfHwge30sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHRyYWN0ZWRNZXRhZGF0YToge30sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBxdWFsaXR5UmF0aW5nOiBwYXJzZUludChmaWxlLmFwcFByb3BlcnRpZXM/LnF1YWxpdHlSYXRpbmcpIHx8IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50UmF0aW5nOiBwYXJzZUludChmaWxlLmFwcFByb3BlcnRpZXM/LmNvbnRlbnRSYXRpbmcpIHx8IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBub3RlczogZmlsZS5hcHBQcm9wZXJ0aWVzPy5ub3RlcyB8fCAnJwogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgYXBwU3RhdGUuaW1hZ2VGaWxlcy5wdXNoKGltYWdlRmlsZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICB1dGlscy51cGRhdGVMb2FkaW5nUHJvZ3Jlc3MocHJvY2Vzc2VkQ291bnQgKyAxLCBmaWxlcy5sZW5ndGgpOwogICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50cy5sb2FkaW5nTWVzc2FnZS50ZXh0Q29udGVudCA9IGBQcm9jZXNzaW5nIG1ldGFkYXRhICR7cHJvY2Vzc2VkQ291bnQgKyAxfSBvZiAke2ZpbGVzLmxlbmd0aH0uLi5gOwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuZXh0cmFjdEFuZFN0b3JlTWV0YWRhdGEoaW1hZ2VGaWxlKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihgRmFpbGVkIHRvIHByb2Nlc3MgbWV0YWRhdGEgZm9yICR7ZmlsZS5uYW1lfTpgLCBlcnJvcik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NlZENvdW50Kys7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaSAlIDUgPT09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCAxMCkpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHN0YWNrTWFuYWdlci51cGRhdGVTdGFja3MoKTsKICAgICAgICAgICAgICAgICAgICBhcHBTdGF0ZS5jdXJyZW50SW1hZ2VJbmRleCA9IDA7CiAgICAgICAgICAgICAgICAgICAgYXBwU3RhdGUuY3VycmVudFN0YWNrID0gJ2luJzsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgdXRpbHMuc2hvd1NjcmVlbignYXBwLWNvbnRhaW5lcicpOwogICAgICAgICAgICAgICAgICAgICAgICBpbWFnZVZpZXdlci5kaXNwbGF5VG9wSW1hZ2VGcm9tU3RhY2soJ2luJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZUFjdGl2ZVByb3hUYWIoKTsKICAgICAgICAgICAgICAgICAgICAgICAgdXRpbHMuc2hvd1RvYXN0KGBMb2FkZWQgJHtmaWxlcy5sZW5ndGh9IGltYWdlc2ApOwogICAgICAgICAgICAgICAgICAgIH0sIDUwMCk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGxvYWRpbmcgZm9sZGVyOicsIGVycm9yKTsKICAgICAgICAgICAgICAgICAgICB1dGlscy5zaG93VG9hc3QoJ0Vycm9yIGxvYWRpbmcgaW1hZ2VzIGZyb20gZm9sZGVyJywgJ2Vycm9yJyk7CiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB1dGlscy5zaG93U2NyZWVuKCdmb2xkZXItc2NyZWVuJyksIDIwMDApOwogICAgICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgICBpZiAoYXBwU3RhdGUuY2xvdWRTdG9yYWdlLmN1cnJlbnRQcm92aWRlcikgewogICAgICAgICAgICAgICAgICAgICAgICBhcHBTdGF0ZS5jbG91ZFN0b3JhZ2UuY3VycmVudFByb3ZpZGVyLm9uUHJvZ3Jlc3NDYWxsYmFjayA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICAKICAgICAgICAgICAgLy8gPT09PT0gU0lNUExJRklFRCBNRVRBREFUQSBFWFRSQUNUSU9OID09PT09CiAgICAgICAgICAgIGFzeW5jIGV4dHJhY3RBbmRTdG9yZU1ldGFkYXRhKGZpbGUpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCc9PT0gRVhUUkFDVElORyBNRVRBREFUQSA9PT0nLCBmaWxlLm5hbWUpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAoIWZpbGUuZG93bmxvYWRVcmwpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygn4p2MIE5vIGRvd25sb2FkIFVSTCcpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB7fTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goZmlsZS5kb3dubG9hZFVybCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYXJyYXlCdWZmZXIgPSBhd2FpdCByZXNwb25zZS5hcnJheUJ1ZmZlcigpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCfwn5OlIERvd25sb2FkZWQ6JywgYXJyYXlCdWZmZXIuYnl0ZUxlbmd0aCwgJ2J5dGVzJyk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZXh0cmFjdGVkTWV0YWRhdGEgPSBhd2FpdCBhcHBTdGF0ZS5tZXRhZGF0YUV4dHJhY3Rvci5leHRyYWN0SW1hZ2VNZXRhZGF0YShhcnJheUJ1ZmZlciwgZmlsZS5taW1lVHlwZSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ/CflI0gUmF3IGV4dHJhY3RlZDonLCBleHRyYWN0ZWRNZXRhZGF0YSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5rZXlzKGV4dHJhY3RlZE1ldGFkYXRhKS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUuZXh0cmFjdGVkTWV0YWRhdGEgPSBleHRyYWN0ZWRNZXRhZGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHVwZGF0ZWRQcm9wZXJ0aWVzID0geyAuLi5maWxlLmFwcFByb3BlcnRpZXMsIC4uLmV4dHJhY3RlZE1ldGFkYXRhIH07CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygn8J+SviBTYXZpbmcga2V5czonLCBPYmplY3Qua2V5cyh1cGRhdGVkUHJvcGVydGllcykpOwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgYXBwU3RhdGUuY2xvdWRTdG9yYWdlLnVwZGF0ZUZpbGVQcm9wZXJ0aWVzKGZpbGUuaWQsIHVwZGF0ZWRQcm9wZXJ0aWVzKTsKICAgICAgICAgICAgICAgICAgICAgICAgZmlsZS5hcHBQcm9wZXJ0aWVzID0gdXBkYXRlZFByb3BlcnRpZXM7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygn4pyFIE1ldGFkYXRhIHNhdmVkIGZvcjonLCBmaWxlLm5hbWUpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCfimqDvuI8gTm8gbWV0YWRhdGEgZXh0cmFjdGVkIGZyb206JywgZmlsZS5uYW1lKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGV4dHJhY3RlZE1ldGFkYXRhOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCfinYwgRXh0cmFjdGlvbiBmYWlsZWQ6JywgZXJyb3IpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB7fTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgCiAgICAgICAgLy8gPT09PT0gU3RhY2sgTWFuYWdlciA9PT09PQogICAgICAgIGNvbnN0IHN0YWNrTWFuYWdlciA9IHsKICAgICAgICAgICAgY3VycmVudFNvcnQ6ICdkYXRlLWRlc2MnLAogICAgICAgICAgICAKICAgICAgICAgICAgZ2V0RmlsZU1ldGFkYXRhOiBmdW5jdGlvbihmaWxlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgIHNsaWRlYm94U3RhY2s6IGZpbGUuYXBwUHJvcGVydGllcz8uc2xpZGVib3hTdGFjayB8fCAnaW4nLAogICAgICAgICAgICAgICAgICAgIHNsaWRlYm94VGFnczogdGFnU3lzdGVtLmdldEZpbGVUYWdzKGZpbGUpCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9LAogICAgICAgICAgICAKICAgICAgICAgICAgc29ydEZpbGVzOiBmdW5jdGlvbihmaWxlcywgc29ydE9yZGVyKSB7CiAgICAgICAgICAgICAgICBjb25zdCBzb3J0ZWQgPSBbLi4uZmlsZXNdOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzd2l0Y2ggKHNvcnRPcmRlcikgewogICAgICAgICAgICAgICAgICAgIGNhc2UgJ2RhdGUtZGVzYyc6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzb3J0ZWQuc29ydCgoYSwgYikgPT4gbmV3IERhdGUoYi5tb2RpZmllZFRpbWUgfHwgYi5jcmVhdGVkVGltZSkgLSBuZXcgRGF0ZShhLm1vZGlmaWVkVGltZSB8fCBhLmNyZWF0ZWRUaW1lKSk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnZGF0ZS1hc2MnOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc29ydGVkLnNvcnQoKGEsIGIpID0+IG5ldyBEYXRlKGEubW9kaWZpZWRUaW1lIHx8IGEuY3JlYXRlZFRpbWUpIC0gbmV3IERhdGUoYi5tb2RpZmllZFRpbWUgfHwgYi5jcmVhdGVkVGltZSkpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgJ25hbWUtYXNjJzoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNvcnRlZC5zb3J0KChhLCBiKSA9PiAoYS5uYW1lIHx8ICcnKS5sb2NhbGVDb21wYXJlKGIubmFtZSB8fCAnJykpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgJ25hbWUtZGVzYyc6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzb3J0ZWQuc29ydCgoYSwgYikgPT4gKGIubmFtZSB8fCAnJykubG9jYWxlQ29tcGFyZShhLm5hbWUgfHwgJycpKTsKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc29ydGVkOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICAKICAgICAgICAgICAgdXBkYXRlU3RhY2tzOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIFNUQUNLX1RZUEVTLmZvckVhY2goc3RhY2sgPT4geyBhcHBTdGF0ZS5zdGFja3Nbc3RhY2tdID0gW107IH0pOwogICAgICAgICAgICAgICAgYXBwU3RhdGUuaW1hZ2VGaWxlcy5mb3JFYWNoKGZpbGUgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IG1ldGFkYXRhID0gdGhpcy5nZXRGaWxlTWV0YWRhdGEoZmlsZSk7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RhY2sgPSBtZXRhZGF0YS5zbGlkZWJveFN0YWNrOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIChTVEFDS19UWVBFUy5pbmNsdWRlcyhzdGFjaykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYXBwU3RhdGUuc3RhY2tzW3N0YWNrXS5wdXNoKGZpbGUpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFwcFN0YXRlLnN0YWNrcy5pbi5wdXNoKGZpbGUpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBTVEFDS19UWVBFUy5mb3JFYWNoKHN0YWNrID0+IHsKICAgICAgICAgICAgICAgICAgICBhcHBTdGF0ZS5zdGFja3Nbc3RhY2tdID0gdGhpcy5zb3J0RmlsZXMoYXBwU3RhdGUuc3RhY2tzW3N0YWNrXSwgdGhpcy5jdXJyZW50U29ydCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdGhpcy51cGRhdGVDb3VudHMoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgCiAgICAgICAgICAgIHVwZGF0ZUNvdW50czogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBTVEFDS19UWVBFUy5mb3JFYWNoKHN0YWNrID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBjb3VudCA9IGFwcFN0YXRlLnN0YWNrc1tzdGFja10ubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvdW50RWxlbWVudHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGBbZGF0YS1zdGFjaz0iJHtzdGFja30iXWApOwogICAgICAgICAgICAgICAgICAgIGNvdW50RWxlbWVudHMuZm9yRWFjaChlbCA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlbC5jbGFzc0xpc3QuY29udGFpbnMoJ3BpbGwtY291bnRlcicpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbC50ZXh0Q29udGVudCA9IGNvdW50ID4gOTk5ID8gJzk5OSsnIDogY291bnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY291bnQgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWwuY2xhc3NMaXN0LmFkZCgndmlzaWJsZScpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbC5jbGFzc0xpc3QucmVtb3ZlKCd2aXNpYmxlJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAoYXBwU3RhdGUuZ3JpZC5zdGFjayAmJiBlbGVtZW50cy5zZWxlY3RBbGxCdG4pIHsKICAgICAgICAgICAgICAgICAgICBlbGVtZW50cy5zZWxlY3RBbGxCdG4udGV4dENvbnRlbnQgPSBhcHBTdGF0ZS5zdGFja3NbYXBwU3RhdGUuZ3JpZC5zdGFja10ubGVuZ3RoOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICAKICAgICAgICAgICAgbW92ZUZpbGVUb1N0YWNrOiBhc3luYyBmdW5jdGlvbihmaWxlSWQsIHRhcmdldFN0YWNrKSB7CiAgICAgICAgICAgICAgICBjb25zdCBmaWxlID0gYXBwU3RhdGUuaW1hZ2VGaWxlcy5maW5kKGYgPT4gZi5pZCA9PT0gZmlsZUlkKTsKICAgICAgICAgICAgICAgIGlmICghZmlsZSkgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcignRmlsZSBub3QgZm91bmQnKSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNvbnN0IG1ldGFkYXRhID0gdGhpcy5nZXRGaWxlTWV0YWRhdGEoZmlsZSk7CiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50U3RhY2sgPSBtZXRhZGF0YS5zbGlkZWJveFN0YWNrOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAoY3VycmVudFN0YWNrID09PSB0YXJnZXRTdGFjaykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoZmlsZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgYXBwU3RhdGUuY2xvdWRTdG9yYWdlLm1vdmVGaWxlVG9TdGFjayhmaWxlSWQsIHRhcmdldFN0YWNrKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50U3RhY2tJbmRleCA9IGFwcFN0YXRlLnN0YWNrc1tjdXJyZW50U3RhY2tdLmZpbmRJbmRleChmID0+IGYuaWQgPT09IGZpbGVJZCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRTdGFja0luZGV4ICE9PSAtMSkgewogICAgICAgICAgICAgICAgICAgICAgICBhcHBTdGF0ZS5zdGFja3NbY3VycmVudFN0YWNrXS5zcGxpY2UoY3VycmVudFN0YWNrSW5kZXgsIDEpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBhcHBTdGF0ZS5zdGFja3NbdGFyZ2V0U3RhY2tdLnVuc2hpZnQoZmlsZSk7CiAgICAgICAgICAgICAgICAgICAgZmlsZS5hcHBQcm9wZXJ0aWVzID0gZmlsZS5hcHBQcm9wZXJ0aWVzIHx8IHt9OwogICAgICAgICAgICAgICAgICAgIGZpbGUuYXBwUHJvcGVydGllcy5zbGlkZWJveFN0YWNrID0gdGFyZ2V0U3RhY2s7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVDb3VudHMoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGZpbGUpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBtb3ZpbmcgZmlsZTonLCBlcnJvcik7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgCiAgICAgICAgICAgIGFkZFRhZ3NUb0ZpbGU6IHRhZ1N5c3RlbS5hZGRUYWdzVG9GaWxlLmJpbmQodGFnU3lzdGVtKQogICAgICAgIH07CiAgICAgICAgCiAgICAgICAgLy8gPT09PT0gSW1hZ2UgVmlld2VyID09PT09CiAgICAgICAgY29uc3QgaW1hZ2VWaWV3ZXIgPSB7CiAgICAgICAgICAgIGRpc3BsYXlDdXJyZW50SW1hZ2U6IGFzeW5jIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgaWYgKGFwcFN0YXRlLmltYWdlRmlsZXMubGVuZ3RoID09PSAwIHx8IGFwcFN0YXRlLmN1cnJlbnRJbWFnZUluZGV4IDwgMCB8fCBhcHBTdGF0ZS5jdXJyZW50SW1hZ2VJbmRleCA+PSBhcHBTdGF0ZS5pbWFnZUZpbGVzLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgIGVsZW1lbnRzLmNlbnRlckltYWdlLnNyYyA9ICcnOwogICAgICAgICAgICAgICAgICAgIGVsZW1lbnRzLmNlbnRlckltYWdlLmFsdCA9ICdObyBpbWFnZSBzZWxlY3RlZCc7CiAgICAgICAgICAgICAgICAgICAgZWxlbWVudHMuZW1wdHlTdGF0ZS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGVsZW1lbnRzLmVtcHR5U3RhdGUuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50RmlsZSA9IGFwcFN0YXRlLmltYWdlRmlsZXNbYXBwU3RhdGUuY3VycmVudEltYWdlSW5kZXhdOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAoIWN1cnJlbnRGaWxlKSB7CiAgICAgICAgICAgICAgICAgICAgZWxlbWVudHMuY2VudGVySW1hZ2Uuc3JjID0gJyc7CiAgICAgICAgICAgICAgICAgICAgZWxlbWVudHMuY2VudGVySW1hZ2UuYWx0ID0gJ0ltYWdlIG5vdCBhdmFpbGFibGUnOwogICAgICAgICAgICAgICAgICAgIHV0aWxzLnNob3dUb2FzdCgnRXJyb3I6IEltYWdlIG5vdCBhdmFpbGFibGUnLCAnZXJyb3InKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGF3YWl0IHV0aWxzLnNldEltYWdlU3JjKGVsZW1lbnRzLmNlbnRlckltYWdlLCBjdXJyZW50RmlsZSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGFwcFN0YXRlLmN1cnJlbnRTY2FsZSA9IDE7CiAgICAgICAgICAgICAgICBhcHBTdGF0ZS5wYW5PZmZzZXQgPSB7IHg6IDAsIHk6IDAgfTsKICAgICAgICAgICAgICAgIHRoaXMuYXBwbHlUcmFuc2Zvcm0oKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc3RhY2tNYW5hZ2VyLnVwZGF0ZUNvdW50cygpOwogICAgICAgICAgICB9LAogICAgICAgICAgICAKICAgICAgICAgICAgZGlzcGxheVRvcEltYWdlRnJvbVN0YWNrOiBhc3luYyBmdW5jdGlvbihzdGFja05hbWUpIHsKICAgICAgICAgICAgICAgIGlmIChhcHBTdGF0ZS5zdGFja3Nbc3RhY2tOYW1lXS5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgICAgICBlbGVtZW50cy5jZW50ZXJJbWFnZS5zdHlsZS5vcGFjaXR5ID0gJzAnOwogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50cy5jZW50ZXJJbWFnZS5zcmMgPSAnJzsKICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudHMuY2VudGVySW1hZ2UuYWx0ID0gJ05vIGltYWdlcyBpbiB0aGlzIHN0YWNrJzsKICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlRW1wdHlTdGF0ZUJ1dHRvbnMoKTsKICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudHMuZW1wdHlTdGF0ZS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudHMuY2VudGVySW1hZ2Uuc3R5bGUub3BhY2l0eSA9ICcxJzsKICAgICAgICAgICAgICAgICAgICB9LCAyMDApOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZWxlbWVudHMuZW1wdHlTdGF0ZS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgIGNvbnN0IHRvcEltYWdlID0gYXBwU3RhdGUuc3RhY2tzW3N0YWNrTmFtZV1bMF07CiAgICAgICAgICAgICAgICBjb25zdCBpbWFnZUluZGV4ID0gYXBwU3RhdGUuaW1hZ2VGaWxlcy5maW5kSW5kZXgoZiA9PiBmLmlkID09PSB0b3BJbWFnZS5pZCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIChpbWFnZUluZGV4ICE9PSAtMSkgewogICAgICAgICAgICAgICAgICAgIGFwcFN0YXRlLmN1cnJlbnRJbWFnZUluZGV4ID0gaW1hZ2VJbmRleDsKICAgICAgICAgICAgICAgICAgICBhcHBTdGF0ZS5jdXJyZW50U3RhY2sgPSBzdGFja05hbWU7CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5kaXNwbGF5Q3VycmVudEltYWdlKCk7CiAgICAgICAgICAgICAgICAgICAgdXBkYXRlQWN0aXZlUHJveFRhYigpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICAKICAgICAgICAgICAgYXBwbHlUcmFuc2Zvcm06IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgY29uc3QgdHJhbnNmb3JtID0gYHNjYWxlKCR7YXBwU3RhdGUuY3VycmVudFNjYWxlfSkgdHJhbnNsYXRlKCR7YXBwU3RhdGUucGFuT2Zmc2V0Lnh9cHgsICR7YXBwU3RhdGUucGFuT2Zmc2V0Lnl9cHgpYDsKICAgICAgICAgICAgICAgIGVsZW1lbnRzLmNlbnRlckltYWdlLnN0eWxlLnRyYW5zZm9ybSA9IHRyYW5zZm9ybTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgCiAgICAgICAgICAgIG1vdmVUb05leHRJbWFnZTogYXN5bmMgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBpZiAoYXBwU3RhdGUuaW1hZ2VGaWxlcy5sZW5ndGggPT09IDApIHJldHVybjsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc3QgYWN0aXZlU3RhY2tJbWFnZXMgPSBhcHBTdGF0ZS5zdGFja3NbYXBwU3RhdGUuY3VycmVudFN0YWNrXTsKICAgICAgICAgICAgICAgIGlmIChhY3RpdmVTdGFja0ltYWdlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudEltYWdlSW5TdGFjayA9IGFjdGl2ZVN0YWNrSW1hZ2VzLmZpbmQoaW1nID0+IGltZy5pZCA9PT0gYXBwU3RhdGUuaW1hZ2VGaWxlc1thcHBTdGF0ZS5jdXJyZW50SW1hZ2VJbmRleF0uaWQpOwogICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50SW1hZ2VJblN0YWNrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRJbmRleEluU3RhY2sgPSBhY3RpdmVTdGFja0ltYWdlcy5pbmRleE9mKGN1cnJlbnRJbWFnZUluU3RhY2spOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXh0SW5kZXhJblN0YWNrID0gKGN1cnJlbnRJbmRleEluU3RhY2sgKyAxKSAlIGFjdGl2ZVN0YWNrSW1hZ2VzLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV4dEltYWdlSW5TdGFjayA9IGFjdGl2ZVN0YWNrSW1hZ2VzW25leHRJbmRleEluU3RhY2tdOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXh0R2xvYmFsSW5kZXggPSBhcHBTdGF0ZS5pbWFnZUZpbGVzLmZpbmRJbmRleChpbWcgPT4gaW1nLmlkID09PSBuZXh0SW1hZ2VJblN0YWNrLmlkKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5leHRHbG9iYWxJbmRleCAhPT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcFN0YXRlLmN1cnJlbnRJbWFnZUluZGV4ID0gbmV4dEdsb2JhbEluZGV4OwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFjdGl2ZVN0YWNrSW1hZ2VzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGZpcnN0SW1hZ2VJblN0YWNrID0gYWN0aXZlU3RhY2tJbWFnZXNbMF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmaXJzdEdsb2JhbEluZGV4ID0gYXBwU3RhdGUuaW1hZ2VGaWxlcy5maW5kSW5kZXgoaW1nID0+IGltZy5pZCA9PT0gZmlyc3RJbWFnZUluU3RhY2suaWQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpcnN0R2xvYmFsSW5kZXggIT09IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwU3RhdGUuY3VycmVudEltYWdlSW5kZXggPSBmaXJzdEdsb2JhbEluZGV4OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuZGlzcGxheUN1cnJlbnRJbWFnZSgpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBlbGVtZW50cy5jZW50ZXJJbWFnZS5zdHlsZS5vcGFjaXR5ID0gJzAnOwogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50cy5jZW50ZXJJbWFnZS5zcmMgPSAnJzsKICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudHMuY2VudGVySW1hZ2UuYWx0ID0gJ05vIGltYWdlcyBpbiB0aGlzIHN0YWNrJzsKICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlRW1wdHlTdGF0ZUJ1dHRvbnMoKTsKICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudHMuZW1wdHlTdGF0ZS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudHMuY2VudGVySW1hZ2Uuc3R5bGUub3BhY2l0eSA9ICcxJzsKICAgICAgICAgICAgICAgICAgICB9LCAyMDApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICAKICAgICAgICAvLyA9PT09PSBQcm94VGFiIE1hbmFnZW1lbnQgPT09PT0KICAgICAgICBmdW5jdGlvbiB1cGRhdGVBY3RpdmVQcm94VGFiKCkgewogICAgICAgICAgICBPYmplY3QudmFsdWVzKGVsZW1lbnRzLnBpbGxDb3VudGVycykuZm9yRWFjaChwaWxsID0+IHsKICAgICAgICAgICAgICAgIHBpbGwuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKGVsZW1lbnRzLnBpbGxDb3VudGVyc1thcHBTdGF0ZS5jdXJyZW50U3RhY2tdKSB7CiAgICAgICAgICAgICAgICBlbGVtZW50cy5waWxsQ291bnRlcnNbYXBwU3RhdGUuY3VycmVudFN0YWNrXS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICBmdW5jdGlvbiBzZXR1cFByb3hUYWJDbGlja3MoKSB7CiAgICAgICAgICAgIE9iamVjdC5lbnRyaWVzKGVsZW1lbnRzLnBpbGxDb3VudGVycykuZm9yRWFjaCgoW3N0YWNrTmFtZSwgcGlsbF0pID0+IHsKICAgICAgICAgICAgICAgIHBpbGwuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgKGFwcFN0YXRlLmN1cnJlbnRTdGFjayA9PT0gc3RhY2tOYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGdyaWRWaWV3Lm9wZW4oc3RhY2tOYW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgYWNrbm93bGVkZ2VQaWxsQ291bnRlcihzdGFja05hbWUpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGFwcFN0YXRlLmN1cnJlbnRTdGFjayA9IHN0YWNrTmFtZTsKICAgICAgICAgICAgICAgICAgICB1cGRhdGVBY3RpdmVQcm94VGFiKCk7CiAgICAgICAgICAgICAgICAgICAgaW1hZ2VWaWV3ZXIuZGlzcGxheVRvcEltYWdlRnJvbVN0YWNrKHN0YWNrTmFtZSk7CiAgICAgICAgICAgICAgICAgICAgYWNrbm93bGVkZ2VQaWxsQ291bnRlcihzdGFja05hbWUpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBmdW5jdGlvbiBhY2tub3dsZWRnZVBpbGxDb3VudGVyKHN0YWNrTmFtZSkgewogICAgICAgICAgICBjb25zdCBwaWxsID0gZWxlbWVudHMucGlsbENvdW50ZXJzW3N0YWNrTmFtZV07CiAgICAgICAgICAgIGlmIChwaWxsKSB7CiAgICAgICAgICAgICAgICBwaWxsLmNsYXNzTGlzdC5yZW1vdmUoJ3RyaXBsZS1yaXBwbGUnLCAnZ2xvdy1lZmZlY3QnKTsKICAgICAgICAgICAgICAgIHBpbGwub2Zmc2V0SGVpZ2h0OwogICAgICAgICAgICAgICAgcGlsbC5jbGFzc0xpc3QuYWRkKCd0cmlwbGUtcmlwcGxlJyk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHBpbGwuY2xhc3NMaXN0LmFkZCgnZ2xvdy1lZmZlY3QnKTsKICAgICAgICAgICAgICAgIH0sIDEwMCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHBpbGwuY2xhc3NMaXN0LnJlbW92ZSgndHJpcGxlLXJpcHBsZScsICdnbG93LWVmZmVjdCcpOwogICAgICAgICAgICAgICAgfSwgMzAwMCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gPT09PT0gR3JpZCBWaWV3ID09PT09CiAgICAgICAgY29uc3QgZ3JpZFZpZXcgPSB7CiAgICAgICAgICAgIG9wZW46IGZ1bmN0aW9uKHN0YWNrKSB7CiAgICAgICAgICAgICAgICBlbGVtZW50cy5ncmlkTW9kYWwuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICBjb25zdCBzdGFja05hbWVzID0geyAnaW4nOiAnSW4nLCAnb3V0JzogJ091dCcsICdwcmlvcml0eSc6ICdQcmlvcml0eScsICd0cmFzaCc6ICdUcmFzaCcgfTsKICAgICAgICAgICAgICAgIGVsZW1lbnRzLmdyaWRUaXRsZS50ZXh0Q29udGVudCA9IHN0YWNrTmFtZXNbc3RhY2tdIHx8IHN0YWNrOwogICAgICAgICAgICAgICAgZWxlbWVudHMuc2VsZWN0QWxsQnRuLnRleHRDb250ZW50ID0gYXBwU3RhdGUuc3RhY2tzW3N0YWNrXS5sZW5ndGg7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGFwcFN0YXRlLmdyaWQuc3RhY2sgPSBzdGFjazsKICAgICAgICAgICAgICAgIGFwcFN0YXRlLmdyaWQuc2VsZWN0ZWQgPSBbXTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdGhpcy51cGRhdGVTZWxlY3Rpb25VSSgpOwogICAgICAgICAgICAgICAgdGhpcy5wb3B1bGF0ZShzdGFjayk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIAogICAgICAgICAgICBjbG9zZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBjb25zdCBzZWxlY3RlZEltYWdlcyA9IGFwcFN0YXRlLmdyaWQuc2VsZWN0ZWQ7CiAgICAgICAgICAgICAgICBjb25zdCBoYXNTZWxlY3Rpb24gPSBzZWxlY3RlZEltYWdlcy5sZW5ndGggPT09IDE7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGVsZW1lbnRzLmdyaWRNb2RhbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKGhhc1NlbGVjdGlvbikgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkRmlsZUlkID0gc2VsZWN0ZWRJbWFnZXNbMF07CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRJbmRleCA9IGFwcFN0YXRlLmltYWdlRmlsZXMuZmluZEluZGV4KGYgPT4gZi5pZCA9PT0gc2VsZWN0ZWRGaWxlSWQpOwogICAgICAgICAgICAgICAgICAgIGlmIChzZWxlY3RlZEluZGV4ICE9PSAtMSkgewogICAgICAgICAgICAgICAgICAgICAgICBhcHBTdGF0ZS5jdXJyZW50SW1hZ2VJbmRleCA9IHNlbGVjdGVkSW5kZXg7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50U3RhY2tJbWFnZXMgPSBhcHBTdGF0ZS5zdGFja3NbYXBwU3RhdGUuY3VycmVudFN0YWNrXTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRGaWxlID0gYXBwU3RhdGUuaW1hZ2VGaWxlc1tzZWxlY3RlZEluZGV4XTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RhY2tJbmRleCA9IGN1cnJlbnRTdGFja0ltYWdlcy5maW5kSW5kZXgoZiA9PiBmLmlkID09PSBzZWxlY3RlZEZpbGVJZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RhY2tJbmRleCAhPT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlb3JkZXJlZFN0YWNrID0gWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC4uLmN1cnJlbnRTdGFja0ltYWdlcy5zbGljZShzdGFja0luZGV4KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuLi5jdXJyZW50U3RhY2tJbWFnZXMuc2xpY2UoMCwgc3RhY2tJbmRleCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBTdGF0ZS5zdGFja3NbYXBwU3RhdGUuY3VycmVudFN0YWNrXSA9IHJlb3JkZXJlZFN0YWNrOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpbWFnZVZpZXdlci5kaXNwbGF5Q3VycmVudEltYWdlKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpbWFnZVZpZXdlci5kaXNwbGF5VG9wSW1hZ2VGcm9tU3RhY2soYXBwU3RhdGUuY3VycmVudFN0YWNrKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgYXBwU3RhdGUuZ3JpZC5zdGFjayA9IG51bGw7CiAgICAgICAgICAgICAgICBhcHBTdGF0ZS5ncmlkLnNlbGVjdGVkID0gW107CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIAogICAgICAgICAgICBwb3B1bGF0ZTogZnVuY3Rpb24oc3RhY2spIHsKICAgICAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGVsZW1lbnRzLmdyaWRDb250YWluZXI7CiAgICAgICAgICAgICAgICBjb250YWluZXIuaW5uZXJIVE1MID0gJyc7CiAgICAgICAgICAgICAgICBjb250YWluZXIuc3R5bGUuZ3JpZFRlbXBsYXRlQ29sdW1ucyA9IGByZXBlYXQoJHtlbGVtZW50cy5ncmlkU2l6ZS52YWx1ZX0sIDFmcilgOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb25zdCBzb3J0ZWRGaWxlcyA9IHN0YWNrTWFuYWdlci5zb3J0RmlsZXMoYXBwU3RhdGUuc3RhY2tzW3N0YWNrXSwgc3RhY2tNYW5hZ2VyLmN1cnJlbnRTb3J0KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc29ydGVkRmlsZXMuZm9yRWFjaCgoZmlsZSkgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgICAgICAgICAgICAgIGRpdi5jbGFzc05hbWUgPSAnZ3JpZC1pdGVtJzsKICAgICAgICAgICAgICAgICAgICBkaXYuZGF0YXNldC5maWxlSWQgPSBmaWxlLmlkOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGNvbnN0IGltZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpOwogICAgICAgICAgICAgICAgICAgIGltZy5jbGFzc05hbWUgPSAnZ3JpZC1pbWFnZSc7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgKGFwcFN0YXRlLmltYWdlQ2FjaGUuaGFzKGZpbGUuaWQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGltZy5zcmMgPSBhcHBTdGF0ZS5pbWFnZUNhY2hlLmdldChmaWxlLmlkKTsKICAgICAgICAgICAgICAgICAgICAgICAgaW1nLmFsdCA9IGZpbGUubmFtZSB8fCAnSW1hZ2UnOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHV0aWxzLnNldEltYWdlU3JjKGltZywgZmlsZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGRpdi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGUgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFwcFN0YXRlLmdyaWQuc2VsZWN0ZWQubGVuZ3RoID09PSAxICYmIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwU3RhdGUuZ3JpZC5zZWxlY3RlZFswXSA9PT0gZmlsZS5pZCAmJiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnRzLmdyaWRTaXplLnZhbHVlID09PSAnMScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGltYWdlVXJsID0gYXBwU3RhdGUuaW1hZ2VDYWNoZS5nZXQoZmlsZS5pZCkgfHwgZmlsZS50aHVtYm5haWxMaW5rIHx8IGZpbGUuZG93bmxvYWRVcmw7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW1hZ2VVcmwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cub3BlbihpbWFnZVVybCwgJ19ibGFuaycpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRvZ2dsZVNlbGVjdGlvbihlLCBmaWxlLmlkKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBkaXYuYXBwZW5kQ2hpbGQoaW1nKTsKICAgICAgICAgICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoZGl2KTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9LAogICAgICAgICAgICAKICAgICAgICAgICAgdG9nZ2xlU2VsZWN0aW9uOiBmdW5jdGlvbihlLCBmaWxlSWQpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGdyaWRJdGVtID0gZS5jdXJyZW50VGFyZ2V0OwogICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSBhcHBTdGF0ZS5ncmlkLnNlbGVjdGVkLmluZGV4T2YoZmlsZUlkKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKGluZGV4ID09PSAtMSkgewogICAgICAgICAgICAgICAgICAgIGFwcFN0YXRlLmdyaWQuc2VsZWN0ZWQucHVzaChmaWxlSWQpOwogICAgICAgICAgICAgICAgICAgIGdyaWRJdGVtLmNsYXNzTGlzdC5hZGQoJ3NlbGVjdGVkJyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGFwcFN0YXRlLmdyaWQuc2VsZWN0ZWQuc3BsaWNlKGluZGV4LCAxKTsKICAgICAgICAgICAgICAgICAgICBncmlkSXRlbS5jbGFzc0xpc3QucmVtb3ZlKCdzZWxlY3RlZCcpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVNlbGVjdGlvblVJKCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIChhcHBTdGF0ZS5ncmlkLnNlbGVjdGVkLmxlbmd0aCA9PT0gMSAmJiBlbGVtZW50cy5ncmlkU2l6ZS52YWx1ZSA9PT0gJzEnKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5mb2N1c09uU2VsZWN0ZWRJdGVtKGFwcFN0YXRlLmdyaWQuc2VsZWN0ZWRbMF0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICAKICAgICAgICAgICAgZm9jdXNPblNlbGVjdGVkSXRlbTogZnVuY3Rpb24oZmlsZUlkKSB7CiAgICAgICAgICAgICAgICBjb25zdCBzZWxlY3RlZEl0ZW0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAuZ3JpZC1pdGVtW2RhdGEtZmlsZS1pZD0iJHtmaWxlSWR9Il1gKTsKICAgICAgICAgICAgICAgIGlmIChzZWxlY3RlZEl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZEl0ZW0uc2Nyb2xsSW50b1ZpZXcoeyBiZWhhdmlvcjogJ3Ntb290aCcsIGJsb2NrOiAnY2VudGVyJyB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgCiAgICAgICAgICAgIHVwZGF0ZVNlbGVjdGlvblVJOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGNvdW50ID0gYXBwU3RhdGUuZ3JpZC5zZWxlY3RlZC5sZW5ndGg7CiAgICAgICAgICAgICAgICBjb25zdCBidXR0b25zID0gW2VsZW1lbnRzLnRhZ1NlbGVjdGVkLCBlbGVtZW50cy5tb3ZlU2VsZWN0ZWQsIGVsZW1lbnRzLmRlbGV0ZVNlbGVjdGVkXTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZWxlbWVudHMuc2VsZWN0aW9uVGV4dC50ZXh0Q29udGVudCA9IGAke2NvdW50fSBzZWxlY3RlZGA7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGJ1dHRvbnMuZm9yRWFjaChidG4gPT4gewogICAgICAgICAgICAgICAgICAgIGlmIChidG4pIGJ0bi5jbGFzc0xpc3QudG9nZ2xlKCdoaWRkZW4nLCBjb3VudCA9PT0gMCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGVjdEFsbDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBjb25zdCBncmlkSXRlbXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcjZ3JpZC1jb250YWluZXIgLmdyaWQtaXRlbScpOwogICAgICAgICAgICAgICAgYXBwU3RhdGUuZ3JpZC5zZWxlY3RlZCA9IFtdOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBncmlkSXRlbXMuZm9yRWFjaChpdGVtID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBmaWxlSWQgPSBpdGVtLmRhdGFzZXQuZmlsZUlkOwogICAgICAgICAgICAgICAgICAgIGlmIChmaWxlSWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYXBwU3RhdGUuZ3JpZC5zZWxlY3RlZC5wdXNoKGZpbGVJZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uY2xhc3NMaXN0LmFkZCgnc2VsZWN0ZWQnKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdGhpcy51cGRhdGVTZWxlY3Rpb25VSSgpOwogICAgICAgICAgICB9LAogICAgICAgICAgICAKICAgICAgICAgICAgZGVzZWxlY3RBbGw6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnI2dyaWQtY29udGFpbmVyIC5ncmlkLWl0ZW0nKS5mb3JFYWNoKGl0ZW0gPT4gCiAgICAgICAgICAgICAgICAgICAgaXRlbS5jbGFzc0xpc3QucmVtb3ZlKCdzZWxlY3RlZCcpCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgYXBwU3RhdGUuZ3JpZC5zZWxlY3RlZCA9IFtdOwogICAgICAgICAgICAgICAgdGhpcy51cGRhdGVTZWxlY3Rpb25VSSgpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICAKICAgICAgICAvLyA9PT09PSBEZXRhaWxzIE1vZGFsID09PT09CiAgICAgICAgY29uc3QgZGV0YWlsc01vZGFsID0gewogICAgICAgICAgICBjdXJyZW50VGFiOiAnaW5mbycsCiAgICAgICAgICAgIAogICAgICAgICAgICBzaG93OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRGaWxlID0gYXBwU3RhdGUuaW1hZ2VGaWxlc1thcHBTdGF0ZS5jdXJyZW50SW1hZ2VJbmRleF07CiAgICAgICAgICAgICAgICBpZiAoIWN1cnJlbnRGaWxlKSByZXR1cm47CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHRoaXMucG9wdWxhdGVBbGxUYWJzKGN1cnJlbnRGaWxlKTsKICAgICAgICAgICAgICAgIGVsZW1lbnRzLmRldGFpbHNNb2RhbC5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgIHRoaXMuc3dpdGNoVGFiKCdpbmZvJyk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIAogICAgICAgICAgICBoaWRlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGVsZW1lbnRzLmRldGFpbHNNb2RhbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgCiAgICAgICAgICAgIHN3aXRjaFRhYjogZnVuY3Rpb24odGFiTmFtZSkgewogICAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnRhYi1idXR0b24nKS5mb3JFYWNoKGJ0biA9PiB7CiAgICAgICAgICAgICAgICAgICAgYnRuLmNsYXNzTGlzdC50b2dnbGUoJ2FjdGl2ZScsIGJ0bi5kYXRhc2V0LnRhYiA9PT0gdGFiTmFtZSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnRhYi1jb250ZW50JykuZm9yRWFjaChjb250ZW50ID0+IHsKICAgICAgICAgICAgICAgICAgICBjb250ZW50LmNsYXNzTGlzdC50b2dnbGUoJ2FjdGl2ZScsIGNvbnRlbnQuaWQgPT09IGB0YWItJHt0YWJOYW1lfWApOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFRhYiA9IHRhYk5hbWU7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIAogICAgICAgICAgICBwb3B1bGF0ZUFsbFRhYnM6IGZ1bmN0aW9uKGZpbGUpIHsKICAgICAgICAgICAgICAgIHRoaXMucG9wdWxhdGVJbmZvVGFiKGZpbGUpOwogICAgICAgICAgICAgICAgdGhpcy5wb3B1bGF0ZVRhZ3NUYWIoZmlsZSk7CiAgICAgICAgICAgICAgICB0aGlzLnBvcHVsYXRlTm90ZXNUYWIoZmlsZSk7CiAgICAgICAgICAgICAgICB0aGlzLnBvcHVsYXRlTWV0YWRhdGFUYWIoZmlsZSk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIAogICAgICAgICAgICBwb3B1bGF0ZUluZm9UYWI6IGZ1bmN0aW9uKGZpbGUpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGZpbGVuYW1lID0gZmlsZS5uYW1lIHx8ICdVbmtub3duJzsKICAgICAgICAgICAgICAgIGVsZW1lbnRzLmRldGFpbEZpbGVuYW1lLnRleHRDb250ZW50ID0gZmlsZW5hbWU7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIChmaWxlLmRvd25sb2FkVXJsKSB7CiAgICAgICAgICAgICAgICAgICAgZWxlbWVudHMuZGV0YWlsRmlsZW5hbWVMaW5rLmhyZWYgPSBmaWxlLmRvd25sb2FkVXJsOwogICAgICAgICAgICAgICAgICAgIGVsZW1lbnRzLmRldGFpbEZpbGVuYW1lTGluay5zdHlsZS5kaXNwbGF5ID0gJ2lubGluZSc7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGVsZW1lbnRzLmRldGFpbEZpbGVuYW1lTGluay5ocmVmID0gJyMnOwogICAgICAgICAgICAgICAgICAgIGVsZW1lbnRzLmRldGFpbEZpbGVuYW1lTGluay5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb25zdCBkYXRlID0gZmlsZS5tb2RpZmllZFRpbWUgPyBuZXcgRGF0ZShmaWxlLm1vZGlmaWVkVGltZSkudG9Mb2NhbGVTdHJpbmcoKSA6IAogICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlLmNyZWF0ZWRUaW1lID8gbmV3IERhdGUoZmlsZS5jcmVhdGVkVGltZSkudG9Mb2NhbGVTdHJpbmcoKSA6ICdVbmtub3duJzsKICAgICAgICAgICAgICAgIGVsZW1lbnRzLmRldGFpbERhdGUudGV4dENvbnRlbnQgPSBkYXRlOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb25zdCBzaXplID0gZmlsZS5zaXplID8gdXRpbHMuZm9ybWF0RmlsZVNpemUoZmlsZS5zaXplKSA6ICdVbmtub3duJzsKICAgICAgICAgICAgICAgIGVsZW1lbnRzLmRldGFpbFNpemUudGV4dENvbnRlbnQgPSBzaXplOwogICAgICAgICAgICB9LAogICAgICAgICAgICAKICAgICAgICAgICAgcG9wdWxhdGVUYWdzVGFiOiBmdW5jdGlvbihmaWxlKSB7CiAgICAgICAgICAgICAgICBjb25zdCB0YWdzID0gdGFnU3lzdGVtLmdldEZpbGVUYWdzKGZpbGUpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBlbGVtZW50cy5kZXRhaWxUYWdzLmlubmVySFRNTCA9ICcnOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB0YWdzLmZvckVhY2godGFnID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB0YWdFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgICAgICAgICAgdGFnRWxlbWVudC5jbGFzc05hbWUgPSAndGFnLWl0ZW0nOwogICAgICAgICAgICAgICAgICAgIHRhZ0VsZW1lbnQuaW5uZXJIVE1MID0gYAogICAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj4ke3RhZ308L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9InRhZy1yZW1vdmUiIGRhdGEtdGFnPSIke3RhZ30iPsOXPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgYDsKICAgICAgICAgICAgICAgICAgICBlbGVtZW50cy5kZXRhaWxUYWdzLmFwcGVuZENoaWxkKHRhZ0VsZW1lbnQpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNvbnN0IGFkZEJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgICAgICAgICAgYWRkQnV0dG9uLmNsYXNzTmFtZSA9ICdhZGQtdGFnLWJ0bic7CiAgICAgICAgICAgICAgICBhZGRCdXR0b24udGV4dENvbnRlbnQgPSAnKyBBZGQgVGFnJzsKICAgICAgICAgICAgICAgIGFkZEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHRoaXMuc2hvd0FkZFRhZ0lucHV0KCkpOwogICAgICAgICAgICAgICAgZWxlbWVudHMuZGV0YWlsVGFncy5hcHBlbmRDaGlsZChhZGRCdXR0b24pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBlbGVtZW50cy5kZXRhaWxUYWdzLnF1ZXJ5U2VsZWN0b3JBbGwoJy50YWctcmVtb3ZlJykuZm9yRWFjaChidG4gPT4gewogICAgICAgICAgICAgICAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRhZ1RvUmVtb3ZlID0gZS50YXJnZXQuZGF0YXNldC50YWc7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlVGFnKGZpbGUsIHRhZ1RvUmVtb3ZlKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9LAogICAgICAgICAgICAKICAgICAgICAgICAgc2hvd0FkZFRhZ0lucHV0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTsKICAgICAgICAgICAgICAgIGlucHV0LnR5cGUgPSAndGV4dCc7CiAgICAgICAgICAgICAgICBpbnB1dC5jbGFzc05hbWUgPSAndGFnLWlucHV0JzsKICAgICAgICAgICAgICAgIGlucHV0LnBsYWNlaG9sZGVyID0gJ0VudGVyIHRhZyBuYW1lJzsKICAgICAgICAgICAgICAgIGlucHV0LnN0eWxlLm1hcmdpbkxlZnQgPSAnOHB4JzsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc3QgYWRkQnV0dG9uID0gZWxlbWVudHMuZGV0YWlsVGFncy5xdWVyeVNlbGVjdG9yKCcuYWRkLXRhZy1idG4nKTsKICAgICAgICAgICAgICAgIGFkZEJ1dHRvbi5wYXJlbnROb2RlLmluc2VydEJlZm9yZShpbnB1dCwgYWRkQnV0dG9uKTsKICAgICAgICAgICAgICAgIGlucHV0LmZvY3VzKCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBhc3luYyAoZSkgPT4gewogICAgICAgICAgICAgICAgICAgIGlmIChlLmtleSA9PT0gJ0VudGVyJykgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0YWdOYW1lID0gaW5wdXQudmFsdWUudHJpbSgpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGFnTmFtZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudEZpbGUgPSBhcHBTdGF0ZS5pbWFnZUZpbGVzW2FwcFN0YXRlLmN1cnJlbnRJbWFnZUluZGV4XTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGFnU3lzdGVtLmFkZFRhZ3NUb0ZpbGUoY3VycmVudEZpbGUuaWQsIFt0YWdOYW1lXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXRpbHMuc2hvd1RvYXN0KGBBZGRlZCB0YWc6ICR7dGFnTmFtZX1gKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnB1dC5yZW1vdmUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgYWRkaW5nIHRhZzonLCBlcnJvcik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXRpbHMuc2hvd1RvYXN0KCdGYWlsZWQgdG8gYWRkIHRhZycsICdlcnJvcicpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlLmtleSA9PT0gJ0VzY2FwZScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXQucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2JsdXInLCAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiBpbnB1dC5yZW1vdmUoKSwgMTAwKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9LAogICAgICAgICAgICAKICAgICAgICAgICAgcmVtb3ZlVGFnOiBhc3luYyBmdW5jdGlvbihmaWxlLCB0YWdUb1JlbW92ZSkgewogICAgICAgICAgICAgICAgY29uc3QgY3VycmVudFRhZ3MgPSB0YWdTeXN0ZW0uZ2V0RmlsZVRhZ3MoZmlsZSk7CiAgICAgICAgICAgICAgICBjb25zdCBuZXdUYWdzID0gY3VycmVudFRhZ3MuZmlsdGVyKHRhZyA9PiB0YWcgIT09IHRhZ1RvUmVtb3ZlKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZmlsZS5hcHBQcm9wZXJ0aWVzID0gZmlsZS5hcHBQcm9wZXJ0aWVzIHx8IHt9OwogICAgICAgICAgICAgICAgZmlsZS5hcHBQcm9wZXJ0aWVzLnNsaWRlYm94VGFncyA9IG5ld1RhZ3Muam9pbignLCcpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGF3YWl0IGFwcFN0YXRlLmNsb3VkU3RvcmFnZS51cGRhdGVGaWxlUHJvcGVydGllcyhmaWxlLmlkLCBmaWxlLmFwcFByb3BlcnRpZXMpOwogICAgICAgICAgICAgICAgICAgIHRoaXMucG9wdWxhdGVUYWdzVGFiKGZpbGUpOwogICAgICAgICAgICAgICAgICAgIHV0aWxzLnNob3dUb2FzdChgUmVtb3ZlZCB0YWc6ICR7dGFnVG9SZW1vdmV9YCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHJlbW92aW5nIHRhZzonLCBlcnJvcik7CiAgICAgICAgICAgICAgICAgICAgdXRpbHMuc2hvd1RvYXN0KCdGYWlsZWQgdG8gcmVtb3ZlIHRhZycsICdlcnJvcicpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICAKICAgICAgICAgICAgcG9wdWxhdGVOb3Rlc1RhYjogZnVuY3Rpb24oZmlsZSkgewogICAgICAgICAgICAgICAgZWxlbWVudHMuZGV0YWlsTm90ZXMudmFsdWUgPSBmaWxlLm5vdGVzIHx8ICcnOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb25zdCBuZXdOb3Rlc1RleHRhcmVhID0gZWxlbWVudHMuZGV0YWlsTm90ZXMuY2xvbmVOb2RlKHRydWUpOwogICAgICAgICAgICAgICAgZWxlbWVudHMuZGV0YWlsTm90ZXMucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQobmV3Tm90ZXNUZXh0YXJlYSwgZWxlbWVudHMuZGV0YWlsTm90ZXMpOwogICAgICAgICAgICAgICAgZWxlbWVudHMuZGV0YWlsTm90ZXMgPSBuZXdOb3Rlc1RleHRhcmVhOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBlbGVtZW50cy5kZXRhaWxOb3Rlcy5hZGRFdmVudExpc3RlbmVyKCdibHVyJywgYXN5bmMgKCkgPT4gewogICAgICAgICAgICAgICAgICAgIGZpbGUubm90ZXMgPSBlbGVtZW50cy5kZXRhaWxOb3Rlcy52YWx1ZTsKICAgICAgICAgICAgICAgICAgICBmaWxlLmFwcFByb3BlcnRpZXMgPSBmaWxlLmFwcFByb3BlcnRpZXMgfHwge307CiAgICAgICAgICAgICAgICAgICAgZmlsZS5hcHBQcm9wZXJ0aWVzLm5vdGVzID0gZmlsZS5ub3RlczsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBhcHBTdGF0ZS5jbG91ZFN0b3JhZ2UudXBkYXRlRmlsZVByb3BlcnRpZXMoZmlsZS5pZCwgZmlsZS5hcHBQcm9wZXJ0aWVzKTsKICAgICAgICAgICAgICAgICAgICAgICAgdXRpbHMuc2hvd1RvYXN0KCdOb3RlcyBzYXZlZCcpOwogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHNhdmluZyBub3RlczonLCBlcnJvcik7CiAgICAgICAgICAgICAgICAgICAgICAgIHV0aWxzLnNob3dUb2FzdCgnRmFpbGVkIHRvIHNhdmUgbm90ZXMnLCAnZXJyb3InKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdGhpcy5zZXR1cFN0YXJSYXRpbmcoZWxlbWVudHMucXVhbGl0eVJhdGluZywgZmlsZS5xdWFsaXR5UmF0aW5nIHx8IDAsIGFzeW5jIChyYXRpbmcpID0+IHsKICAgICAgICAgICAgICAgICAgICBmaWxlLnF1YWxpdHlSYXRpbmcgPSByYXRpbmc7CiAgICAgICAgICAgICAgICAgICAgZmlsZS5hcHBQcm9wZXJ0aWVzID0gZmlsZS5hcHBQcm9wZXJ0aWVzIHx8IHt9OwogICAgICAgICAgICAgICAgICAgIGZpbGUuYXBwUHJvcGVydGllcy5xdWFsaXR5UmF0aW5nID0gcmF0aW5nOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IGFwcFN0YXRlLmNsb3VkU3RvcmFnZS51cGRhdGVGaWxlUHJvcGVydGllcyhmaWxlLmlkLCBmaWxlLmFwcFByb3BlcnRpZXMpOwogICAgICAgICAgICAgICAgICAgICAgICB1dGlscy5zaG93VG9hc3QoJ1F1YWxpdHkgcmF0aW5nIHNhdmVkJyk7CiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3Igc2F2aW5nIHF1YWxpdHkgcmF0aW5nOicsIGVycm9yKTsKICAgICAgICAgICAgICAgICAgICAgICAgdXRpbHMuc2hvd1RvYXN0KCdGYWlsZWQgdG8gc2F2ZSByYXRpbmcnLCAnZXJyb3InKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdGhpcy5zZXR1cFN0YXJSYXRpbmcoZWxlbWVudHMuY29udGVudFJhdGluZywgZmlsZS5jb250ZW50UmF0aW5nIHx8IDAsIGFzeW5jIChyYXRpbmcpID0+IHsKICAgICAgICAgICAgICAgICAgICBmaWxlLmNvbnRlbnRSYXRpbmcgPSByYXRpbmc7CiAgICAgICAgICAgICAgICAgICAgZmlsZS5hcHBQcm9wZXJ0aWVzID0gZmlsZS5hcHBQcm9wZXJ0aWVzIHx8IHt9OwogICAgICAgICAgICAgICAgICAgIGZpbGUuYXBwUHJvcGVydGllcy5jb250ZW50UmF0aW5nID0gcmF0aW5nOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IGFwcFN0YXRlLmNsb3VkU3RvcmFnZS51cGRhdGVGaWxlUHJvcGVydGllcyhmaWxlLmlkLCBmaWxlLmFwcFByb3BlcnRpZXMpOwogICAgICAgICAgICAgICAgICAgICAgICB1dGlscy5zaG93VG9hc3QoJ0NvbnRlbnQgcmF0aW5nIHNhdmVkJyk7CiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3Igc2F2aW5nIGNvbnRlbnQgcmF0aW5nOicsIGVycm9yKTsKICAgICAgICAgICAgICAgICAgICAgICAgdXRpbHMuc2hvd1RvYXN0KCdGYWlsZWQgdG8gc2F2ZSByYXRpbmcnLCAnZXJyb3InKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgCiAgICAgICAgICAgIHNldHVwU3RhclJhdGluZzogZnVuY3Rpb24oY29udGFpbmVyLCBjdXJyZW50UmF0aW5nLCBvblJhdGluZ0NoYW5nZSkgewogICAgICAgICAgICAgICAgY29uc3Qgc3RhcnMgPSBjb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnLnN0YXInKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc3RhcnMuZm9yRWFjaCgoc3RhciwgaW5kZXgpID0+IHsKICAgICAgICAgICAgICAgICAgICBzdGFyLmNsYXNzTGlzdC50b2dnbGUoJ2FjdGl2ZScsIGluZGV4IDwgY3VycmVudFJhdGluZyk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc3RhcnMuZm9yRWFjaCgoc3RhciwgaW5kZXgpID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXdDbGlja0hhbmRsZXIgPSAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG5ld1JhdGluZyA9IGluZGV4ICsgMTsKICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnMuZm9yRWFjaCgocywgaSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcy5jbGFzc0xpc3QudG9nZ2xlKCdhY3RpdmUnLCBpIDwgbmV3UmF0aW5nKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIG9uUmF0aW5nQ2hhbmdlKG5ld1JhdGluZyk7CiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBzdGFyLnJlcGxhY2VXaXRoKHN0YXIuY2xvbmVOb2RlKHRydWUpKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXdTdGFyID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoJy5zdGFyJylbaW5kZXhdOwogICAgICAgICAgICAgICAgICAgIG5ld1N0YXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBuZXdDbGlja0hhbmRsZXIpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIG5ld1N0YXIuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VlbnRlcicsICgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnMuZm9yRWFjaCgocywgaSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcy5zdHlsZS5jb2xvciA9IGkgPD0gaW5kZXggPyAnI2ZiYmYyNCcgOiAnI2QxZDVkYic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIG5ld1N0YXIuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VsZWF2ZScsICgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnMuZm9yRWFjaCgocywgaSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcy5zdHlsZS5jb2xvciA9IHMuY2xhc3NMaXN0LmNvbnRhaW5zKCdhY3RpdmUnKSA/ICcjZmJiZjI0JyA6ICcjZDFkNWRiJzsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vID09PT09IFNJTVBMSUZJRUQgTUVUQURBVEEgRElTUExBWSA9PT09PQogICAgICAgICAgICBwb3B1bGF0ZU1ldGFkYXRhVGFiOiBmdW5jdGlvbihmaWxlKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygn8J+TiiBQb3B1bGF0aW5nIG1ldGFkYXRhIHRhYiBmb3I6JywgZmlsZS5uYW1lKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZWxlbWVudHMubWV0YWRhdGFUYWJsZS5pbm5lckhUTUwgPSAnJzsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc3QgYWxsTWV0YWRhdGEgPSB0aGlzLmV4dHJhY3RBbGxNZXRhZGF0YShmaWxlKTsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCfwn5OLIERpc3BsYXlpbmcgbWV0YWRhdGE6JywgYWxsTWV0YWRhdGEpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmtleXMoYWxsTWV0YWRhdGEpLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkTWV0YWRhdGFSb3coJ1N0YXR1cycsICdObyBlbWJlZGRlZCBtZXRhZGF0YSBmb3VuZCcsIGZhbHNlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gUHJpb3JpdHkgZmllbGRzIHdpdGggY29weSBidXR0b25zCiAgICAgICAgICAgICAgICBjb25zdCBwcmlvcml0eUZpZWxkcyA9IFsncHJvbXB0JywgJ21vZGVsJywgJ3NlZWQnLCAnbmVnYXRpdmVfcHJvbXB0JywgJ3N0ZXBzJywgJ2NmZyddOwogICAgICAgICAgICAgICAgcHJpb3JpdHlGaWVsZHMuZm9yRWFjaChmaWVsZCA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGFsbE1ldGFkYXRhW2ZpZWxkXSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZE1ldGFkYXRhUm93KGZpZWxkLCBhbGxNZXRhZGF0YVtmaWVsZF0sIHRydWUpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBPdGhlciBmaWVsZHMKICAgICAgICAgICAgICAgIE9iamVjdC5lbnRyaWVzKGFsbE1ldGFkYXRhKS5mb3JFYWNoKChba2V5LCB2YWx1ZV0pID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAoIXByaW9yaXR5RmllbGRzLmluY2x1ZGVzKGtleS50b0xvd2VyQ2FzZSgpKSAmJiB2YWx1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZE1ldGFkYXRhUm93KGtleSwgdmFsdWUsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gQmFzaWMgZmlsZSBpbmZvCiAgICAgICAgICAgICAgICB0aGlzLmFkZE1ldGFkYXRhUm93KCdGaWxlIE5hbWUnLCBmaWxlLm5hbWUgfHwgJ1Vua25vd24nLCBmYWxzZSk7CiAgICAgICAgICAgICAgICB0aGlzLmFkZE1ldGFkYXRhUm93KCdGaWxlIFNpemUnLCBmaWxlLnNpemUgPyB1dGlscy5mb3JtYXRGaWxlU2l6ZShmaWxlLnNpemUpIDogJ1Vua25vd24nLCBmYWxzZSk7CiAgICAgICAgICAgICAgICB0aGlzLmFkZE1ldGFkYXRhUm93KCdNSU1FIFR5cGUnLCBmaWxlLm1pbWVUeXBlIHx8ICdVbmtub3duJywgZmFsc2UpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygn4pyFIE1ldGFkYXRhIHRhYiBwb3B1bGF0ZWQnKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgCiAgICAgICAgICAgIGV4dHJhY3RBbGxNZXRhZGF0YTogZnVuY3Rpb24oZmlsZSkgewogICAgICAgICAgICAgICAgY29uc3QgbWV0YWRhdGEgPSB7fTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ/Cfk4ogQ29tYmluaW5nIG1ldGFkYXRhIGZvcjonLCBmaWxlLm5hbWUpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBGcm9tIGV4dHJhY3RlZCBtZXRhZGF0YSAoZW1iZWRkZWQgaW4gaW1hZ2UpCiAgICAgICAgICAgICAgICBpZiAoZmlsZS5leHRyYWN0ZWRNZXRhZGF0YSkgewogICAgICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24obWV0YWRhdGEsIGZpbGUuZXh0cmFjdGVkTWV0YWRhdGEpOwogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCfwn5OEIEFkZGVkIGV4dHJhY3RlZDonLCBPYmplY3Qua2V5cyhmaWxlLmV4dHJhY3RlZE1ldGFkYXRhKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIEZyb20gYXBwUHJvcGVydGllcyAoc3RvcmVkIGluIEdvb2dsZSBEcml2ZSkgLSBidXQgc2tpcCBvdXIgaW50ZXJuYWwgZmllbGRzCiAgICAgICAgICAgICAgICBpZiAoZmlsZS5hcHBQcm9wZXJ0aWVzKSB7CiAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmVudHJpZXMoZmlsZS5hcHBQcm9wZXJ0aWVzKS5mb3JFYWNoKChba2V5LCB2YWx1ZV0pID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFbJ3NsaWRlYm94U3RhY2snLCAnc2xpZGVib3hUYWdzJywgJ3F1YWxpdHlSYXRpbmcnLCAnY29udGVudFJhdGluZycsICdub3RlcyddLmluY2x1ZGVzKGtleSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGFkYXRhW2tleV0gPSB2YWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCfwn5OBIEFkZGVkIGFwcCBwcm9wZXJ0aWVzJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCfwn46vIEZpbmFsIG1ldGFkYXRhIGtleXM6JywgT2JqZWN0LmtleXMobWV0YWRhdGEpKTsKICAgICAgICAgICAgICAgIHJldHVybiBtZXRhZGF0YTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgCiAgICAgICAgICAgIGFkZE1ldGFkYXRhUm93OiBmdW5jdGlvbihrZXksIHZhbHVlLCBuZWVkc0NvcHlCdXR0b24gPSBmYWxzZSkgewogICAgICAgICAgICAgICAgY29uc3Qgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc3QgZm9ybWF0dGVkS2V5ID0ga2V5LnJlcGxhY2UoL18vZywgJyAnKS5yZXBsYWNlKC9cYlx3L2csIGwgPT4gbC50b1VwcGVyQ2FzZSgpKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbGV0IGZvcm1hdHRlZFZhbHVlID0gU3RyaW5nKHZhbHVlKTsKICAgICAgICAgICAgICAgIGlmIChmb3JtYXR0ZWRWYWx1ZS5sZW5ndGggPiAxMDApIHsKICAgICAgICAgICAgICAgICAgICBmb3JtYXR0ZWRWYWx1ZSA9IGZvcm1hdHRlZFZhbHVlLnJlcGxhY2UoLywoPz1ccykvZywgJyxcbicpLnJlcGxhY2UoL1xzKy9nLCAnICcpLnRyaW0oKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc3Qga2V5Q2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7CiAgICAgICAgICAgICAgICBrZXlDZWxsLmNsYXNzTmFtZSA9ICdrZXktY2VsbCc7CiAgICAgICAgICAgICAgICBrZXlDZWxsLnRleHRDb250ZW50ID0gZm9ybWF0dGVkS2V5OwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZUNlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpOwogICAgICAgICAgICAgICAgdmFsdWVDZWxsLmNsYXNzTmFtZSA9ICd2YWx1ZS1jZWxsJzsKICAgICAgICAgICAgICAgIHZhbHVlQ2VsbC50ZXh0Q29udGVudCA9IGZvcm1hdHRlZFZhbHVlOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAobmVlZHNDb3B5QnV0dG9uKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29weUJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpOwogICAgICAgICAgICAgICAgICAgIGNvcHlCdXR0b24uY2xhc3NOYW1lID0gJ2NvcHktYnV0dG9uIGNvcHktbWV0YWRhdGEnOwogICAgICAgICAgICAgICAgICAgIGNvcHlCdXR0b24udGV4dENvbnRlbnQgPSAnQ29weSc7CiAgICAgICAgICAgICAgICAgICAgY29weUJ1dHRvbi5kYXRhc2V0LnZhbHVlID0gU3RyaW5nKHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICB2YWx1ZUNlbGwuYXBwZW5kQ2hpbGQoY29weUJ1dHRvbik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJvdy5hcHBlbmRDaGlsZChrZXlDZWxsKTsKICAgICAgICAgICAgICAgIHJvdy5hcHBlbmRDaGlsZCh2YWx1ZUNlbGwpOwogICAgICAgICAgICAgICAgZWxlbWVudHMubWV0YWRhdGFUYWJsZS5hcHBlbmRDaGlsZChyb3cpOwogICAgICAgICAgICB9LAogICAgICAgICAgICAKICAgICAgICAgICAgY29weVRvQ2xpcGJvYXJkOiBmdW5jdGlvbih0ZXh0KSB7CiAgICAgICAgICAgICAgICBuYXZpZ2F0b3IuY2xpcGJvYXJkLndyaXRlVGV4dCh0ZXh0KS50aGVuKCgpID0+IHsKICAgICAgICAgICAgICAgICAgICB1dGlscy5zaG93VG9hc3QoJ0NvcGllZCB0byBjbGlwYm9hcmQnKTsKICAgICAgICAgICAgICAgIH0pLmNhdGNoKCgpID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB0ZXh0QXJlYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RleHRhcmVhJyk7CiAgICAgICAgICAgICAgICAgICAgdGV4dEFyZWEudmFsdWUgPSB0ZXh0OwogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGV4dEFyZWEpOwogICAgICAgICAgICAgICAgICAgIHRleHRBcmVhLnNlbGVjdCgpOwogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmV4ZWNDb21tYW5kKCdjb3B5Jyk7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZCh0ZXh0QXJlYSk7CiAgICAgICAgICAgICAgICAgICAgdXRpbHMuc2hvd1RvYXN0KCdDb3BpZWQgdG8gY2xpcGJvYXJkJyk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgCiAgICAgICAgLy8gPT09PT0gTW9kYWwgTWFuYWdlciA9PT09PQogICAgICAgIGNvbnN0IG1vZGFsTWFuYWdlciA9IHsKICAgICAgICAgICAgc2hvdzogZnVuY3Rpb24obW9kYWxJZCkgewogICAgICAgICAgICAgICAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtb2RhbElkKTsKICAgICAgICAgICAgICAgIGlmIChtb2RhbCkgbW9kYWwuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIAogICAgICAgICAgICBoaWRlOiBmdW5jdGlvbihtb2RhbElkKSB7CiAgICAgICAgICAgICAgICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZGFsSWQpOwogICAgICAgICAgICAgICAgaWYgKG1vZGFsKSBtb2RhbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgCiAgICAgICAgICAgIHNldHVwOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5tb3ZlLW9wdGlvbicpLmZvckVhY2gob3B0aW9uID0+IHsKICAgICAgICAgICAgICAgICAgICBvcHRpb24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldFN0YWNrID0gb3B0aW9uLmRhdGFzZXQuc3RhY2s7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb21pc2VzID0gYXBwU3RhdGUuZ3JpZC5zZWxlY3RlZC5tYXAoZmlsZUlkID0+IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhY2tNYW5hZ2VyLm1vdmVGaWxlVG9TdGFjayhmaWxlSWQsIHRhcmdldFN0YWNrKQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgUHJvbWlzZS5hbGwocHJvbWlzZXMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXRpbHMuc2hvd1RvYXN0KGBNb3ZlZCAke3Byb21pc2VzLmxlbmd0aH0gaW1hZ2VzIHRvICR7dGFyZ2V0U3RhY2t9YCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5oaWRlKCdtb3ZlLW1vZGFsJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFwcFN0YXRlLmdyaWQuc3RhY2spIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JpZFZpZXcucG9wdWxhdGUoYXBwU3RhdGUuZ3JpZC5zdGFjayk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcFN0YXRlLmdyaWQuc2VsZWN0ZWQgPSBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncmlkVmlldy51cGRhdGVTZWxlY3Rpb25VSSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrTWFuYWdlci51cGRhdGVDb3VudHMoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV0aWxzLnNob3dUb2FzdCgnRmFpbGVkIHRvIG1vdmUgc29tZSBpbWFnZXMnLCAnZXJyb3InKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmhpZGUoJ21vdmUtbW9kYWwnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhcHBseS10YWcnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFzeW5jICgpID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB0YWdJbnB1dCA9IGVsZW1lbnRzLnRhZ0lucHV0LnZhbHVlLnRyaW0oKTsKICAgICAgICAgICAgICAgICAgICBpZiAoIXRhZ0lucHV0KSByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGFncyA9IHRhZ0lucHV0LnNwbGl0KCcsJykubWFwKHRhZyA9PiB0YWcudHJpbSgpKS5maWx0ZXIodGFnID0+IHRhZyk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ/Cfj7fvuI8gQnVsayBhZGRpbmcgdGFnczonLCB0YWdzLCAndG8nLCBhcHBTdGF0ZS5ncmlkLnNlbGVjdGVkLmxlbmd0aCwgJ2ZpbGVzJyk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBmaWxlSWQgb2YgYXBwU3RhdGUuZ3JpZC5zZWxlY3RlZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGFnU3lzdGVtLmFkZFRhZ3NUb0ZpbGUoZmlsZUlkLCB0YWdzKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgdXRpbHMuc2hvd1RvYXN0KGBUYWdzIGFkZGVkIHRvICR7YXBwU3RhdGUuZ3JpZC5zZWxlY3RlZC5sZW5ndGh9IGltYWdlc2ApOwogICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50cy50YWdJbnB1dC52YWx1ZSA9ICcnOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmhpZGUoJ3RhZy1tb2RhbCcpOwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFwcFN0YXRlLmdyaWQuc3RhY2spIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyaWRWaWV3LnBvcHVsYXRlKGFwcFN0YXRlLmdyaWQuc3RhY2spOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0J1bGsgdGFnIGZhaWxlZDonLCBlcnJvcik7CiAgICAgICAgICAgICAgICAgICAgICAgIHV0aWxzLnNob3dUb2FzdCgnRmFpbGVkIHRvIGFkZCB0YWdzJywgJ2Vycm9yJyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGVsZW1lbnRzLmNvbmZpcm1EZWxldGUuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudFN0YWNrID0gYXBwU3RhdGUuZ3JpZC5zdGFjazsKICAgICAgICAgICAgICAgICAgICBlbGVtZW50cy5jb25maXJtRGVsZXRlLmRpc2FibGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBlbGVtZW50cy5jb25maXJtRGVsZXRlLnRleHRDb250ZW50ID0gJ1Byb2Nlc3NpbmcuLi4nOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50U3RhY2sgPT09ICd0cmFzaCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJvbWlzZXMgPSBhcHBTdGF0ZS5ncmlkLnNlbGVjdGVkLm1hcChmaWxlSWQgPT4gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBTdGF0ZS5jbG91ZFN0b3JhZ2UuZGVsZXRlRmlsZShmaWxlSWQpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBQcm9taXNlLmFsbChwcm9taXNlcykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKCgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dGlscy5zaG93VG9hc3QoYE1vdmVkICR7cHJvbWlzZXMubGVuZ3RofSBpbWFnZXMgdG8gR29vZ2xlIERyaXZlIHRyYXNoYCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5oaWRlKCdkZWxldGUtbW9kYWwnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBTdGF0ZS5ncmlkLnNlbGVjdGVkLmZvckVhY2goZmlsZUlkID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZmlsZUluZGV4ID0gYXBwU3RhdGUuaW1hZ2VGaWxlcy5maW5kSW5kZXgoZiA9PiBmLmlkID09PSBmaWxlSWQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmlsZUluZGV4ICE9PSAtMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwU3RhdGUuaW1hZ2VGaWxlcy5zcGxpY2UoZmlsZUluZGV4LCAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0cmFzaEluZGV4ID0gYXBwU3RhdGUuc3RhY2tzLnRyYXNoLmZpbmRJbmRleChmID0+IGYuaWQgPT09IGZpbGVJZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0cmFzaEluZGV4ICE9PSAtMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwU3RhdGUuc3RhY2tzLnRyYXNoLnNwbGljZSh0cmFzaEluZGV4LCAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhcHBTdGF0ZS5ncmlkLnN0YWNrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyaWRWaWV3LnBvcHVsYXRlKGFwcFN0YXRlLmdyaWQuc3RhY2spOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBTdGF0ZS5ncmlkLnNlbGVjdGVkID0gW107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JpZFZpZXcudXBkYXRlU2VsZWN0aW9uVUkoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFja01hbmFnZXIudXBkYXRlQ291bnRzKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dGlscy5zaG93VG9hc3QoJ0ZhaWxlZCB0byBkZWxldGUgc29tZSBpbWFnZXMnLCAnZXJyb3InKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmhpZGUoJ2RlbGV0ZS1tb2RhbCcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5maW5hbGx5KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50cy5jb25maXJtRGVsZXRlLmRpc2FibGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudHMuY29uZmlybURlbGV0ZS50ZXh0Q29udGVudCA9ICdNb3ZlIHRvIEdvb2dsZSBEcml2ZSBUcmFzaCc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwcm9taXNlcyA9IGFwcFN0YXRlLmdyaWQuc2VsZWN0ZWQubWFwKGZpbGVJZCA9PiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrTWFuYWdlci5tb3ZlRmlsZVRvU3RhY2soZmlsZUlkLCAndHJhc2gnKQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgUHJvbWlzZS5hbGwocHJvbWlzZXMpLnRoZW4oKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXRpbHMuc2hvd1RvYXN0KGBNb3ZlZCAke3Byb21pc2VzLmxlbmd0aH0gaW1hZ2VzIHRvIHRyYXNoYCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmhpZGUoJ2RlbGV0ZS1tb2RhbCcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXBwU3RhdGUuZ3JpZC5zdGFjaykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyaWRWaWV3LnBvcHVsYXRlKGFwcFN0YXRlLmdyaWQuc3RhY2spOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBTdGF0ZS5ncmlkLnNlbGVjdGVkID0gW107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBncmlkVmlldy51cGRhdGVTZWxlY3Rpb25VSSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhY2tNYW5hZ2VyLnVwZGF0ZUNvdW50cygpOwogICAgICAgICAgICAgICAgICAgICAgICB9KS5maW5hbGx5KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnRzLmNvbmZpcm1EZWxldGUuZGlzYWJsZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnRzLmNvbmZpcm1EZWxldGUudGV4dENvbnRlbnQgPSAnTW92ZSB0byBUcmFzaCc7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBbJ2NhbmNlbC1tb3ZlJywgJ2NhbmNlbC10YWcnLCAnY2FuY2VsLWRlbGV0ZSddLmZvckVhY2goaWQgPT4gewogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5oaWRlKGlkLnJlcGxhY2UoJ2NhbmNlbC0nLCAnJykgKyAnLW1vZGFsJyk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZWxlbWVudHMubW92ZVNlbGVjdGVkLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gdGhpcy5zaG93KCdtb3ZlLW1vZGFsJykpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBlbGVtZW50cy50YWdTZWxlY3RlZC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICAgICAgICAgICAgICBlbGVtZW50cy50YWdTdWdnZXN0aW9ucy5pbm5lckhUTUwgPSAnJzsKICAgICAgICAgICAgICAgICAgICBhcHBTdGF0ZS50YWdzLmZvckVhY2godGFnID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbi5jbGFzc05hbWUgPSAndGFnLXN1Z2dlc3Rpb24nOwogICAgICAgICAgICAgICAgICAgICAgICBidXR0b24udGV4dENvbnRlbnQgPSB0YWc7CiAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnRzLnRhZ0lucHV0LnZhbHVlICs9IChlbGVtZW50cy50YWdJbnB1dC52YWx1ZSA/ICcsICcgOiAnJykgKyB0YWc7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50cy50YWdTdWdnZXN0aW9ucy5hcHBlbmRDaGlsZChidXR0b24pOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvdygndGFnLW1vZGFsJyk7CiAgICAgICAgICAgICAgICAgICAgZWxlbWVudHMudGFnSW5wdXQudmFsdWUgPSAnJzsKICAgICAgICAgICAgICAgICAgICBlbGVtZW50cy50YWdJbnB1dC5mb2N1cygpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGVsZW1lbnRzLmRlbGV0ZVNlbGVjdGVkLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkQ291bnQgPSBhcHBTdGF0ZS5ncmlkLnNlbGVjdGVkLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50U3RhY2sgPSBhcHBTdGF0ZS5ncmlkLnN0YWNrOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50U3RhY2sgPT09ICd0cmFzaCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudHMuZGVsZXRlTWVzc2FnZS50ZXh0Q29udGVudCA9IGBBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gbW92ZSAke3NlbGVjdGVkQ291bnR9IGltYWdlJHtzZWxlY3RlZENvdW50ID4gMSA/ICdzJyA6ICcnfSB0byBHb29nbGUgRHJpdmUgdHJhc2g/IFRoZXkgY2FuIGJlIHJlY292ZXJlZCBmcm9tIEdvb2dsZSBEcml2ZS5gOwogICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50cy5jb25maXJtRGVsZXRlLnRleHRDb250ZW50ID0gJ01vdmUgdG8gR29vZ2xlIERyaXZlIFRyYXNoJzsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50cy5kZWxldGVNZXNzYWdlLnRleHRDb250ZW50ID0gYEFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBtb3ZlICR7c2VsZWN0ZWRDb3VudH0gaW1hZ2Uke3NlbGVjdGVkQ291bnQgPiAxID8gJ3MnIDogJyd9IHRvIFRyYXNoP2A7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnRzLmNvbmZpcm1EZWxldGUudGV4dENvbnRlbnQgPSAnTW92ZSB0byBUcmFzaCc7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvdygnZGVsZXRlLW1vZGFsJyk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgCiAgICAgICAgLy8gPT09PT0gVXRpbGl0eSBGdW5jdGlvbnMgPT09PT0KICAgICAgICBmdW5jdGlvbiB1cGRhdGVFbXB0eVN0YXRlQnV0dG9ucygpIHsKICAgICAgICAgICAgY29uc3Qgc3RhY2tzV2l0aEltYWdlcyA9IFNUQUNLX1RZUEVTLmZpbHRlcihzdGFjayA9PiBhcHBTdGF0ZS5zdGFja3Nbc3RhY2tdLmxlbmd0aCA+IDApOwogICAgICAgICAgICBjb25zdCBoYXNPdGhlclN0YWNrcyA9IHN0YWNrc1dpdGhJbWFnZXMuc29tZShzdGFjayA9PiBzdGFjayAhPT0gYXBwU3RhdGUuY3VycmVudFN0YWNrKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChoYXNPdGhlclN0YWNrcykgewogICAgICAgICAgICAgICAgZWxlbWVudHMuc2VsZWN0QW5vdGhlclN0YWNrQnRuLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgICAgICAgICAgZWxlbWVudHMuc2VsZWN0QW5vdGhlckZvbGRlckJ0bi5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZWxlbWVudHMuc2VsZWN0QW5vdGhlclN0YWNrQnRuLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgICAgICBlbGVtZW50cy5zZWxlY3RBbm90aGVyRm9sZGVyQnRuLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGZ1bmN0aW9uIHNob3dFZGdlR2xvdyhkaXJlY3Rpb24pIHsKICAgICAgICAgICAgY29uc3QgZWRnZSA9IGVsZW1lbnRzLmVkZ2VHbG93c1tkaXJlY3Rpb25dOwogICAgICAgICAgICBpZiAoZWRnZSkgewogICAgICAgICAgICAgICAgZWRnZS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICBmdW5jdGlvbiBoaWRlQWxsRWRnZUdsb3dzKCkgewogICAgICAgICAgICBPYmplY3QudmFsdWVzKGVsZW1lbnRzLmVkZ2VHbG93cykuZm9yRWFjaChlZGdlID0+IHsKICAgICAgICAgICAgICAgIGVkZ2UuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyA9PT09PSBQaW5jaCBab29tIFN5c3RlbSA9PT09PQogICAgICAgIGZ1bmN0aW9uIHNldHVwUGluY2hab29tKCkgewogICAgICAgICAgICBlbGVtZW50cy5jZW50ZXJJbWFnZS5hZGRFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0JywgaGFuZGxlVG91Y2hTdGFydCwgeyBwYXNzaXZlOiBmYWxzZSB9KTsKICAgICAgICAgICAgZWxlbWVudHMuY2VudGVySW1hZ2UuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2htb3ZlJywgaGFuZGxlVG91Y2hNb3ZlLCB7IHBhc3NpdmU6IGZhbHNlIH0pOwogICAgICAgICAgICBlbGVtZW50cy5jZW50ZXJJbWFnZS5hZGRFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsIGhhbmRsZVRvdWNoRW5kLCB7IHBhc3NpdmU6IGZhbHNlIH0pOwogICAgICAgICAgICBlbGVtZW50cy5jZW50ZXJJbWFnZS5hZGRFdmVudExpc3RlbmVyKCd3aGVlbCcsIGhhbmRsZVdoZWVsLCB7IHBhc3NpdmU6IGZhbHNlIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgZnVuY3Rpb24gaGFuZGxlVG91Y2hTdGFydChlKSB7CiAgICAgICAgICAgICAgICBpZiAoZS50b3VjaGVzLmxlbmd0aCA9PT0gMikgewogICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgICAgICBhcHBTdGF0ZS5pc1BpbmNoaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBhcHBTdGF0ZS5pbml0aWFsRGlzdGFuY2UgPSBnZXREaXN0YW5jZShlLnRvdWNoZXNbMF0sIGUudG91Y2hlc1sxXSk7CiAgICAgICAgICAgICAgICAgICAgYXBwU3RhdGUubGFzdFRvdWNoUG9zID0gZ2V0Q2VudGVyKGUudG91Y2hlc1swXSwgZS50b3VjaGVzWzFdKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZS50b3VjaGVzLmxlbmd0aCA9PT0gMSAmJiBhcHBTdGF0ZS5jdXJyZW50U2NhbGUgPiAxKSB7CiAgICAgICAgICAgICAgICAgICAgYXBwU3RhdGUubGFzdFRvdWNoUG9zID0geyB4OiBlLnRvdWNoZXNbMF0uY2xpZW50WCwgeTogZS50b3VjaGVzWzBdLmNsaWVudFkgfTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgZnVuY3Rpb24gaGFuZGxlVG91Y2hNb3ZlKGUpIHsKICAgICAgICAgICAgICAgIGlmIChlLnRvdWNoZXMubGVuZ3RoID09PSAyICYmIGFwcFN0YXRlLmlzUGluY2hpbmcpIHsKICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudERpc3RhbmNlID0gZ2V0RGlzdGFuY2UoZS50b3VjaGVzWzBdLCBlLnRvdWNoZXNbMV0pOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNjYWxlRmFjdG9yID0gY3VycmVudERpc3RhbmNlIC8gYXBwU3RhdGUuaW5pdGlhbERpc3RhbmNlOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGxldCBuZXdTY2FsZSA9IGFwcFN0YXRlLmN1cnJlbnRTY2FsZSAqIHNjYWxlRmFjdG9yOwogICAgICAgICAgICAgICAgICAgIG5ld1NjYWxlID0gTWF0aC5tYXgoYXBwU3RhdGUubWluU2NhbGUsIE1hdGgubWluKGFwcFN0YXRlLm1heFNjYWxlLCBuZXdTY2FsZSkpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGFwcFN0YXRlLmN1cnJlbnRTY2FsZSA9IG5ld1NjYWxlOwogICAgICAgICAgICAgICAgICAgIGFwcFN0YXRlLmluaXRpYWxEaXN0YW5jZSA9IGN1cnJlbnREaXN0YW5jZTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpbWFnZVZpZXdlci5hcHBseVRyYW5zZm9ybSgpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlLnRvdWNoZXMubGVuZ3RoID09PSAxICYmIGFwcFN0YXRlLmN1cnJlbnRTY2FsZSA+IDEpIHsKICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGVsdGFYID0gZS50b3VjaGVzWzBdLmNsaWVudFggLSBhcHBTdGF0ZS5sYXN0VG91Y2hQb3MueDsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkZWx0YVkgPSBlLnRvdWNoZXNbMF0uY2xpZW50WSAtIGFwcFN0YXRlLmxhc3RUb3VjaFBvcy55OwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGFwcFN0YXRlLnBhbk9mZnNldC54ICs9IGRlbHRhWCAvIGFwcFN0YXRlLmN1cnJlbnRTY2FsZTsKICAgICAgICAgICAgICAgICAgICBhcHBTdGF0ZS5wYW5PZmZzZXQueSArPSBkZWx0YVkgLyBhcHBTdGF0ZS5jdXJyZW50U2NhbGU7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgYXBwU3RhdGUubGFzdFRvdWNoUG9zID0geyB4OiBlLnRvdWNoZXNbMF0uY2xpZW50WCwgeTogZS50b3VjaGVzWzBdLmNsaWVudFkgfTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpbWFnZVZpZXdlci5hcHBseVRyYW5zZm9ybSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBmdW5jdGlvbiBoYW5kbGVUb3VjaEVuZChlKSB7CiAgICAgICAgICAgICAgICBpZiAoZS50b3VjaGVzLmxlbmd0aCA8IDIpIHsKICAgICAgICAgICAgICAgICAgICBhcHBTdGF0ZS5pc1BpbmNoaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIChhcHBTdGF0ZS5jdXJyZW50U2NhbGUgPCAxLjEpIHsKICAgICAgICAgICAgICAgICAgICBhcHBTdGF0ZS5jdXJyZW50U2NhbGUgPSAxOwogICAgICAgICAgICAgICAgICAgIGFwcFN0YXRlLnBhbk9mZnNldCA9IHsgeDogMCwgeTogMCB9OwogICAgICAgICAgICAgICAgICAgIGltYWdlVmlld2VyLmFwcGx5VHJhbnNmb3JtKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGZ1bmN0aW9uIGhhbmRsZVdoZWVsKGUpIHsKICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc3Qgc2NhbGVDaGFuZ2UgPSBlLmRlbHRhWSA+IDAgPyAwLjkgOiAxLjE7CiAgICAgICAgICAgICAgICBsZXQgbmV3U2NhbGUgPSBhcHBTdGF0ZS5jdXJyZW50U2NhbGUgKiBzY2FsZUNoYW5nZTsKICAgICAgICAgICAgICAgIG5ld1NjYWxlID0gTWF0aC5tYXgoYXBwU3RhdGUubWluU2NhbGUsIE1hdGgubWluKGFwcFN0YXRlLm1heFNjYWxlLCBuZXdTY2FsZSkpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBhcHBTdGF0ZS5jdXJyZW50U2NhbGUgPSBuZXdTY2FsZTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKGFwcFN0YXRlLmN1cnJlbnRTY2FsZSA8PSAxLjEpIHsKICAgICAgICAgICAgICAgICAgICBhcHBTdGF0ZS5jdXJyZW50U2NhbGUgPSAxOwogICAgICAgICAgICAgICAgICAgIGFwcFN0YXRlLnBhbk9mZnNldCA9IHsgeDogMCwgeTogMCB9OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpbWFnZVZpZXdlci5hcHBseVRyYW5zZm9ybSgpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vID09PT09IEdlc3R1cmUgU3lzdGVtID09PT09CiAgICAgICAgZnVuY3Rpb24gc2V0dXBHZXN0dXJlU3lzdGVtKCkgewogICAgICAgICAgICBsZXQgc3RhcnRQb3MgPSB7IHg6IDAsIHk6IDAgfTsKICAgICAgICAgICAgbGV0IGN1cnJlbnRQb3MgPSB7IHg6IDAsIHk6IDAgfTsKICAgICAgICAgICAgbGV0IGxhc3RUaW1lID0gMDsKICAgICAgICAgICAgbGV0IHZlbG9jaXR5SGlzdG9yeSA9IFtdOwogICAgICAgICAgICBsZXQgZ2VzdHVyZVN0YXJ0ZWQgPSBmYWxzZTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsZW1lbnRzLmltYWdlVmlld3BvcnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgaGFuZGxlU3RhcnQpOwogICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCBoYW5kbGVNb3ZlKTsKICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIGhhbmRsZUVuZCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbGVtZW50cy5pbWFnZVZpZXdwb3J0LmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCBoYW5kbGVTdGFydCwgeyBwYXNzaXZlOiBmYWxzZSB9KTsKICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2htb3ZlJywgaGFuZGxlTW92ZSwgeyBwYXNzaXZlOiBmYWxzZSB9KTsKICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCBoYW5kbGVFbmQsIHsgcGFzc2l2ZTogZmFsc2UgfSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBmdW5jdGlvbiBoYW5kbGVTdGFydChlKSB7CiAgICAgICAgICAgICAgICBpZiAoYXBwU3RhdGUuaW1hZ2VGaWxlcy5sZW5ndGggPT09IDApIHJldHVybjsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKGUudG91Y2hlcyAmJiAoZS50b3VjaGVzLmxlbmd0aCA+IDEgfHwgYXBwU3RhdGUuaXNQaW5jaGluZykpIHJldHVybjsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKGFwcFN0YXRlLmN1cnJlbnRTY2FsZSA+IDEuMSkgcmV0dXJuOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICBjb25zdCBwb2ludCA9IGUudG91Y2hlcyA/IGUudG91Y2hlc1swXSA6IGU7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHN0YXJ0UG9zID0geyB4OiBwb2ludC5jbGllbnRYLCB5OiBwb2ludC5jbGllbnRZIH07CiAgICAgICAgICAgICAgICBjdXJyZW50UG9zID0geyB4OiBwb2ludC5jbGllbnRYLCB5OiBwb2ludC5jbGllbnRZIH07CiAgICAgICAgICAgICAgICBsYXN0VGltZSA9IERhdGUubm93KCk7CiAgICAgICAgICAgICAgICB2ZWxvY2l0eUhpc3RvcnkgPSBbXTsKICAgICAgICAgICAgICAgIGdlc3R1cmVTdGFydGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGFwcFN0YXRlLmlzRHJhZ2dpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgZWxlbWVudHMuY2VudGVySW1hZ2UuY2xhc3NMaXN0LmFkZCgnZHJhZ2dpbmcnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgZnVuY3Rpb24gaGFuZGxlTW92ZShlKSB7CiAgICAgICAgICAgICAgICBpZiAoIWFwcFN0YXRlLmlzRHJhZ2dpbmcgfHwgYXBwU3RhdGUuaW1hZ2VGaWxlcy5sZW5ndGggPT09IDApIHJldHVybjsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKGUudG91Y2hlcyAmJiBlLnRvdWNoZXMubGVuZ3RoID4gMSkgewogICAgICAgICAgICAgICAgICAgIGFwcFN0YXRlLmlzRHJhZ2dpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBlbGVtZW50cy5jZW50ZXJJbWFnZS5jbGFzc0xpc3QucmVtb3ZlKCdkcmFnZ2luZycpOwogICAgICAgICAgICAgICAgICAgIGhpZGVBbGxFZGdlR2xvd3MoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgIGNvbnN0IHBvaW50ID0gZS50b3VjaGVzID8gZS50b3VjaGVzWzBdIDogZTsKICAgICAgICAgICAgICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGN1cnJlbnRQb3MgPSB7IHg6IHBvaW50LmNsaWVudFgsIHk6IHBvaW50LmNsaWVudFkgfTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc3QgZGVsdGFYID0gY3VycmVudFBvcy54IC0gc3RhcnRQb3MueDsKICAgICAgICAgICAgICAgIGNvbnN0IGRlbHRhWSA9IGN1cnJlbnRQb3MueSAtIHN0YXJ0UG9zLnk7CiAgICAgICAgICAgICAgICBjb25zdCBkaXN0YW5jZSA9IE1hdGguc3FydChkZWx0YVggKiBkZWx0YVggKyBkZWx0YVkgKiBkZWx0YVkpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb25zdCB0aW1lRGVsdGEgPSBub3cgLSBsYXN0VGltZTsKICAgICAgICAgICAgICAgIGlmICh0aW1lRGVsdGEgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdmVsWCA9IGRlbHRhWCAvIHRpbWVEZWx0YTsKICAgICAgICAgICAgICAgICAgICBjb25zdCB2ZWxZID0gZGVsdGFZIC8gdGltZURlbHRhOwogICAgICAgICAgICAgICAgICAgIHZlbG9jaXR5SGlzdG9yeS5wdXNoKHsgeDogdmVsWCwgeTogdmVsWSwgdGltZTogbm93IH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHZlbG9jaXR5SGlzdG9yeSA9IHZlbG9jaXR5SGlzdG9yeS5maWx0ZXIodiA9PiBub3cgLSB2LnRpbWUgPCAxMDApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAoZGlzdGFuY2UgPiAzMCkgewogICAgICAgICAgICAgICAgICAgIGdlc3R1cmVTdGFydGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkaXJlY3Rpb24gPSBkZXRlcm1pbmVTd2lwZURpcmVjdGlvbihkZWx0YVgsIGRlbHRhWSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGRpcmVjdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgICBoaWRlQWxsRWRnZUdsb3dzKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHNob3dFZGdlR2xvdyhkaXJlY3Rpb24pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaGlkZUFsbEVkZ2VHbG93cygpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsYXN0VGltZSA9IG5vdzsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgZnVuY3Rpb24gaGFuZGxlRW5kKGUpIHsKICAgICAgICAgICAgICAgIGlmICghYXBwU3RhdGUuaXNEcmFnZ2luZykgcmV0dXJuOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICBhcHBTdGF0ZS5pc0RyYWdnaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICBlbGVtZW50cy5jZW50ZXJJbWFnZS5jbGFzc0xpc3QucmVtb3ZlKCdkcmFnZ2luZycpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAoIWdlc3R1cmVTdGFydGVkKSB7CiAgICAgICAgICAgICAgICAgICAgaGlkZUFsbEVkZ2VHbG93cygpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc3QgZGVsdGFYID0gY3VycmVudFBvcy54IC0gc3RhcnRQb3MueDsKICAgICAgICAgICAgICAgIGNvbnN0IGRlbHRhWSA9IGN1cnJlbnRQb3MueSAtIHN0YXJ0UG9zLnk7CiAgICAgICAgICAgICAgICBjb25zdCBkaXN0YW5jZSA9IE1hdGguc3FydChkZWx0YVggKiBkZWx0YVggKyBkZWx0YVkgKiBkZWx0YVkpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsZXQgYXZnVmVsID0geyB4OiAwLCB5OiAwIH07CiAgICAgICAgICAgICAgICBpZiAodmVsb2NpdHlIaXN0b3J5Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBhdmdWZWwgPSB2ZWxvY2l0eUhpc3RvcnkucmVkdWNlKChhY2MsIHYpID0+ICh7CiAgICAgICAgICAgICAgICAgICAgICAgIHg6IGFjYy54ICsgdi54LAogICAgICAgICAgICAgICAgICAgICAgICB5OiBhY2MueSArIHYueQogICAgICAgICAgICAgICAgICAgIH0pLCB7IHg6IDAsIHk6IDAgfSk7CiAgICAgICAgICAgICAgICAgICAgYXZnVmVsLnggLz0gdmVsb2NpdHlIaXN0b3J5Lmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICBhdmdWZWwueSAvPSB2ZWxvY2l0eUhpc3RvcnkubGVuZ3RoOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb25zdCB2ZWxvY2l0eSA9IE1hdGguc3FydChhdmdWZWwueCAqIGF2Z1ZlbC54ICsgYXZnVmVsLnkgKiBhdmdWZWwueSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIChkaXN0YW5jZSA+IDgwICYmIHZlbG9jaXR5ID4gMC41KSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGlyZWN0aW9uID0gZGV0ZXJtaW5lU3dpcGVEaXJlY3Rpb24oZGVsdGFYLCBkZWx0YVkpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldFN0YWNrID0gZGlyZWN0aW9uVG9TdGFjayhkaXJlY3Rpb24pOwogICAgICAgICAgICAgICAgICAgIGlmICh0YXJnZXRTdGFjayAmJiBkaXJlY3Rpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgZXhlY3V0ZUZsaWNrKHRhcmdldFN0YWNrKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaGlkZUFsbEVkZ2VHbG93cygpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGZ1bmN0aW9uIGRldGVybWluZVN3aXBlRGlyZWN0aW9uKGRlbHRhWCwgZGVsdGFZKSB7CiAgICAgICAgICAgIGlmIChNYXRoLmFicyhkZWx0YVgpID4gTWF0aC5hYnMoZGVsdGFZKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGRlbHRhWCA+IDAgPyAncmlnaHQnIDogJ2xlZnQnOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIGRlbHRhWSA+IDAgPyAnYm90dG9tJyA6ICd0b3AnOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGZ1bmN0aW9uIGRpcmVjdGlvblRvU3RhY2soZGlyZWN0aW9uKSB7CiAgICAgICAgICAgIGNvbnN0IG1hcHBpbmcgPSB7CiAgICAgICAgICAgICAgICAndG9wJzogJ3ByaW9yaXR5JywKICAgICAgICAgICAgICAgICdib3R0b20nOiAndHJhc2gnLAogICAgICAgICAgICAgICAgJ2xlZnQnOiAnaW4nLAogICAgICAgICAgICAgICAgJ3JpZ2h0JzogJ291dCcKICAgICAgICAgICAgfTsKICAgICAgICAgICAgcmV0dXJuIG1hcHBpbmdbZGlyZWN0aW9uXTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgYXN5bmMgZnVuY3Rpb24gZXhlY3V0ZUZsaWNrKHRhcmdldFN0YWNrKSB7CiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRJbWFnZSA9IGFwcFN0YXRlLmltYWdlRmlsZXNbYXBwU3RhdGUuY3VycmVudEltYWdlSW5kZXhdOwogICAgICAgICAgICBjb25zdCBjdXJyZW50U3RhY2sgPSBzdGFja01hbmFnZXIuZ2V0RmlsZU1ldGFkYXRhKGN1cnJlbnRJbWFnZSkuc2xpZGVib3hTdGFjazsKICAgICAgICAgICAgCiAgICAgICAgICAgIGFja25vd2xlZGdlUGlsbENvdW50ZXIodGFyZ2V0U3RhY2spOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKGN1cnJlbnRTdGFjayA9PT0gdGFyZ2V0U3RhY2spIHsKICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRTdGFja0FycmF5ID0gYXBwU3RhdGUuc3RhY2tzW2N1cnJlbnRTdGFja107CiAgICAgICAgICAgICAgICBjb25zdCBpbmRleCA9IGN1cnJlbnRTdGFja0FycmF5LmZpbmRJbmRleChpbWcgPT4gaW1nLmlkID09PSBjdXJyZW50SW1hZ2UuaWQpOwogICAgICAgICAgICAgICAgaWYgKGluZGV4ID4gLTEpIHsKICAgICAgICAgICAgICAgICAgICBjdXJyZW50U3RhY2tBcnJheS5zcGxpY2UoaW5kZXgsIDEpOwogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRTdGFja0FycmF5LnB1c2goY3VycmVudEltYWdlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKGFwcFN0YXRlLnN0YWNrc1thcHBTdGF0ZS5jdXJyZW50U3RhY2tdLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgIGVsZW1lbnRzLmNlbnRlckltYWdlLnN0eWxlLm9wYWNpdHkgPSAnMCc7CiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnRzLmNlbnRlckltYWdlLnNyYyA9ICcnOwogICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50cy5jZW50ZXJJbWFnZS5hbHQgPSAnTm8gaW1hZ2VzIGluIHRoaXMgc3RhY2snOwogICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVFbXB0eVN0YXRlQnV0dG9ucygpOwogICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50cy5lbXB0eVN0YXRlLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50cy5jZW50ZXJJbWFnZS5zdHlsZS5vcGFjaXR5ID0gJzEnOwogICAgICAgICAgICAgICAgICAgIH0sIDIwMCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGltYWdlVmlld2VyLm1vdmVUb05leHRJbWFnZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzdGFja01hbmFnZXIudXBkYXRlQ291bnRzKCk7CiAgICAgICAgICAgICAgICBoaWRlQWxsRWRnZUdsb3dzKCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBhd2FpdCBzdGFja01hbmFnZXIubW92ZUZpbGVUb1N0YWNrKGN1cnJlbnRJbWFnZS5pZCwgdGFyZ2V0U3RhY2spOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAoYXBwU3RhdGUuc3RhY2tzW2FwcFN0YXRlLmN1cnJlbnRTdGFja10ubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgZWxlbWVudHMuY2VudGVySW1hZ2Uuc3R5bGUub3BhY2l0eSA9ICcwJzsKICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudHMuY2VudGVySW1hZ2Uuc3JjID0gJyc7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnRzLmNlbnRlckltYWdlLmFsdCA9ICdObyBpbWFnZXMgaW4gdGhpcyBzdGFjayc7CiAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZUVtcHR5U3RhdGVCdXR0b25zKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnRzLmVtcHR5U3RhdGUuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnRzLmNlbnRlckltYWdlLnN0eWxlLm9wYWNpdHkgPSAnMSc7CiAgICAgICAgICAgICAgICAgICAgfSwgMjAwKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaW1hZ2VWaWV3ZXIubW92ZVRvTmV4dEltYWdlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBoaWRlQWxsRWRnZUdsb3dzKCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICB1dGlscy5zaG93VG9hc3QoYEVycm9yIG1vdmluZyBpbWFnZTogJHtlcnJvci5tZXNzYWdlfWAsICdlcnJvcicpOwogICAgICAgICAgICAgICAgaGlkZUFsbEVkZ2VHbG93cygpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vID09PT09IEluaXRpYWxpemUgQXBwID09PT09CiAgICAgICAgYXN5bmMgZnVuY3Rpb24gaW5pdEFwcCgpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGF3YWl0IGNhY2hlTWFuYWdlci5pbml0KCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGFwcFN0YXRlLmNsb3VkU3RvcmFnZSA9IG5ldyBDbG91ZFN0b3JhZ2VNb2R1bGUoKTsKICAgICAgICAgICAgICAgIGFwcFN0YXRlLmNsb3VkU3RvcmFnZS5zZXRQcm92aWRlcignZ29vZ2xlZHJpdmUnKTsKICAgICAgICAgICAgICAgIGFwcFN0YXRlLm1ldGFkYXRhRXh0cmFjdG9yID0gbmV3IE1ldGFkYXRhRXh0cmFjdG9yKCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGFwcFN0YXRlLmNsb3VkU3RvcmFnZS5vbkF1dGhTdGF0ZUNoYW5nZWQgPSAoYXV0aGVudGljYXRlZCwgcHJvdmlkZXIpID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgQXV0aCBzdGF0ZSBjaGFuZ2VkOiAke2F1dGhlbnRpY2F0ZWR9ICgke3Byb3ZpZGVyfSlgKTsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGFwcFN0YXRlLmNsb3VkU3RvcmFnZS5vbkVycm9yID0gKGVycm9yKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYENsb3VkU3RvcmFnZSBlcnJvcjogJHtlcnJvci5tZXNzYWdlfWApOwogICAgICAgICAgICAgICAgICAgIHV0aWxzLnNob3dUb2FzdChgRXJyb3I6ICR7ZXJyb3IubWVzc2FnZX1gLCAnZXJyb3InKTsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIChhcHBTdGF0ZS5jbG91ZFN0b3JhZ2UuaXNBdXRoZW50aWNhdGVkKCkpIHsKICAgICAgICAgICAgICAgICAgICBhdXRoTWFuYWdlci5zZXRTdGF0dXMoJ0FscmVhZHkgY29ubmVjdGVkIHRvIEdvb2dsZSBEcml2ZScsICdzdWNjZXNzJyk7CiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHV0aWxzLnNob3dTY3JlZW4oJ2ZvbGRlci1zY3JlZW4nKTsKICAgICAgICAgICAgICAgICAgICAgICAgZm9sZGVyTWFuYWdlci5sb2FkRm9sZGVycygpOwogICAgICAgICAgICAgICAgICAgIH0sIDEwMDApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBTZXR1cCBldmVudCBsaXN0ZW5lcnMKICAgICAgICAgICAgICAgIGVsZW1lbnRzLmF1dGhCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiBhdXRoTWFuYWdlci5hdXRoZW50aWNhdGUoKSk7CiAgICAgICAgICAgICAgICBlbGVtZW50cy5yZWZyZXNoRm9sZGVycy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IGZvbGRlck1hbmFnZXIubG9hZEZvbGRlcnMoKSk7CiAgICAgICAgICAgICAgICBlbGVtZW50cy5sb2dvdXQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiBhdXRoTWFuYWdlci5sb2dvdXQoKSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGVsZW1lbnRzLmJhY2tCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgdXRpbHMuc2hvd1NjcmVlbignZm9sZGVyLXNjcmVlbicpOwogICAgICAgICAgICAgICAgICAgIGZvbGRlck1hbmFnZXIubG9hZEZvbGRlcnMoKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBlbGVtZW50cy5kZXRhaWxzQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gZGV0YWlsc01vZGFsLnNob3coKSk7CiAgICAgICAgICAgICAgICBlbGVtZW50cy5kZXRhaWxzQ2xvc2UuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiBkZXRhaWxzTW9kYWwuaGlkZSgpKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnRhYi1idXR0b24nKS5mb3JFYWNoKGJ0biA9PiB7CiAgICAgICAgICAgICAgICAgICAgYnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gZGV0YWlsc01vZGFsLnN3aXRjaFRhYihidG4uZGF0YXNldC50YWIpKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnY29weS1tZXRhZGF0YScpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gZS50YXJnZXQuZGF0YXNldC52YWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgZGV0YWlsc01vZGFsLmNvcHlUb0NsaXBib2FyZCh2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGVsZW1lbnRzLnNlbGVjdEFub3RoZXJTdGFja0J0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzdGFja3NXaXRoSW1hZ2VzID0gU1RBQ0tfVFlQRVMuZmlsdGVyKHN0YWNrID0+IGFwcFN0YXRlLnN0YWNrc1tzdGFja10ubGVuZ3RoID4gMCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHN0YWNrc1dpdGhJbWFnZXMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXh0U3RhY2sgPSBzdGFja3NXaXRoSW1hZ2VzLmZpbmQoc3RhY2sgPT4gc3RhY2sgIT09IGFwcFN0YXRlLmN1cnJlbnRTdGFjaykgfHwgc3RhY2tzV2l0aEltYWdlc1swXTsKICAgICAgICAgICAgICAgICAgICAgICAgYXBwU3RhdGUuY3VycmVudFN0YWNrID0gbmV4dFN0YWNrOwogICAgICAgICAgICAgICAgICAgICAgICBpbWFnZVZpZXdlci5kaXNwbGF5VG9wSW1hZ2VGcm9tU3RhY2sobmV4dFN0YWNrKTsKICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudHMuZW1wdHlTdGF0ZS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50cy5zZWxlY3RBbm90aGVyU3RhY2tCdG4uc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudHMuc2VsZWN0QW5vdGhlckZvbGRlckJ0bi5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZWxlbWVudHMuc2VsZWN0QW5vdGhlckZvbGRlckJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICAgICAgICAgICAgICB1dGlscy5zaG93U2NyZWVuKCdmb2xkZXItc2NyZWVuJyk7CiAgICAgICAgICAgICAgICAgICAgZm9sZGVyTWFuYWdlci5sb2FkRm9sZGVycygpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHNldHVwUGluY2hab29tKCk7CiAgICAgICAgICAgICAgICBzZXR1cEdlc3R1cmVTeXN0ZW0oKTsKICAgICAgICAgICAgICAgIHNldHVwUHJveFRhYkNsaWNrcygpOwogICAgICAgICAgICAgICAgbW9kYWxNYW5hZ2VyLnNldHVwKCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGVsZW1lbnRzLmNsb3NlR3JpZC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IGdyaWRWaWV3LmNsb3NlKCkpOwogICAgICAgICAgICAgICAgZWxlbWVudHMuc2VsZWN0QWxsQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gZ3JpZFZpZXcuc2VsZWN0QWxsKCkpOwogICAgICAgICAgICAgICAgZWxlbWVudHMuZGVzZWxlY3RBbGxCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiBncmlkVmlldy5kZXNlbGVjdEFsbCgpKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZWxlbWVudHMuZ3JpZFNpemUuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBlbGVtZW50cy5ncmlkU2l6ZS52YWx1ZTsKICAgICAgICAgICAgICAgICAgICBlbGVtZW50cy5ncmlkU2l6ZVZhbHVlLnRleHRDb250ZW50ID0gdmFsdWU7CiAgICAgICAgICAgICAgICAgICAgZWxlbWVudHMuZ3JpZENvbnRhaW5lci5zdHlsZS5ncmlkVGVtcGxhdGVDb2x1bW5zID0gYHJlcGVhdCgke3ZhbHVlfSwgMWZyKWA7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgKGFwcFN0YXRlLmdyaWQuc2VsZWN0ZWQubGVuZ3RoID09PSAxICYmIHZhbHVlID09PSAnMScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiBncmlkVmlldy5mb2N1c09uU2VsZWN0ZWRJdGVtKGFwcFN0YXRlLmdyaWQuc2VsZWN0ZWRbMF0pLCAxMDApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBlbGVtZW50cy5ncmlkU29ydC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc29ydFZhbHVlID0gZWxlbWVudHMuZ3JpZFNvcnQudmFsdWU7CiAgICAgICAgICAgICAgICAgICAgc3RhY2tNYW5hZ2VyLmN1cnJlbnRTb3J0ID0gc29ydFZhbHVlOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIFNUQUNLX1RZUEVTLmZvckVhY2goc3RhY2sgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBhcHBTdGF0ZS5zdGFja3Nbc3RhY2tdID0gc3RhY2tNYW5hZ2VyLnNvcnRGaWxlcyhhcHBTdGF0ZS5zdGFja3Nbc3RhY2tdLCBzb3J0VmFsdWUpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIChhcHBTdGF0ZS5ncmlkLnN0YWNrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGdyaWRWaWV3LnBvcHVsYXRlKGFwcFN0YXRlLmdyaWQuc3RhY2spOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiAoYXBwU3RhdGUuaW1hZ2VGaWxlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGltYWdlVmlld2VyLmRpc3BsYXlDdXJyZW50SW1hZ2UoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZWxlbWVudHMuZ3JpZENvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGUgPT4gewogICAgICAgICAgICAgICAgICAgIGlmIChlLnRhcmdldCA9PT0gZWxlbWVudHMuZ3JpZENvbnRhaW5lcikgewogICAgICAgICAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgKGUpID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAoZWxlbWVudHMuYXBwQ29udGFpbmVyLmNsYXNzTGlzdC5jb250YWlucygnaGlkZGVuJykpIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiAoIWVsZW1lbnRzLmRldGFpbHNNb2RhbC5jbGFzc0xpc3QuY29udGFpbnMoJ2hpZGRlbicpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlLmtleSA9PT0gJ0VzY2FwZScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldGFpbHNNb2RhbC5oaWRlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiAoIWVsZW1lbnRzLmdyaWRNb2RhbC5jbGFzc0xpc3QuY29udGFpbnMoJ2hpZGRlbicpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlLmtleSA9PT0gJ0VzY2FwZScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyaWRWaWV3LmNsb3NlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGUua2V5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ0Fycm93TGVmdCc6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ0Fycm93UmlnaHQnOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW1hZ2VWaWV3ZXIubW92ZVRvTmV4dEltYWdlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnRXNjYXBlJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV0aWxzLnNob3dTY3JlZW4oJ2ZvbGRlci1zY3JlZW4nKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICcxJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcFN0YXRlLmN1cnJlbnRTdGFjayA9ICdpbic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVBY3RpdmVQcm94VGFiKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBncmlkVmlldy5vcGVuKCdpbicpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJzInOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwU3RhdGUuY3VycmVudFN0YWNrID0gJ291dCc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVBY3RpdmVQcm94VGFiKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBncmlkVmlldy5vcGVuKCdvdXQnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICczJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcFN0YXRlLmN1cnJlbnRTdGFjayA9ICdwcmlvcml0eSc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVBY3RpdmVQcm94VGFiKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBncmlkVmlldy5vcGVuKCdwcmlvcml0eScpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJzQnOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwU3RhdGUuY3VycmVudFN0YWNrID0gJ3RyYXNoJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZUFjdGl2ZVByb3hUYWIoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyaWRWaWV3Lm9wZW4oJ3RyYXNoJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnaSc6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ0knOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV0YWlsc01vZGFsLnNob3coKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB1cGRhdGVBY3RpdmVQcm94VGFiKCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCfwn46JIE9yYml0YWw4IC0gRml4ZWQgJiBTaW1wbGlmaWVkIHJlYWR5IScpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gaW5pdGlhbGl6ZSBhcHA6JywgZXJyb3IpOwogICAgICAgICAgICAgICAgdXRpbHMuc2hvd1RvYXN0KCdGYWlsZWQgdG8gaW5pdGlhbGl6ZSBhcHAnLCAnZXJyb3InKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgaW5pdEFwcCk7CiAgICA8L3NjcmlwdD4KCjxzY3JpcHQ+CndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgKCkgPT4gewogIGlmICh0eXBlb2YgZXh0cmFjdEFuZERpc3BsYXlNZXRhZGF0YSA9PT0gJ2Z1bmN0aW9uJykgewogICAgbG9nKCfwn5+hIFRyaWdnZXJpbmcgZXh0cmFjdEFuZERpc3BsYXlNZXRhZGF0YSBkaXJlY3RseSBvbiB3aW5kb3cgbG9hZC4nKTsKICAgIGV4dHJhY3RBbmREaXNwbGF5TWV0YWRhdGEoKTsKICB9IGVsc2UgewogICAgbG9nKCfinYwgZXh0cmFjdEFuZERpc3BsYXlNZXRhZGF0YSBmdW5jdGlvbiBub3QgZm91bmQuJyk7CiAgfQp9KTsKPC9zY3JpcHQ+PC9ib2R5Pgo8L2h0bWw+';
  iframe.style.display = 'block';
}
</script>
</body>
</html>
