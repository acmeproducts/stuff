<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mouse Disturbance Sphere â€“ Local</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
html, body {
  margin: 0;
  padding: 0;
  background: black;
  overflow: hidden;
  font-family: sans-serif;
  color: white;
}

#toggle {
  position: fixed;
  top: 10px;
  left: 10px;
  z-index: 10;
}

#panel {
  position: fixed;
  top: 0;
  left: 0;
  width: 260px;
  height: 100vh;
  background: rgba(0,0,0,0.85);
  padding: 10px;
  border-right: 1px solid #333;
  overflow-y: auto;
  transform: translateX(0);
  transition: transform 0.3s ease;
}

#panel.collapsed {
  transform: translateX(-240px);
}

label {
  display: block;
  margin-top: 8px;
  font-size: 12px;
}

input, button {
  width: 100%;
}
</style>
</head>

<body>

<button id="toggle">Controls</button>

<div id="panel">
  <label>Particle Count
    <input type="number" id="count" min="10" max="300" value="120">
  </label>

  <label>Radius
    <input type="range" id="radius" min="50" max="400" value="220">
  </label>

  <label>Attraction
    <input type="range" id="attraction" min="0" max="0.1" step="0.001" value="0.02">
  </label>

  <label>Damping
    <input type="range" id="damping" min="0.8" max="0.999" step="0.001" value="0.96">
  </label>

  <label>Mouse Repel Strength
    <input type="range" id="repelStrength" min="0" max="10" step="0.1" value="4">
  </label>

  <label>Mouse Repel Radius
    <input type="range" id="repelRadius" min="10" max="300" value="120">
  </label>

  <label>Particle Size
    <input type="range" id="size" min="1" max="5" step="0.5" value="2">
  </label>

  <label>Color
    <input type="color" id="color" value="#ffffff">
  </label>

  <label>
    <input type="checkbox" id="collisions">
    Enable Particle Collisions
  </label>

  <button id="reset">Reset System</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/p5@1.9.3/lib/p5.min.js"></script>

<script>
let points = [];
let particles = 120;
let radius_ = 220;
let angle = 0;

let attraction = 0.02;
let damping = 0.96;
let repel_strength = 4;
let repel_radius = 120;
let pointSize = 2;
let particleColor = "#ffffff";
let collisionsEnabled = false;

function setup() {
  createCanvas(window.innerWidth, window.innerHeight);
  pixelDensity(1);
  strokeWeight(pointSize);
  resetSystem();
}

function resetSystem() {
  points = [];
  angle = 0;

  for (let i = 0; i < particles; i++) {
    points.push({
      index: i,
      pos: createVector(0, 0),
      vel: createVector(0, 0)
    });
  }

  updateTargets();
}

function draw() {
  background(0);
  translate(width / 2, height / 2);
  stroke(particleColor);

  let mouse = createVector(mouseX - width / 2, mouseY - height / 2);

  for (let p of points) {
    let i = p.index;

    let homeX = sin(i + angle) * sin(i * i) * radius_;
    let homeY = cos(i * i) * radius_;
    let home = createVector(homeX, homeY);

    let toHome = p5.Vector.sub(home, p.pos);
    p.vel.add(toHome.mult(attraction));

    let away = p5.Vector.sub(p.pos, mouse);
    let d2 = away.magSq();

    if (d2 > 0.1 && d2 < repel_radius * repel_radius) {
      let d = sqrt(d2);
      away.normalize();
      away.mult(repel_strength * (1 - d / repel_radius));
      p.vel.add(away);
    }

    p.vel.mult(damping);
    p.pos.add(p.vel);
  }

  if (collisionsEnabled) {
    for (let i = 0; i < points.length; i++) {
      for (let j = i + 1; j < points.length; j++) {
        let a = points[i];
        let b = points[j];
        let delta = p5.Vector.sub(b.pos, a.pos);
        let dist = delta.mag();
        let minDist = pointSize * 2;

        if (dist > 0 && dist < minDist) {
          delta.normalize();
          let overlap = (minDist - dist) * 0.5;
          delta.mult(overlap);
          b.pos.add(delta);
          a.pos.sub(delta);
        }
      }
    }
  }

  for (let p of points) {
    point(p.pos.x, p.pos.y);
  }

  angle += 0.01;
}

function updateTargets() {
  for (let p of points) {
    let i = p.index;
    p.pos.set(
      sin(i + angle) * sin(i * i) * radius_,
      cos(i * i) * radius_
    );
  }
}

function windowResized() {
  resizeCanvas(window.innerWidth, window.innerHeight);
}

document.getElementById("toggle").onclick = () =>
  document.getElementById("panel").classList.toggle("collapsed");

document.getElementById("count").oninput = e => {
  particles = parseInt(e.target.value);
  resetSystem();
};

document.getElementById("radius").oninput = e => radius_ = +e.target.value;
document.getElementById("attraction").oninput = e => attraction = +e.target.value;
document.getElementById("damping").oninput = e => damping = +e.target.value;
document.getElementById("repelStrength").oninput = e => repel_strength = +e.target.value;
document.getElementById("repelRadius").oninput = e => repel_radius = +e.target.value;

document.getElementById("size").oninput = e => {
  pointSize = +e.target.value;
  strokeWeight(pointSize);
};

document.getElementById("color").oninput = e => particleColor = e.target.value;
document.getElementById("collisions").onchange = e => collisionsEnabled = e.target.checked;
document.getElementById("reset").onclick = resetSystem;
</script>

</body>
</html>