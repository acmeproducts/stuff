<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal Web Tool v12</title>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #3498db;
            --bg: #f4f4f9;
            --tab-active: #ffffff;
            --tab-inactive: #e0e0e0;
            --border: #ccc;
        }

        body {
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            overflow: hidden;
        }

        /* --- 1. Top Navigation Bar (Address) --- */
        .nav-bar {
            background: #fff;
            padding: 8px 12px;
            display: flex;
            gap: 10px;
            align-items: center;
            border-bottom: 1px solid var(--border);
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            z-index: 20;
        }

        .home-btn {
            background: none;
            border: 1px solid var(--border);
            border-radius: 4px;
            cursor: pointer;
            padding: 8px 12px;
            font-size: 18px;
            transition: background 0.2s;
        }
        .home-btn:hover { background: #eee; }

        input[type="text"] {
            flex: 1;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 16px;
            outline: none;
        }
        input[type="text"]:focus { border-color: var(--accent); }

        .go-btn {
            padding: 10px 20px;
            background-color: var(--accent);
            color: white;
            border: none;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
        }
        .go-btn:hover { opacity: 0.9; }
        .go-btn:disabled { background-color: #95a5a6; cursor: wait; }

        /* --- 2. Tab Controls --- */
        .tab-bar {
            display: flex;
            background: var(--tab-inactive);
            border-bottom: 1px solid var(--border);
        }

        .tab-btn {
            flex: 1;
            padding: 12px;
            border: none;
            background: none;
            cursor: pointer;
            font-weight: 600;
            color: #666;
            border-right: 1px solid #d1d1d1;
            transition: background 0.2s;
        }
        .tab-btn:last-child { border-right: none; }
        
        .tab-btn.active {
            background: var(--tab-active);
            color: var(--accent);
            border-bottom: 3px solid var(--accent);
        }
        .tab-btn:hover:not(.active) { background: #dcdcdc; }

        /* --- 3. Main Content Areas --- */
        .content-area {
            flex: 1;
            position: relative;
            overflow: hidden;
            background: white;
        }

        /* Panel Visibility Logic */
        .panel { display: none; width: 100%; height: 100%; flex-direction: column; }
        .panel.active { display: flex; }

        /* A. Browser Panel */
        iframe { width: 100%; height: 100%; border: none; }
        .browser-toolbar {
            padding: 5px 10px;
            background: #f8f9fa;
            border-bottom: 1px solid #ddd;
            display: flex;
            justify-content: flex-end;
        }
        .reader-btn {
            background: #27ae60;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
        }

        /* B. Source Panel */
        textarea.source-viewer {
            flex: 1;
            width: 100%;
            padding: 15px;
            background: #282c34;
            color: #abb2bf;
            font-family: 'Courier New', monospace;
            border: none;
            resize: none;
            box-sizing: border-box;
        }
        .source-controls {
            padding: 10px;
            background: #eee;
            border-bottom: 1px solid #ccc;
            text-align: right;
        }

        /* C. Log Panel */
        .log-container {
            flex: 1;
            background: #1e1e1e;
            color: #00ff9d;
            padding: 15px;
            font-family: monospace;
            overflow-y: auto;
            font-size: 13px;
        }
        .log-entry { margin-bottom: 5px; border-bottom: 1px solid #333; padding-bottom: 2px; }
        .log-time { color: #888; margin-right: 10px; }
        .log-err { color: #ff6b6b; }
        .log-nav { color: #f1c40f; }

        /* --- Reader Overlay (Popup) --- */
        #reader-overlay {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: white; z-index: 100; display: none; flex-direction: column;
        }
        .reader-header { padding: 15px; background: #ecf0f1; border-bottom: 1px solid #bdc3c7; display: flex; justify-content: space-between; align-items: center; }
        .reader-body { flex: 1; padding: 40px; overflow-y: auto; max-width: 800px; margin: 0 auto; line-height: 1.8; font-size: 18px; color: #111; }
        .speaking { background-color: #fff3cd; border-left: 5px solid #f1c40f; padding-left: 10px; }

    </style>
</head>
<body>

    <nav class="nav-bar">
        <button class="home-btn" id="btnHome" title="Home (Startpage)">üè†</button>
        <input type="text" id="urlInput" placeholder="Enter URL (e.g. cnn)" />
        <button class="go-btn" id="btnGo">Go</button>
    </nav>

    <div class="tab-bar">
        <button class="tab-btn active" onclick="switchTab('browser')">Browser</button>
        <button class="tab-btn" onclick="switchTab('source')">Source Code</button>
        <button class="tab-btn" onclick="switchTab('logs')">System Logs</button>
    </div>

    <div class="content-area">
        
        <div id="panel-browser" class="panel active">
            <div class="browser-toolbar">
                <button class="reader-btn" id="btnReaderOpen">üìñ Open Reader & Audio</button>
            </div>
            <iframe id="main-frame" sandbox="allow-same-origin allow-scripts allow-forms allow-popups"></iframe>
            
            <div id="reader-overlay">
                <div class="reader-header">
                    <strong>Reader Mode</strong>
                    <div style="display:flex; gap: 8px;">
                        <button class="reader-btn" onclick="startAudio()">üîä Play</button>
                        <button class="reader-btn" style="background:#c0392b; display:none;" id="btnStopAudio" onclick="stopAudio()">‚èπ Stop</button>
                        <button class="home-btn" onclick="closeReader()">Close</button>
                    </div>
                </div>
                <div id="reader-content" class="reader-body"></div>
            </div>
        </div>

        <div id="panel-source" class="panel">
            <div class="source-controls">
                <button class="go-btn" style="padding: 5px 15px;" id="btnCopySource" onclick="copySource()">Copy to Clipboard</button>
            </div>
            <textarea id="source-code" class="source-viewer" spellcheck="false" placeholder="Source code will appear here..."></textarea>
        </div>

        <div id="panel-logs" class="panel">
            <div class="log-container" id="log-output">
                <div class="log-entry">System Ready. Video Filter Active.</div>
            </div>
        </div>

    </div>

    <script>
        // --- CONFIG ---
        const PROXIES = [
            { name: "CodeTabs", url: t => `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(t)}` },
            { name: "AllOrigins", url: t => `https://api.allorigins.win/raw?url=${encodeURIComponent(t)}` },
            { name: "CORSProxy", url: t => `https://corsproxy.io/?${encodeURIComponent(t)}` }
        ];

        let fetchedHtml = "";
        let synth = window.speechSynthesis;
        let isReading = false;
        let audioQueue = [];
        let currentAudioIndex = 0;

        // --- UI LOGIC ---
        function switchTab(tabName) {
            // Update Buttons
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');

            // Update Panels
            document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
            document.getElementById(`panel-${tabName}`).classList.add('active');

            // Dynamic Source Update
            if (tabName === 'source') {
                document.getElementById('source-code').value = fetchedHtml || "No content loaded.";
            }
        }

        function log(msg, type="info") {
            const container = document.getElementById('log-output');
            const time = new Date().toLocaleTimeString();
            const color = type === 'error' ? 'log-err' : (type === 'nav' ? 'log-nav' : '');
            
            const div = document.createElement('div');
            div.className = 'log-entry';
            div.innerHTML = `<span class="log-time">[${time}]</span><span class="${color}">${msg}</span>`;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        // --- URL & FETCH LOGIC ---
        function fixUrl(input) {
            let url = input.trim();
            if (!url) return null;
            if (!url.includes('.') && !url.includes('://') && !url.includes('localhost')) url += '.com';
            if (!url.startsWith('http://') && !url.startsWith('https://')) url = 'https://' + url;
            return url;
        }

        async function loadUrl(urlOverride) {
            const raw = urlOverride || document.getElementById('urlInput').value;
            const url = fixUrl(raw);
            if(!url) return alert("Invalid URL");

            // Reset UI
            document.getElementById('urlInput').value = url;
            document.getElementById('btnGo').textContent = "...";
            document.getElementById('btnGo').disabled = true;
            fetchedHtml = "";
            stopAudio();

            log(`Fetching: ${url}`);

            let success = false;

            for (let proxy of PROXIES) {
                if(success) break;
                try {
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 12000);
                    const res = await fetch(proxy.url(url), { signal: controller.signal });
                    clearTimeout(timeoutId);

                    if(!res.ok) throw new Error(`HTTP ${res.status}`);
                    let text = await res.text();
                    if(!text || text.length < 200) throw new Error("Empty content");

                    // --- VIDEO KILLER & CLEANUP ---
                    // We parse the HTML string and remove problematic tags before rendering
                    // This prevents the browser from even trying to load the video assets
                    text = removeHeavyMedia(text);
                    
                    // --- PREPARE HTML ---
                    const baseTag = `<base href="${url}" target="_self">`;
                    const navScript = `
                        <script>
                            document.addEventListener('click', function(e) {
                                const link = e.target.closest('a');
                                if (link && link.href && !link.href.startsWith('javascript')) {
                                    e.preventDefault();
                                    window.parent.postMessage({ type: 'internal_nav', url: link.href }, '*');
                                }
                            });
                        <\/script>
                    `;

                    if(text.includes('<head>')) {
                        fetchedHtml = text.replace('<head>', `<head>${baseTag}${navScript}`);
                    } else {
                        fetchedHtml = baseTag + navScript + text;
                    }

                    document.getElementById('main-frame').srcdoc = fetchedHtml;
                    log(`Loaded via ${proxy.name}`, 'nav');
                    success = true;

                } catch(err) {
                    log(`${proxy.name} failed: ${err.message}`, 'error');
                }
            }

            if(!success) {
                log("All proxies failed.", 'error');
                document.getElementById('main-frame').src = url; // Fallback
            }

            document.getElementById('btnGo').textContent = "Go";
            document.getElementById('btnGo').disabled = false;
        }

        // --- HELPER: VIDEO KILLER ---
        function removeHeavyMedia(htmlString) {
            // Using DOMParser to safely remove tags
            const parser = new DOMParser();
            const doc = parser.parseFromString(htmlString, 'text/html');
            
            // Remove <video>, <audio>, and generic <embed>
            const killers = ['video', 'audio', 'embed', 'object'];
            killers.forEach(tag => {
                doc.querySelectorAll(tag).forEach(el => {
                    // Replace with a placeholder so the layout doesn't break entirely
                    const placeholder = document.createElement('div');
                    placeholder.style.cssText = "background:#eee; padding:10px; border:1px dashed #999; text-align:center; color:#555;";
                    placeholder.innerText = `[${tag.toUpperCase()} REMOVED]`;
                    el.replaceWith(placeholder);
                });
            });

            return doc.documentElement.outerHTML;
        }

        // --- INTERNAL NAV LISTENER ---
        window.addEventListener('message', (event) => {
            if (event.data && event.data.type === 'internal_nav') {
                log(`Navigating to: ${event.data.url}`, 'nav');
                loadUrl(event.data.url);
            }
        });

        // --- HOME BUTTON ---
        document.getElementById('btnHome').onclick = () => {
            log("Navigating Home (Startpage.com)...");
            loadUrl('https://startpage.com');
        };

        // --- READER MODE ---
        document.getElementById('btnReaderOpen').onclick = () => {
            if(!fetchedHtml) return alert("Content loading...");
            
            const parser = new DOMParser();
            const doc = parser.parseFromString(fetchedHtml, 'text/html');

            ['script','style','iframe','nav','footer','header','aside','svg','button','form'].forEach(t => doc.querySelectorAll(t).forEach(e => e.remove()));

            let contentHTML = "";
            let lastText = "";
            const nodes = doc.querySelectorAll('h1, h2, h3, p, article');
            const badPhrases = ["Getty Images", "Source:", "Copyright", "All rights reserved"];

            nodes.forEach(node => {
                let text = node.innerText.trim().replace(/\s+/g, ' ');
                if(text.length > 25 && !badPhrases.some(b => text.includes(b)) && text !== lastText) {
                    contentHTML += `<p>${text}</p>`;
                    lastText = text;
                }
            });

            if(!contentHTML) contentHTML = "<p>No readable text found.</p>";
            document.getElementById('reader-content').innerHTML = contentHTML;
            document.getElementById('reader-overlay').style.display = 'flex';
        };

        function closeReader() {
            stopAudio();
            document.getElementById('reader-overlay').style.display = 'none';
        }

        // --- AUDIO ENGINE ---
        function startAudio() {
            const paras = document.querySelectorAll('#reader-content p');
            if(paras.length === 0) return;
            stopAudio();
            audioQueue = Array.from(paras);
            currentAudioIndex = 0;
            isReading = true;
            document.getElementById('btnStopAudio').style.display = 'inline-block';
            playNextChunk();
        }

        function playNextChunk() {
            if(!isReading || currentAudioIndex >= audioQueue.length) {
                stopAudio();
                return;
            }
            const p = audioQueue[currentAudioIndex];
            document.querySelectorAll('.speaking').forEach(e => e.classList.remove('speaking'));
            p.classList.add('speaking');
            p.scrollIntoView({ behavior: "smooth", block: "center" });

            const u = new SpeechSynthesisUtterance(p.innerText);
            const enVoice = synth.getVoices().find(v => v.lang.startsWith('en'));
            if(enVoice) u.voice = enVoice;

            u.onend = () => { currentAudioIndex++; playNextChunk(); };
            u.onerror = () => { currentAudioIndex++; playNextChunk(); };
            synth.speak(u);
        }

        function stopAudio() {
            isReading = false;
            synth.cancel();
            document.getElementById('btnStopAudio').style.display = 'none';
            document.querySelectorAll('.speaking').forEach(e => e.classList.remove('speaking'));
        }

        // --- SOURCE COPY ---
        function copySource() {
            const el = document.getElementById('source-code');
            el.select();
            document.execCommand('copy');
            const btn = document.getElementById('btnCopySource');
            btn.innerText = "Copied!";
            setTimeout(() => btn.innerText = "Copy to Clipboard", 1500);
        }

        // --- EVENTS ---
        document.getElementById('btnGo').onclick = () => loadUrl();
        document.getElementById('urlInput').addEventListener('keypress', e => { if(e.key==='Enter') loadUrl(); });

    </script>
</body>
</html>